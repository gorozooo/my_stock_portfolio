{% extends "base.html" %}
{% load static humanize %}

{% block title %}A/B 実験ダッシュボード{% endblock %}

{% block head %}
<link rel="stylesheet" href="{% static 'css/ab.css' %}?v=1">
{% endblock %}

{% block content %}
<section class="ab-wrap glass">
  <header class="ab-head">
    <h1>A/B 実験ダッシュボード</h1>
    <p class="meta">
      基準日: {{ base_days|default:90 }}日 / Horizon: {{ horizon_days|default:7 }}日 /
      {{ now_str|default:"--" }}
    </p>

    <div class="ab-actions">
      <a class="btn" href="?set=A">A固定（ルール）</a>
      <a class="btn" href="?set=B">B固定（policy補正）</a>
      <a class="btn ghost" href="?reload=1">再読み込み</a>
    </div>
  </header>

  <!-- モバイル向け：カード表示 -->
  <div class="ab-cards">
    <div class="ab-card">
      <div class="ab-card-head">
        <span class="tag tag-a">A</span>
        <strong>ルール</strong>
      </div>
      <ul class="kv">
        <li><span>Sessions</span><b>{{ a.sessions|default:0 }}</b></li>
        <li><span>Advice</span><b>{{ a.advices|default:0 }}</b></li>
        <li><span>Taken</span><b>{{ a.taken|default:0 }}</b></li>
        <li><span>Take Rate</span><b>{{ a.take_rate|default:"0.000" }}</b></li>
        <li><span>Avg Improve</span><b>{{ a.avg_improve|default:"0.000" }}</b></li>
      </ul>
    </div>

    <div class="ab-card">
      <div class="ab-card-head">
        <span class="tag tag-b">B</span>
        <strong>policy補正</strong>
      </div>
      <ul class="kv">
        <li><span>Sessions</span><b>{{ b.sessions|default:0 }}</b></li>
        <li><span>Advice</span><b>{{ b.advices|default:0 }}</b></li>
        <li><span>Taken</span><b>{{ b.taken|default:0 }}</b></li>
        <li><span>Take Rate</span><b>{{ b.take_rate|default:"0.000" }}</b></li>
        <li><span>Avg Improve</span><b>{{ b.avg_improve|default:"0.000" }}</b></li>
      </ul>
    </div>
  </div>

  <!-- PC向け：テーブル（モバイルでは横スク可能 & 小さく表示） -->
  <div class="ab-table-wrap">
    <table class="ab-table">
      <thead>
        <tr>
          <th>Variant</th>
          <th>Sessions</th>
          <th>Advice</th>
          <th>Taken</th>
          <th>Take Rate</th>
          <th>Avg Improve</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>A</td>
          <td>{{ a.sessions|default:0 }}</td>
          <td>{{ a.advices|default:0 }}</td>
          <td>{{ a.taken|default:0 }}</td>
          <td>{{ a.take_rate|default:"0.000" }}</td>
          <td>{{ a.avg_improve|default:"0.000" }}</td>
        </tr>
        <tr>
          <td>B</td>
          <td>{{ b.sessions|default:0 }}</td>
          <td>{{ b.advices|default:0 }}</td>
          <td>{{ b.taken|default:0 }}</td>
          <td>{{ b.take_rate|default:"0.000" }}</td>
          <td>{{ b.avg_improve|default:"0.000" }}</td>
        </tr>
      </tbody>
    </table>
    <p class="note">※ Avg Improve は ROI改善・流動性改善・信用比率低下を合成した −1.0〜+1.0 の簡易スコア。</p>
  </div>
</section>
{% endblock %}