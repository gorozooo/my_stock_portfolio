{% extends "base.html" %}
{% load static humanize %}

{% block title %}ãƒ›ãƒ¼ãƒ  | Myæ ªãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ª{% endblock %}

{% block head %}
<link rel="stylesheet" href="{% static 'css/home.css' %}?v=1">
<script defer src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script defer src="{% static 'js/home.js' %}?v=1"></script>
{% endblock %}

{% block content %}

<!-- ğŸ§  AIãƒ˜ãƒƒãƒ€ãƒ¼ -->
<section class="ai-header glass">
  <div class="ai-title">AIã‚¢ãƒ‰ãƒã‚¤ã‚¶ãƒ¼</div>
  <p class="ai-note">{{ ai_note }}</p>
  <ul class="ai-actions">
    {% for a in ai_actions %}
      <li>â€¢ {{ a }}</li>
    {% endfor %}
  </ul>
  <div class="ai-tools">
    <button class="btn ghost" id="btn-ai-weekly">é€±æ¬¡ãƒ¬ãƒãƒ¼ãƒˆ</button>
    <button class="btn ghost" id="btn-ai-rebalance">æ¬¡ã®ä¸€æ‰‹</button>
  </div>
</section>

<!-- ğŸ“Š KPI -->
<section class="kpi-grid">
  <div class="kpi-card">
    <div class="kpi-label">ç·è³‡ç”£</div>
    <div class="kpi-value">Â¥{{ kpis.total_assets|intcomma }}</div>
  </div>
  <div class="kpi-card">
    <div class="kpi-label">å«ã¿æç›Š</div>
    <div class="kpi-value {{ kpis.unrealized_pnl|floatformat:0|add:'0'|floatformat:0|yesno:'pos,neg' }}">Â¥{{ kpis.unrealized_pnl|intcomma }}</div>
  </div>
  <div class="kpi-card">
    <div class="kpi-label">å½“æœˆå®Ÿç¾</div>
    <div class="kpi-value {{ kpis.realized_month|yesno:'pos,neg' }}">Â¥{{ kpis.realized_month|intcomma }}</div>
  </div>
  <div class="kpi-card">
    <div class="kpi-label">å‹ç‡</div>
    <div class="kpi-value">{{ kpis.win_ratio }}%</div>
  </div>
</section>

<!-- ğŸ“ˆ ã‚»ã‚¯ã‚¿ãƒ¼æ¨ªã‚¹ã‚¯ -->
<section class="sector-strip glass">
  <div class="strip-title">ã‚»ã‚¯ã‚¿ãƒ¼åˆ¥ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹</div>
  <div class="strip-scroll">
    {% for s in sectors %}
      <div class="sector-chip">
        <div class="sec-name">{{ s.sector }}</div>
        <div class="sec-meta">
          <span class="mv">Â¥{{ s.mv|intcomma }}</span>
          <span class="rate {{ s.rate|floatformat:2|yesno:'pos,neg' }}">{{ s.rate }}%</span>
        </div>
      </div>
    {% empty %}
      <div class="empty">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>
    {% endfor %}
  </div>
</section>

<!-- ğŸ§ª ã‚¹ãƒˆãƒ¬ã‚¹ãƒ†ã‚¹ãƒˆ -->
<section class="stress glass">
  <div class="stress-head">
    <div>ã‚¹ãƒˆãƒ¬ã‚¹ãƒ†ã‚¹ãƒˆï¼ˆæ—¥çµŒå¤‰å‹•ã‚’ä»®å®šï¼‰</div>
    <div class="stress-result"><span id="stressPct">-5</span>% â†’ æ¨å®šè³‡ç”£ <strong id="stressMV">Â¥{{ stressed_default|intcomma }}</strong></div>
  </div>
  <input type="range" min="-10" max="10" value="-5" step="1" id="stressSlider" />
</section>

<!-- ğŸ’° ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ•ãƒ­ãƒ¼ -->
<section class="cash glass">
  <div class="cash-head">ä»Šæœˆã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ•ãƒ­ãƒ¼</div>
  <canvas id="cashflowChart" height="140"></canvas>
</section>

<!-- âœ… æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ -->
<section class="todo glass">
  <div class="todo-head">æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</div>
  <ul class="todo-list" id="todoList">
    {% for a in ai_actions %}
      <li>âœ… {{ a }}</li>
    {% endfor %}
  </ul>
</section>

<!-- ãƒ‡ãƒ¼ã‚¿ä¾›çµ¦ï¼ˆJSç”¨ï¼‰ -->
<script id="home-data" type="application/json">
{
  "total_mv": {{ kpis.total_assets|default:0 }},
  "sectors": {{ sectors|safe }},
  "cash_bars": {{ cash_bars|safe }}
}
</script>

{% endblock %}