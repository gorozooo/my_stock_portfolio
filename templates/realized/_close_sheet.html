{# templates/realized/_close_sheet.html — 互換版（以前と同じパラメータでPOST） #}
<style>
  .sheet .in{
    appearance:none;-webkit-appearance:none;width:100%;
    border-radius:12px;padding:12px 14px;
    background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.15);
    color:#e9ecff;caret-color:#fff;outline:none;
    transition:border-color .15s ease,box-shadow .15s ease,background .15s ease;
  }
  .sheet .in::placeholder{color:rgba(233,236,255,.45)}
  .sheet .in:focus{border-color:rgba(99,102,241,.55);box-shadow:0 0 0 3px rgba(99,102,241,.22);background:rgba(255,255,255,.10)}
  .sheet .in[readonly],.sheet .in:disabled{opacity:.75}
  .sheet input[type="date"].in,.sheet input[type="number"].in,.sheet input[type="text"].in{color:#e9ecff}
  .sheet input.in:-webkit-autofill{-webkit-text-fill-color:#e9ecff;transition:background-color 9999s ease-in-out 0s;-webkit-box-shadow:0 0 0 1000px rgba(255,255,255,.08) inset}
  .sheet .btn-primary{width:100%;border:0;border-radius:14px;padding:14px 16px;background:linear-gradient(180deg,#6d73ff,#5561f2);color:#fff;font-weight:700;box-shadow:0 10px 24px rgba(85,97,242,.25)}
  .sheet .btn-ghost{width:100%;border:1px solid rgba(255,255,255,.15);border-radius:14px;padding:14px 16px;color:#e9ecff;background:transparent}
  .sheet .sheet-row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .sheet .sheet-title{font-weight:700;font-size:18px;margin-bottom:10px}
  .sheet .sheet-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
  .sheet .label{font-size:12px;color:#a7b1d8}
</style>

<div class="sheet">
  <div class="sheet-head">
    <div class="sheet-title">
      {{ h.ticker }} {% if h.name %}<span class="text-slate-400 text-xs font-normal">（{{ h.name }}）</span>{% endif %} をクローズ
    </div>
    <button type="button" class="text-indigo-300 underline" data-dismiss="sheet">閉じる</button>
  </div>

  <form class="js-close-submit-form" action="{% url 'realized_close_submit' h.id %}" method="post">
    {% csrf_token %}

    <div class="sheet-row">
      <label class="flex flex-col gap-1">
        <span class="label">日付</span>
        <input name="date" type="date" value="{{ prefill.date|date:'Y-m-d' }}" class="in" />
      </label>
      <label class="flex flex-col gap-1">
        <span class="label">数量</span>
        <input name="qty" type="number"
               min="1"
               max="{{ h.quantity }}"
               value="{{ prefill.qty }}"
               class="in" />
        <small class="text-xs text-slate-500">保有: {{ h.quantity }}</small>
      </label>
    </div>

    <label class="flex flex-col gap-1 mt-3">
      <span class="label">売却単価</span>
      <input name="price" inputmode="decimal" step="0.01" placeholder="例: 1234.5" class="in" />
    </label>

    <div class="sheet-row mt-3">
      <label class="flex flex-col gap-1">
        <span class="label">手数料</span>
        <input name="fee" inputmode="decimal" step="0.01" value="{{ prefill.fee }}" class="in" />
      </label>
      <label class="flex flex-col gap-1">
        <span class="label">税</span>
        <input name="tax" inputmode="decimal" step="0.01" value="{{ prefill.tax }}" class="in" />
      </label>
    </div>

    <label class="flex flex-col gap-1 mt-3">
      <span class="label">メモ</span>
      <input name="memo" placeholder="任意メモ" class="in" />
    </label>

    <div class="grid grid-cols-2 gap-2 mt-4">
      <button type="button" class="btn-ghost" data-dismiss="sheet">キャンセル</button>
      <button class="btn-primary">売却を記録</button>
    </div>

    {# 互換のために hidden を付けておく（ビューが読むなら使われる／読まないなら無視される） #}
    <input type="hidden" name="side" value="SELL">
    <input type="hidden" name="ticker" value="{{ h.ticker }}">
    <input type="hidden" name="name" value="{{ h.name|default:'' }}">
    <input type="hidden" name="broker" value="{{ prefill.broker|default:'OTHER' }}">
    <input type="hidden" name="account" value="{{ prefill.account|default:'SPEC' }}">
    <input type="hidden" name="cashflow" value="">
  </form>
</div>