{% load humanize %}
<style>
  .period-wrap{margin-top:14px}
  .period-head{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-bottom:8px}
  .btn{font-size:12px;padding:6px 10px;border:1px solid rgba(255,255,255,.12);border-radius:8px;background:transparent;color:#e5e7eb}
  .btn[aria-current="true"]{background:rgba(255,255,255,.10)}
  .tbl{width:100%;border-collapse:separate;border-spacing:0}
  .tbl th,.tbl td{padding:8px 10px;border-bottom:1px solid rgba(255,255,255,.08)}
  .tbl thead th{font-size:12px;color:#a7b1d8;text-align:right}
  .tbl thead th:first-child,.tbl tbody td:first-child{text-align:left}
  .pos{color:#86efac} .neg{color:#fca5a5}
</style>

<div class="period-wrap">
  <div class="period-head">
    <div style="font-size:12px;color:#a7b1d8">æœŸé–“ã¾ã¨ã‚</div>

    <!-- ãƒ—ãƒªã‚»ãƒƒãƒˆ -->
    <button class="btn"
            hx-get="{% url 'realized_summary_period' %}?preset=THIS_MONTH&freq={{ freq }}&q={{ q|urlencode }}"
            hx-target="#periodTable" hx-select="#periodTable" hx-swap="outerHTML"
            aria-current="{% if preset == 'THIS_MONTH' %}true{% else %}false{% endif %}">
      ä»Šæœˆ
    </button>
    <button class="btn"
            hx-get="{% url 'realized_summary_period' %}?preset=THIS_YEAR&freq={{ freq }}&q={{ q|urlencode }}"
            hx-target="#periodTable" hx-select="#periodTable" hx-swap="outerHTML"
            aria-current="{% if preset == 'THIS_YEAR' %}true{% else %}false{% endif %}">
      ä»Šå¹´
    </button>
    <button class="btn"
            hx-get="{% url 'realized_summary_period' %}?preset=LAST_12M&freq={{ freq }}&q={{ q|urlencode }}"
            hx-target="#periodTable" hx-select="#periodTable" hx-swap="outerHTML"
            aria-current="{% if preset == 'LAST_12M' %}true{% else %}false{% endif %}">
      éå»12ãƒ¶æœˆ
    </button>

    <!-- ç²’åº¦ -->
    <button class="btn"
            hx-get="{% url 'realized_summary_period' %}?preset={{ preset }}&freq=month&q={{ q|urlencode }}"
            hx-target="#periodTable" hx-select="#periodTable" hx-swap="outerHTML"
            aria-current="{% if freq == 'month' %}true{% else %}false{% endif %}">
      æœˆæ¬¡
    </button>
    <button class="btn"
            hx-get="{% url 'realized_summary_period' %}?preset={{ preset }}&freq=year&q={{ q|urlencode }}"
            hx-target="#periodTable" hx-select="#periodTable" hx-swap="outerHTML"
            aria-current="{% if freq == 'year' %}true{% else %}false{% endif %}">
      å¹´æ¬¡
    </button>
  </div>

  <div id="periodTable">
    <table class="tbl">
      <thead>
        <tr>
          <th>æœŸé–“</th>
          <th>ä»¶æ•°</th>
          <th>æ•°é‡</th>
          <th>æ‰‹æ•°æ–™</th>
          <th>ğŸ’°ç¾é‡‘(ç¾ç‰©)</th>
          <th>ğŸ’°ç¾é‡‘(ä¿¡ç”¨)</th>
          <th>ğŸ’°ç¾é‡‘(åˆè¨ˆ)</th>
          <th>ğŸ“ˆPnL</th>
        </tr>
      </thead>
      <tbody class="text-[15px]">
        {% if rows %}
          {% for r in rows %}
            <tr>
              <td>{{ r.label }}</td>
              <td style="text-align:right">{{ r.n|intcomma }}</td>
              <td style="text-align:right">{{ r.qty|intcomma }}</td>
              <td style="text-align:right">Â¥{{ r.fee|floatformat:0|intcomma }}</td>
              <td style="text-align:right">
                {% with v=r.cash_spec %}
                  <span class="{% if v >= 0 %}pos{% else %}neg{% endif %}">Â¥{{ v|floatformat:0|intcomma }}</span>
                {% endwith %}
              </td>
              <td style="text-align:right">
                {% with v=r.cash_margin %}
                  <span class="{% if v >= 0 %}pos{% else %}neg{% endif %}">Â¥{{ v|floatformat:0|intcomma }}</span>
                {% endwith %}
              </td>
              <td style="text-align:right">
                {% with v=r.cash_total %}
                  <span class="{% if v >= 0 %}pos{% else %}neg{% endif %}">Â¥{{ v|floatformat:0|intcomma }}</span>
                {% endwith %}
              </td>
              <td style="text-align:right">
                {% with v=r.pnl %}
                  <span class="{% if v >= 0 %}pos{% else %}neg{% endif %}">Â¥{{ v|floatformat:0|intcomma }}</span>
                {% endwith %}
              </td>
            </tr>
          {% endfor %}
        {% else %}
          <tr><td colspan="8" style="color:#94a3b8">ãƒ‡ãƒ¼ã‚¿ãªã—</td></tr>
        {% endif %}
      </tbody>
    </table>
  </div>
</div>