<!-- templates/realized/_summary.html -->
{% load humanize %}
<style>
  /* ==== Summary scoped style (HTMXで差し替え時にも効くよう局所定義) ==== */
  .sum-grid{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:12px}
  @media (max-width:760px){.sum-grid{grid-template-columns:repeat(2,minmax(0,1fr))}}
  .sum-card{
    background:rgba(255,255,255,.06);
    border:1px solid rgba(255,255,255,.10);
    border-radius:14px; padding:12px 14px;
  }
  .sum-k{font-size:12px; color:#b9c3dd; display:flex; align-items:center; gap:6px; white-space:nowrap}
  .sum-v{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;
         font-variant-numeric:tabular-nums; font-size:20px; font-weight:700;
         color:#e8ecff; margin-top:4px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis}
  .sum-v.positive{color:#34d399}  /* emerald-400 */
  .sum-v.negative{color:#f87171}  /* rose-400 */
  .nowrap{white-space:nowrap}
</style>

<!-- templates/realized/_summary.html -->
<div class="summary-grid">
  <div class="sum-card">
    <div class="k">件数</div>
    <div class="v">{{ agg.n }}</div>
  </div>

  <div class="sum-card">
    <div class="k">数量合計</div>
    <div class="v">{{ agg.qty }}</div>
  </div>

  <div class="sum-card">
    <div class="k">手数料</div>
    <div class="v">¥{{ agg.fee|floatformat:0|intcomma }}</div>
  </div>

  <!-- 💰 実損（現金ベース） -->
  <div class="sum-card">
    <div class="k">💰 実損合計</div>
    <div class="v {% if agg.cashflow_sum < 0 %}negative{% else %}positive{% endif %}">
      ¥{{ agg.cashflow_sum|floatformat:0|intcomma }}
    </div>
  </div>

  <!-- 📈 投資家PnL累計 -->
  <div class="sum-card">
    <div class="k">📈 PnL累計</div>
    <div class="v {% if agg.pnl_sum < 0 %}negative{% else %}positive{% endif %}">
      ¥{{ agg.pnl_sum|floatformat:0|intcomma }}
    </div>
  </div>
</div>