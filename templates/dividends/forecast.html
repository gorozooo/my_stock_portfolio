{% extends "base.html" %}
{% load static %}
{% block title %}配当予測{% endblock %}

{% block head %}
<style>
  .wrap{max-width:980px;margin:0 auto}
  .filters{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin:6px 0 10px}
  .filters select{
    padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,.14);
    background:rgba(255,255,255,.06);color:#eaf0ff
  }
  .seg{display:flex;gap:6px;flex-wrap:wrap}
  .pill{
    border:1px solid rgba(255,255,255,.14);
    background:rgba(255,255,255,.06);
    color:#cfd7ff;border-radius:999px;padding:8px 14px;font-weight:600
  }
  .pill.is-active{background:rgba(66,133,244,.18);border-color:rgba(66,133,244,.45);color:#eaf0ff}

  .card{
    border:1px solid rgba(255,255,255,.10);background:rgba(255,255,255,.03);
    border-radius:14px;padding:12px
  }

  /* 🔧 ここが重要：親に固定高さ、canvas は絶対配置 */
  .chartbox{position:relative;height:260px}
  #fcChart{position:absolute;inset:0;display:block;width:100%;height:100%}

  .legend-row{display:flex;justify-content:space-between;align-items:center;margin-top:8px}
  .avg{color:#cfd7ff;font-weight:700}
</style>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
{% endblock %}

{% block content %}
<div class="wrap">
  <h1 class="text-xl font-semibold mb-3">配当予測（12ヶ月）</h1>

  <div class="filters">
    <select id="fYear">
      {% for y in year_options %}
        <option value="{{ y }}" {% if year == y %}selected{% endif %}>{{ y }}</option>
      {% endfor %}
    </select>

    <div class="seg" id="segBasis" role="tablist" aria-label="集計基準">
      <button type="button" class="pill is-active" data-v="pay"  role="tab" aria-selected="true">支払い月</button>
      <button type="button" class="pill"         data-v="ex"   role="tab" aria-selected="false">権利確定月</button>
    </div>

    <div class="seg" id="segStack" role="tablist" aria-label="表示軸">
      <button type="button" class="pill is-active" data-v="none"    role="tab" aria-selected="true">合計</button>
      <button type="button" class="pill"           data-v="broker"  role="tab" aria-selected="false">証券会社</button>
      <button type="button" class="pill"           data-v="account" role="tab" aria-selected="false">口座</button>
    </div>
  </div>

  <div class="card">
    <div class="chartbox"><canvas id="fcChart"></canvas></div>
    <div class="legend-row">
      <div id="fcLegend"></div>
      <div class="avg" id="fcAvg"></div>
    </div>
  </div>
</div>

<script src="{% static 'js/dividends_forecast.js' %}?v=12"></script>
<script>
  window.__DIVFC_INIT__ = {{ payload_json|safe }};
  window.__DIVFC_YEAR__ = {{ year }};
</script>
{% endblock %}