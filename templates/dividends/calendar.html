{% extends "base.html" %}
{% load static %}
{% block title %}配当カレンダー{% endblock %}

{% block head %}
<style>
  .wrap{max-width:960px;margin:0 auto}
  .bar{display:grid;gap:8px;grid-template-columns:1fr 1fr 1fr 1fr}
  @media (max-width:760px){ .bar{grid-template-columns:1fr 1fr} }
  .bar select,.bar button{padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,.15);background:rgba(255,255,255,.06);color:#eaf0ff}
  .cal{margin-top:12px;border:1px solid rgba(255,255,255,.1);border-radius:12px;overflow:hidden}
  .cal .grid{display:grid;grid-template-columns:repeat(7,1fr);gap:1px;background:rgba(255,255,255,.08)}
  .cal .cell{background:rgba(255,255,255,.02);min-height:88px;padding:6px;position:relative}
  .cal .dow{background:rgba(255,255,255,.06);text-align:center;padding:8px 0;font-size:12px;color:#aeb6cc}
  .badge{position:absolute;right:6px;bottom:6px;font-size:12px;border-radius:999px;padding:2px 8px;background:rgba(110,168,255,.18);border:1px solid rgba(110,168,255,.4)}
  .muted{font-size:12px;color:#9aa4b2;margin-top:6px}
  /* modal */
  .modal-mask{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;z-index:10010}
  .modal{background:#121522;border:1px solid rgba(255,255,255,.12);border-radius:12px;max-width:520px;width:92%;padding:12px}
  .row{display:flex;justify-content:space-between;padding:8px;border:1px solid rgba(255,255,255,.1);border-radius:8px;margin:6px 0}
</style>
{% endblock %}

{% block content %}
<div class="wrap">
  <h1 class="text-xl font-semibold mb-3">配当カレンダー</h1>
  <form class="bar" id="calForm">
    <select id="year">
      {% for y in year_options %}
        <option value="{{ y }}" {% if flt.year == y %}selected{% endif %}>{{ y }}</option>
      {% endfor %}
    </select>
    <select id="month" name="month">
      <option value="">月(すべて)</option>
      {% for m in month_options %}
        <option value="{{ m }}" {% if flt.month == m|stringformat:"s" %}selected{% endif %}>{{ m }}</option>
      {% endfor %}
    </select>
    <select id="broker">
      <option value="">証券会社(すべて)</option>
      {% for v,l in BROKERS %}<option value="{{ v }}">{{ l }}</option>{% endfor %}
    </select>
    <select id="account">
      <option value="">口座(すべて)</option>
      {% for v,l in ACCOUNTS %}<option value="{{ v }}">{{ l }}</option>{% endfor %}
    </select>
  </form>

  <div class="cal">
    <div class="grid" id="dow">
      <div class="dow">日</div><div class="dow">月</div><div class="dow">火</div><div class="dow">水</div><div class="dow">木</div><div class="dow">金</div><div class="dow">土</div>
    </div>
    <div class="grid" id="calGrid"></div>
  </div>
  <div class="muted">セルのバッジをタップでその日の明細を表示します。</div>
</div>

<div class="modal-mask" id="modalMask" role="dialog" aria-modal="true">
  <div class="modal">
    <h2 id="modalTitle" class="text-lg font-semibold mb-2"></h2>
    <div id="modalBody"></div>
  </div>
</div>

<script>
  // month options
  (function(){
    const msel = document.getElementById('month');
    const cur = {{ flt.month|default:1 }};
    for(let m=1;m<=12;m++){
      const o = document.createElement('option');
      o.value = m; o.textContent = m;
      if(m===cur) o.selected=true;
      msel.appendChild(o);
    }
  })();
</script>
<script src="{% static 'js/dividends_calendar.js' %}?v=1" defer></script>
{% endblock %}