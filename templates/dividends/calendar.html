{% extends "base.html" %}
{% load static %}
{% block title %}配当カレンダー{% endblock %}

{% block head %}
<style>
  .toolbar{display:grid;grid-template-columns:1fr 1fr;gap:12px;max-width:960px;margin:0 auto 12px}
  .toolbar select{width:100%;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,.14);
                  background:rgba(255,255,255,.06);color:#eaf0ff}

  .calwrap{max-width:960px;margin:0 auto}
  .dow{display:grid;grid-template-columns:repeat(7,1fr);gap:6px;margin:10px 0 6px}
  .dow div{padding:10px;text-align:center;color:#9aa4b2;border-radius:10px;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08)}
  .grid{display:grid;grid-template-columns:repeat(7,1fr);grid-auto-rows:100px;gap:6px}
  .cell{position:relative;border-radius:12px;background:#202635;border:1px solid rgba(255,255,255,.08);padding:10px}
  .cell .d{color:#cfd6e6;font-size:16px;font-weight:700}
  .badge{position:absolute;right:8px;bottom:8px;padding:4px 8px;border-radius:999px;background:rgba(69,118,221,.18);
         border:1px solid rgba(69,118,221,.45);font-size:12px}
  .list{position:absolute;left:8px;bottom:8px;font-size:11px;color:#9aa4b2}
</style>
{% endblock %}

{% block content %}
<h1 class="text-xl font-semibold mb-3">配当カレンダー</h1>

<div class="toolbar" id="calbar">
  <select id="selYear">
    {% for y in year_options %}
      <option value="{{ y }}" {% if year == y %}selected{% endif %}>{{ y }}</option>
    {% endfor %}
  </select>
  <select id="selMonth">
    {% for m in month_options %}
      <option value="{{ m }}" {% if month == m %}selected{% endif %}>{{ m }}</option>
    {% endfor %}
  </select>

  <select id="selBroker" style="grid-column:1/-1">
    <option value="">証券会社(すべて)</option>
    {% for v,l in BROKERS %}
      <option value="{{ v }}" {% if flt.broker == v %}selected{% endif %}>{{ l }}</option>
    {% endfor %}
  </select>
  <select id="selAccount" style="grid-column:1/-1">
    <option value="">口座(すべて)</option>
    {% for v,l in ACCOUNTS %}
      <option value="{{ v }}" {% if flt.account == v %}selected{% endif %}>{{ l }}</option>
    {% endfor %}
  </select>
</div>

<div class="calwrap">
  <div class="dow">
    <div>日</div><div>月</div><div>火</div><div>水</div><div>木</div><div>金</div><div>土</div>
  </div>
  <div class="grid" id="calGrid" data-year="{{ year }}" data-month="{{ month }}"></div>
  <div class="text-slate-400 mt-2">セルのバッジをタップでその日の明細を表示します。</div>
</div>

<script>
  // 初期ペイロード（バックエンドで作ってある）
  window.__CAL_INIT__ = {{ payload_json|safe }};
</script>
<script src="{% static 'js/dividends_calendar.js' %}?v=5"></script>
{% endblock %}