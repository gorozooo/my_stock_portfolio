{% extends "base.html" %}
{% load static %}
{% block title %}配当一覧{% endblock %}

{% block head %}
<style>
  .kpis{display:grid;gap:14px;grid-template-columns:1fr 1fr}
  .kpi{border:1px solid rgba(255,255,255,.09);background:rgba(255,255,255,.04);border-radius:16px;padding:14px}
  .kpi .lbl{font-size:12px;color:#9aa4b2;margin-bottom:6px}
  .kpi .val{font-size:24px;font-weight:700;letter-spacing:.4px}

  /* ===== swipe cards ===== */
  .list{margin-top:16px;display:grid;gap:14px}
  [data-swipe]{position:relative;border:1px solid rgba(255,255,255,.09);background:rgba(255,255,255,.04);border-radius:16px;overflow:hidden}
  [data-swipe] .track{padding:16px}
  [data-swipe] .actions{
    position:absolute; inset:0 0 0 auto; width:220px; display:flex;
    transform:translateX(100%); transition:transform .18s ease;
  }
  [data-swipe] .actions .item{
    width:110px; display:flex; align-items:center; justify-content:center;
    font-weight:700; letter-spacing:.2px;
  }
  [data-swipe] .actions .edit{background:rgba(255,255,255,.10); border-left:1px solid rgba(255,255,255,.08)}
  [data-swipe] .actions .delete{background:#7f232c;border-left:1px solid rgba(255,255,255,.08)}
  [data-swipe].is-open .actions{transform:translateX(0)}
  .meta-row{display:flex;flex-wrap:wrap;gap:8px;margin:8px 0}
  .chip{padding:6px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.16);background:rgba(255,255,255,.06);color:#e6ebff;font-size:13px}
  .net{font-size:24px;font-weight:800;text-align:right;margin-top:8px}
  .sub{color:#9aa4b2;font-size:13px;text-align:right}
</style>
{% endblock %}

{% block content %}
<h1 class="text-xl font-semibold mb-3">配当一覧</h1>

<div class="kpis">
  <div class="kpi"><div class="lbl">件数</div><div class="val">{{ stats.count|default:0 }} 件</div></div>
  <div class="kpi"><div class="lbl">税引前合計</div><div class="val">{{ stats.gross_sum|floatformat:2 }}</div></div>
  <div class="kpi"><div class="lbl">税額合計</div><div class="val">{{ stats.tax_sum|floatformat:2 }}</div></div>
  <div class="kpi"><div class="lbl">税引後合計</div><div class="val">{{ stats.net_sum|floatformat:2 }}</div></div>
</div>

<div class="list">
  {% for d in items %}
  <div class="row" data-swipe>
    <!-- 操作用パネル（右側） -->
    <div class="actions">
      <a class="item edit" href="{% url 'dividend_edit' d.id %}">編集</a>
      <form class="item delete" method="post" action="{% url 'dividend_delete' d.id %}"
            onsubmit="return confirm('削除してよろしいですか？');">
        {% csrf_token %}
        <button type="submit" style="all:unset;cursor:pointer;font:inherit;color:inherit">削除</button>
      </form>
    </div>

    <!-- 表示面 -->
    <div class="track">
      <div class="title text-lg font-semibold mb-1">
        {{ d.display_ticker }} / {{ d.display_name }}
      </div>
      <div class="date text-sm text-slate-400 mb-2">{{ d.date }}</div>

      <div class="meta-row">
        {% if d.broker %}<span class="chip">証券: {{ d.get_broker_display }}</span>{% endif %}
        {% if d.account %}<span class="chip">口座: {{ d.get_account_display }}</span>{% endif %}
        {% if d.quantity %}<span class="chip">株数: {{ d.quantity }}</span>{% endif %}
        {% if d.purchase_price %}<span class="chip">取得単価: {{ d.purchase_price|floatformat:2 }}</span>{% endif %}
      </div>
      {% if d.memo %}<div class="text-sm mb-2">{{ d.memo }}</div>{% endif %}

      <div class="net">税引後 {{ d.net_amount|floatformat:2 }}</div>
      <div class="sub">税引前 {{ d.gross_amount|floatformat:2 }} ／ 税額 {{ d.tax|default:0|floatformat:2 }}</div>
    </div>
  </div>
  {% empty %}
  <div class="text-slate-400">まだ配当の記録がありません。</div>
  {% endfor %}
</div>

<script src="{% static 'js/dividends.js' %}"></script>
{% endblock %}