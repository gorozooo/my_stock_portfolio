<!-- templates/portfolio/holdings_list.html -->
{% extends "base.html" %}
{% load static %}
{% block title %}保有一覧{% endblock %}

{% block content %}
  <h1 class="text-xl font-semibold mb-4">保有一覧</h1>

  {% if rows %}
    <div class="space-y-3">
      {% for r in rows %}
        <!-- 1カード -->
        <section
          class="rounded-2xl p-4 bg-white/5 ring-1 ring-white/10 shadow"
          data-holding-id="{{ r.id }}"
        >
          <div class="flex items-start justify-between gap-3">
            <div>
              <div class="font-semibold">
                {{ r.ticker }}
                <span class="text-slate-400 text-sm">{{ r.name }}</span>
              </div>
              <div class="text-slate-300 text-sm mt-1">
                数量: {{ r.quantity }} / 平均: ¥{{ r.avg_cost }}
              </div>
            </div>
            <div class="text-right text-xs text-slate-400 shrink-0">
              更新: {{ r.updated_at|date:"Y-m-d H:i" }}
            </div>
          </div>

          <!-- アクション列（HTMXで売却シート表示） -->
          <div class="mt-3 grid grid-cols-3 gap-2 text-sm">
            <!-- 売却（クローズ） -->
            <button
              class="px-3 py-2 rounded-lg bg-rose-500/15 hover:bg-rose-500/25 text-rose-200 ring-1 ring-rose-400/25 transition"
              hx-get="{% url 'holding_close_sheet' r.id %}"
              hx-target="#sheetRoot"
              hx-swap="innerHTML"
              aria-label="売却（クローズ）"
            >
              💱 売却（クローズ）
            </button>

            <!-- 詳細（任意の詳細ページがあれば差し替え） -->
            <a
              href="{% url 'holdings_list' %}?q={{ r.ticker }}"
              class="px-3 py-2 rounded-lg bg-white/10 hover:bg-white/20 text-slate-200 ring-1 ring-white/10 text-center transition"
            >
              🔍 詳細
            </a>

            <!-- CSV等の今後のアクション用プレースホルダ（必要なければ削除OK） -->
            <a
              href="{% url 'realized_list' %}?ticker={{ r.ticker|urlencode }}"
              class="px-3 py-2 rounded-lg bg-indigo-500/15 hover:bg-indigo-500/25 text-indigo-200 ring-1 ring-indigo-400/25 text-center transition"
            >
              📄 実損を見る
            </a>
          </div>

          <!-- JSが無効でも移動できるフォールバック -->
          <noscript>
            <div class="mt-2">
              <a
                class="underline text-rose-300"
                href="{% url 'realized_list' %}?ticker={{ r.ticker|urlencode }}&prefill_qty={{ r.quantity }}"
              >JSなしで売却入力へ</a>
            </div>
          </noscript>
        </section>
      {% endfor %}
    </div>
  {% else %}
    <div class="rounded-2xl p-4 bg-white/5 ring-1 ring-white/10 shadow">
      <div class="text-slate-300">まだデータがありません。</div>
      <div class="text-slate-400 text-sm mt-1">管理画面から追加してください（管理→Holdings）。</div>
    </div>
  {% endif %}

  <!-- 売却シートの差し込み先（HTMXがここへ描画） -->
  <div id="sheetRoot"></div>
{% endblock %}