<!-- templates/portfolio/holdings_list.html -->
{% extends "base.html" %}
{% load static %}
{% block title %}ä¿æœ‰ä¸€è¦§{% endblock %}

{% block content %}
  <h1 class="text-xl font-semibold mb-4">ä¿æœ‰ä¸€è¦§</h1>

  {% if rows %}
    <div class="space-y-3">
      {% for r in rows %}
        <!-- 1ã‚«ãƒ¼ãƒ‰ -->
        <section
          class="rounded-2xl p-4 bg-white/5 ring-1 ring-white/10 shadow"
          data-holding-id="{{ r.id }}"
        >
          <div class="flex items-start justify-between gap-3">
            <div>
              <div class="font-semibold">
                {{ r.ticker }}
                <span class="text-slate-400 text-sm">{{ r.name }}</span>
              </div>
              <div class="text-slate-300 text-sm mt-1">
                æ•°é‡: {{ r.quantity }} / å¹³å‡: Â¥{{ r.avg_cost }}
              </div>
            </div>
            <div class="text-right text-xs text-slate-400 shrink-0">
              æ›´æ–°: {{ r.updated_at|date:"Y-m-d H:i" }}
            </div>
          </div>

          <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³åˆ—ï¼ˆHTMXã§å£²å´ã‚·ãƒ¼ãƒˆè¡¨ç¤ºï¼‰ -->
          <div class="mt-3 grid grid-cols-3 gap-2 text-sm">
            <!-- å£²å´ï¼ˆã‚¯ãƒ­ãƒ¼ã‚ºï¼‰ -->
            <button
              class="px-3 py-2 rounded-lg bg-rose-500/15 hover:bg-rose-500/25 text-rose-200 ring-1 ring-rose-400/25 transition"
              hx-get="{% url 'holding_close_sheet' r.id %}"
              hx-target="#sheetRoot"
              hx-swap="innerHTML"
              aria-label="å£²å´ï¼ˆã‚¯ãƒ­ãƒ¼ã‚ºï¼‰"
            >
              ğŸ’± å£²å´ï¼ˆã‚¯ãƒ­ãƒ¼ã‚ºï¼‰
            </button>

            <!-- è©³ç´°ï¼ˆä»»æ„ã®è©³ç´°ãƒšãƒ¼ã‚¸ãŒã‚ã‚Œã°å·®ã—æ›¿ãˆï¼‰ -->
            <a
              href="{% url 'holdings_list' %}?q={{ r.ticker }}"
              class="px-3 py-2 rounded-lg bg-white/10 hover:bg-white/20 text-slate-200 ring-1 ring-white/10 text-center transition"
            >
              ğŸ” è©³ç´°
            </a>

            <!-- CSVç­‰ã®ä»Šå¾Œã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ç”¨ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ï¼ˆå¿…è¦ãªã‘ã‚Œã°å‰Šé™¤OKï¼‰ -->
            <a
              href="{% url 'realized_list' %}?ticker={{ r.ticker|urlencode }}"
              class="px-3 py-2 rounded-lg bg-indigo-500/15 hover:bg-indigo-500/25 text-indigo-200 ring-1 ring-indigo-400/25 text-center transition"
            >
              ğŸ“„ å®Ÿæã‚’è¦‹ã‚‹
            </a>
          </div>

          <!-- JSãŒç„¡åŠ¹ã§ã‚‚ç§»å‹•ã§ãã‚‹ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ -->
          <noscript>
            <div class="mt-2">
              <a
                class="underline text-rose-300"
                href="{% url 'realized_list' %}?ticker={{ r.ticker|urlencode }}&prefill_qty={{ r.quantity }}"
              >JSãªã—ã§å£²å´å…¥åŠ›ã¸</a>
            </div>
          </noscript>
        </section>
      {% endfor %}
    </div>
  {% else %}
    <div class="rounded-2xl p-4 bg-white/5 ring-1 ring-white/10 shadow">
      <div class="text-slate-300">ã¾ã ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</div>
      <div class="text-slate-400 text-sm mt-1">ç®¡ç†ç”»é¢ã‹ã‚‰è¿½åŠ ã—ã¦ãã ã•ã„ï¼ˆç®¡ç†â†’Holdingsï¼‰ã€‚</div>
    </div>
  {% endif %}

  <!-- å£²å´ã‚·ãƒ¼ãƒˆã®å·®ã—è¾¼ã¿å…ˆï¼ˆHTMXãŒã“ã“ã¸æç”»ï¼‰ -->
  <div id="sheetRoot"></div>
{% endblock %}