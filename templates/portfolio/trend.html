<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta
    name="viewport"
    content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
  <title>銘柄トレンド判定</title>
  <script src="https://unpkg.com/htmx.org@1.9.12"></script>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial; margin:16px; }
    .row { display:flex; gap:8px; }
    input[type=text]{ flex:1; font-size:16px; padding:12px; border:1px solid #ddd; border-radius:12px; }
    button{ padding:12px 16px; font-size:16px; border:none; border-radius:12px; background:#111; color:#fff; }
    .card{ margin-top:12px; border:1px solid #eee; border-radius:16px; padding:16px; box-shadow:0 2px 8px rgba(0,0,0,.06);}
    .tag{ display:inline-block; padding:4px 10px; border-radius:999px; font-size:12px; }
    .up{ background:#e6ffed; color:#057a55; }
    .down{ background:#ffecec; color:#b00020; }
    .flat{ background:#f5f5f5; color:#555; }
    .sub{ color:#666; font-size:12px; }

    /* suggest list */
    .suggest { margin-top:8px; border:1px solid #eee; border-radius:12px; overflow:hidden; }
    .suggest-item { display:flex; justify-content:space-between; align-items:center; padding:10px 12px; background:#fff; }
    .suggest-item + .suggest-item { border-top:1px solid #eee; }
    .suggest-name { font-weight:600; }
    .suggest-code { font-size:12px; color:#777; }
    .suggest-btn { padding:6px 10px; font-size:13px; border:none; border-radius:999px; background:#111; color:#fff; }
  </style>
</head>
<body>
  <h2>銘柄トレンド判定</h2>

  <div class="row">
    <!-- 入力値はサジェスト用に name="q" を付与 -->
    <input
      id="ticker"
      name="q"
      type="text"
      placeholder="例: 8058 / 7203 / 167A（.T は自動付与）"
      <!-- Enterで即判定 -->
      hx-get="/trend/card"
      hx-target="#result"
      hx-trigger="keyup[key=='Enter']"
      hx-vals='js:{"ticker": document.getElementById("ticker").value.trim()}'
    >
    <button
      hx-get="/trend/card"
      hx-target="#result"
      hx-indicator="#loading"
      hx-vals='js:{"ticker": document.getElementById("ticker").value.trim()}'>
      判定
    </button>
  </div>

  <!-- サジェスト（コード前方一致 / 日本語名部分一致） -->
  <div id="suggest"
       class="suggest"
       hx-get="/api/suggest"
       hx-trigger="keyup changed delay:250ms from:#ticker"
       hx-include="#ticker"   <!-- name=q を送る -->
       hx-params="q"
       hx-target="#suggest"
       hx-swap="innerHTML">
  </div>

  <div id="loading" class="sub" style="display:none;" hx-ext="class-tools">Loading...</div>

  <!-- 判定結果の差し替え先 -->
  <div id="result" class="card"></div>

  <!-- 参考: _suggest.html が返す断片の想定（サーバ側テンプレート） -->
  <!--
  {% if items %}
    {% for code,name in items %}
      <div class="suggest-item">
        <div>
          <div class="suggest-name">{{ name }}</div>
          <div class="suggest-code">{{ code }}.T</div>
        </div>
        <button class="suggest-btn"
                hx-get="/trend/card?ticker={{ code }}"
                hx-target="#result"
                hx-swap="innerHTML"
                hx-on="click: document.querySelector('#ticker').value='{{ code }}'">
          これで判定
        </button>
      </div>
    {% endfor %}
  {% endif %}
  -->
</body>
</html>