{% extends "base.html" %}
{% block title %}実現損益{% endblock %}
{% block content %}
<h2 class="text-lg font-semibold mb-2">実現損益</h2>

<!-- 追加フォーム（HTMXで送信→テーブルだけリロード） -->
<form id="rt-form" class="grid grid-cols-2 gap-2 mb-3"
      hx-post="{% url 'realized_create' %}"
      hx-on::after-request="this.reset(); htmx.ajax('GET','{% url 'realized_table_partial' %}', {target:'#rt-table', swap:'innerHTML'})">
  {% csrf_token %}
  <input name="trade_at" type="date" class="border rounded px-2 py-1" required>
  <input name="ticker"   placeholder="例: 7203 / AAPL" class="border rounded px-2 py-1" required>
  <select name="side" class="border rounded px-2 py-1">
    <option value="SELL">SELL</option><option value="BUY">BUY</option>
  </select>
  <input name="qty"   type="number" step="1" min="1" class="border rounded px-2 py-1" placeholder="数量" required>
  <input name="price" type="number" step="0.01" min="0" class="border rounded px-2 py-1" placeholder="価格" required>
  <input name="fee"   type="number" step="0.01" min="0" class="border rounded px-2 py-1" placeholder="手数料">
  <input name="tax"   type="number" step="0.01" min="0" class="border rounded px-2 py-1" placeholder="税">
  <input name="memo"  placeholder="メモ" class="border rounded px-2 py-1 col-span-1">
  <button class="bg-indigo-600 text-white rounded px-3 py-1">追加</button>
</form>

<!-- 検索 -->
<div class="mb-2">
  <input id="rt-q" class="border rounded px-2 py-1 w-full" placeholder="ティッカーで検索"
         hx-get="{% url 'realized_table_partial' %}" hx-target="#rt-table" hx-trigger="keyup changed delay:300ms"
         hx-include="#rt-q">
</div>

<!-- 一覧テーブル -->
<div id="rt-table"
     hx-get="{% url 'realized_table_partial' %}"
     hx-trigger="load"
     hx-swap="innerHTML">
  <!-- 部分テンプレが差し込まれる -->
</div>
{% endblock %}