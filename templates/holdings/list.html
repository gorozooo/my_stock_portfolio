{% extends "base.html" %}
{% load static humanize num %}

{% block title %}ä¿æœ‰ä¸€è¦§{% endblock %}

{% block head %}
<link rel="stylesheet" href="{% static 'css/holdings.css' %}?v=3">
{% endblock %}

{% block content %}
<div class="page-head">
  <h1>ä¿æœ‰ä¸€è¦§</h1>
  <a href="{% url 'holding_create' %}" class="btn btn-outline">ï¼‹ æ–°è¦ç™»éŒ²</a>
</div>

{% if page.object_list %}
  <div class="vstack">
    {% for r in page.object_list %}
      {% with h=r.obj %}
      <article class="card row" data-swipe>
        <!-- æ¨ªä¸¦ã³ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="actions">
          <div class="action-panel" onclick="event.stopPropagation()">
            <button type="button" class="item detail" data-action="detail"><span class="ico">ğŸ“„</span><span>è©³ç´°</span></button>
            <a class="item edit" href="{% url 'holding_edit' h.id %}"><span class="ico">âœï¸</span><span>ç·¨é›†</span></a>
            <button class="item delete"
              hx-post="{% url 'holding_delete' h.id %}"
              hx-confirm="å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ"
              hx-target="closest [data-swipe]"
              hx-swap="outerHTML swap:15ms"><span class="ico">ğŸ—‘ï¸</span><span>å‰Šé™¤</span></button>
          </div>
        </div>

        <!-- æœ¬æ–‡ -->
        <div class="track">
          <div class="body">
            <header class="title">
              <div class="name" title="{{ h.name|default:'-' }}">{{ h.name|default:'-' }}</div>

              <!-- ãƒãƒƒã‚¸ + ã‚¹ãƒ‘ãƒ¼ã‚¯ï¼ˆå³ï¼‰ -->
              <div class="meta-row">
                <div class="badges">
                  <span class="badge badge--code">{{ h.ticker }}</span>
                  <span class="badge">{{ h.get_broker_display }}</span>
                  <span class="badge">{{ h.get_account_display }}</span>
                  <span class="badge {% if h.side == 'SELL' %}sell{% else %}buy{% endif %}">{{ h.side }}</span>
                </div>
                <div class="spark-head">
                  {% if r.spark %}
                    <svg class="spark" viewBox="0 0 100 28" preserveAspectRatio="none"
                         data-spark='{{ r.spark|safe }}'
                         data-rate='{{ r.pnl_pct|default:0 }}'></svg>
                  {% endif %}
                </div>
              </div>
            </header>

            <!-- æ•°å€¤4åˆ—ï¼ˆä¸­å¤®è¡¨ç¤ºï¼‰ -->
            <div class="metrics">
              <div class="kv"><div class="k">æ•°é‡</div><div class="v">{{ h.quantity|intcomma }}</div></div>
              <div class="kv"><div class="k">å¹³å‡å–å¾—</div><div class="v">Â¥{{ h.avg_cost|floatformat:0|intcomma }}</div></div>
              <div class="kv">
                <div class="k">å«ã¿æç›Š</div>
                {% if r.pnl is not None %}
                  <div class="v {% if r.pnl >= 0 %}v-gain{% else %}v-loss{% endif %}">Â¥{{ r.pnl|floatformat:0|intcomma }}</div>
                {% else %}<div class="v">â€”</div>{% endif %}
              </div>
              <div class="kv">
                <div class="k">æç›Šç‡</div>
                {% if r.pnl_pct is not None %}
                  <div class="v {% if r.pnl_pct >= 0 %}v-gain{% else %}v-loss{% endif %}">{{ r.pnl_pct|floatformat:2 }}%</div>
                {% else %}<div class="v">â€”</div>{% endif %}
              </div>
            </div>
          </div>

          <!-- è©³ç´° -->
          <div class="more">
            <div class="moregrid">
              <div class="kv"><div class="k">å–å¾—é¡</div><div class="v">Â¥{{ h.quantity|mul:h.avg_cost|floatformat:0|intcomma }}</div></div>
              <div class="kv"><div class="k">ä¿æœ‰é–‹å§‹</div><div class="v">{{ h.opened_at|date:"Y-m-d"|default:"â€”" }}</div></div>
              <div class="kv"><div class="k">ä½œæˆ</div><div class="v">{{ h.created_at|date:"Y-m-d" }}</div></div>
              <div class="kv"><div class="k">æ›´æ–°</div><div class="v">{{ h.updated_at|date:"Y-m-d" }}</div></div>
              {% if h.memo %}<div class="kv" style="grid-column:1/-1"><div class="k">ãƒ¡ãƒ¢</div><div class="v">{{ h.memo }}</div></div>{% endif %}
            </div>
          </div>
        </div>
      </article>
      {% endwith %}
    {% endfor %}
  </div>
{% else %}
  <div class="text-slate-400">ä¿æœ‰ã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚</div>
{% endif %}

<script src="{% static 'js/holdings.js' %}?v=3"></script>
{% endblock %}