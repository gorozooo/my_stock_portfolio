{# templates/holdings/list.html #}
{% extends "base.html" %}
{% load static humanize num %}
{% block title %}保有一覧{% endblock %}

{% block head %}
<style>
  .h-card{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:14px 14px 12px}
  .h-title{display:flex;align-items:center;gap:10px}
  .h-name{font-weight:700;font-size:18px;letter-spacing:.02em}
  .h-code{font-size:12px;color:#9aa4b2}
  .h-badges{display:flex;flex-wrap:wrap;gap:6px;margin-left:8px}
  .h-badge{font-size:11px;padding:3px 8px;border:1px solid rgba(255,255,255,.16);border-radius:9999px;color:#dbe3f4}
  .h-badge.buy{background:rgba(16,185,129,.12);border-color:rgba(16,185,129,.35)}
  .h-badge.sell{background:rgba(244,63,94,.12);border-color:rgba(244,63,94,.35)}
  .h-edit{margin-left:auto}
  .h-edit a{display:inline-block;padding:8px 12px;border-radius:10px;border:1px solid rgba(255,255,255,.18)}
  .h-main{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:10px}
  .h-kv{display:flex;justify-content:space-between;gap:8px;border-top:1px dashed rgba(255,255,255,.07);padding:10px 2px 0}
  .h-kv .k{font-size:12px;color:#97a3b6}
  .h-kv .v{font-size:16px}
  details.h-more{border-top:1px dashed rgba(255,255,255,.08);margin-top:10px;padding-top:10px}
  details.h-more summary{cursor:pointer;list-style:none;display:flex;align-items:center;gap:8px;color:#aeb8cc}
  details.h-more summary::-webkit-details-marker{display:none}
  .h-moregrid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:8px}
  .muted{color:#9aa4b2}
  @media (max-width:480px){
    .h-title{flex-wrap:wrap}
    .h-edit{order:3;width:100%}
    .h-edit a{width:100%;text-align:center}
    .h-main{grid-template-columns:1fr 1fr;gap:8px}
  }
</style>
{% endblock %}

{% block content %}
<div class="fi fi-between" style="margin-bottom:10px">
  <h1>保有一覧</h1>
  <a href="{% url 'holding_create' %}" class="btn btn-outline">＋ 新規登録</a>
</div>

{% if holdings %}
  <div class="vstack" style="gap:14px">
    {% for h in holdings %}
      <article class="h-card">
        {# --- ヘッダ：銘柄名の右にチップ --- #}
        <header class="h-title">
          <div class="h-name">{{ h.name|default:"-" }}</div>
          <div class="h-code">{{ h.ticker }}</div>
          <div class="h-badges">
            <span class="h-badge">{{ h.get_broker_display }}</span>
            <span class="h-badge">{{ h.get_account_display }}</span>
            <span class="h-badge {% if h.side == 'SELL' %}sell{% else %}buy{% endif %}">{{ h.side }}</span>
          </div>
          <div class="h-edit">
            <a href="{% url 'holding_edit' h.id %}">編集</a>
          </div>
        </header>

        {# --- メイン：数量 / 平均取得 / 損益（評価は後日） --- #}
        <div class="h-main">
          <div class="h-kv">
            <div class="k">数量</div>
            <div class="v">{{ h.quantity|intcomma }}</div>
          </div>
          <div class="h-kv">
            <div class="k">平均取得</div>
            <div class="v">¥{{ h.avg_cost|floatformat:0|intcomma }}</div>
          </div>
          <div class="h-kv">
            <div class="k">損益（評価）</div>
            <div class="v muted">—</div> {# TODO: 現在値連動で実装 #}
          </div>
        </div>

        {# --- 詳細（開閉）: 取得額 / 保有開始など --- #}
        <details class="h-more">
          <summary>詳細を表示</summary>
          <div class="h-moregrid">
            <div class="h-kv" style="border-top:none;padding-top:0">
              <div class="k">取得額</div>
              <div class="v">
                ¥{{ h.quantity|mul:h.avg_cost|floatformat:0|intcomma }}
              </div>
            </div>
            <div class="h-kv" style="border-top:none;padding-top:0">
              <div class="k">保有開始</div>
              <div class="v">{{ h.opened_at|date:"Y-m-d"|default:"—" }}</div>
            </div>
            <div class="h-kv">
              <div class="k">作成</div>
              <div class="v">{{ h.created_at|date:"Y-m-d" }}</div>
            </div>
            <div class="h-kv">
              <div class="k">更新</div>
              <div class="v">{{ h.updated_at|date:"Y-m-d" }}</div>
            </div>
          </div>
        </details>
      </article>
    {% endfor %}
  </div>
{% else %}
  <div class="muted">保有はまだありません。</div>
{% endif %}
{% endblock %}