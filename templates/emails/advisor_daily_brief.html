{% load static %}
<!doctype html>
<html lang="ja">
<meta charset="utf-8">
<body style="font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Hiragino Sans','Noto Sans JP',sans-serif;background:#0b1020;color:#e8ecf1;padding:16px;">
  <div style="max-width:820px;margin:0 auto;">
    <h2 style="margin:0 0 8px;font-size:20px;">AI デイリーブリーフ {{ ctx.asof }}</h2>
    <div style="opacity:.8;font-size:12px;margin-bottom:14px;">Generated at {{ ctx.generated_at }}</div>

    <!-- 地合い -->
    <div style="border-radius:12px;padding:12px 14px;background:rgba(255,255,255,.04);margin:8px 0;">
      <div style="font-weight:700;margin-bottom:6px;">地合い（Breadth）</div>
      <div style="display:flex;flex-wrap:wrap;gap:8px;font-size:13px;">
        <span style="padding:6px 10px;border-radius:999px;background:rgba(148,163,184,.15);">Regime: <b>{{ ctx.breadth_view.regime }}</b></span>
        <span style="padding:6px 10px;border-radius:999px;background:rgba(148,163,184,.15);">Score: {{ ctx.breadth_view.score }}</span>
        <span style="padding:6px 10px;border-radius:999px;background:rgba(148,163,184,.15);">A/D: {{ ctx.breadth_view.ad_ratio }}</span>
        <span style="padding:6px 10px;border-radius:999px;background:rgba(148,163,184,.15);">VOL: {{ ctx.breadth_view.vol_ratio }}</span>
        <span style="padding:6px 10px;border-radius:999px;background:rgba(148,163,184,.15);">H-L: {{ ctx.breadth_view.hl_diff }}</span>
      </div>
    </div>

    <!-- 指数 抜粋 -->
    <div style="border-radius:12px;padding:12px 14px;background:rgba(255,255,255,.04);margin:8px 0;">
      <div style="font-weight:700;margin-bottom:6px;">指数スナップショット（抜粋）</div>
      <table style="width:100%;border-collapse:collapse;font-size:13px;">
        <thead>
          <tr>
            <th style="text-align:left;padding:6px 6px;border-bottom:1px solid rgba(255,255,255,.08);">シンボル</th>
            <th style="text-align:right;padding:6px 6px;border-bottom:1px solid rgba(255,255,255,.08);">5日</th>
            <th style="text-align:right;padding:6px 6px;border-bottom:1px solid rgba(255,255,255,.08);">20日</th>
          </tr>
        </thead>
        <tbody>
          {% for sym, row in ctx.indexes.items|slice:":10" %}
          <tr>
            <td style="padding:6px 6px;border-bottom:1px dashed rgba(255,255,255,.06);">{{ sym }}</td>
            <td style="padding:6px 6px;text-align:right;border-bottom:1px dashed rgba(255,255,255,.06);">
              {{ row.ret_5d|default:0.0|floatformat:2 }}
            </td>
            <td style="padding:6px 6px;text-align:right;border-bottom:1px dashed rgba(255,255,255,.06);">
              {{ row.ret_20d|default:0.0|floatformat:2 }}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- セクターRS 上位 -->
    <div style="border-radius:12px;padding:12px 14px;background:rgba(255,255,255,.04);margin:8px 0;">
      <div style="font-weight:700;margin-bottom:6px;">セクターRS（上位10）</div>
      <ol style="margin:6px 0 0 18px;">
        {% for r in ctx.sectors|slice:":10" %}
        <li style="margin:4px 0;">{{ r.sector }}：<b>{{ r.rs|floatformat:2 }}</b></li>
        {% empty %}
        <li>データなし</li>
        {% endfor %}
      </ol>
    </div>

    <!-- 週次通知 -->
    <div style="border-radius:12px;padding:12px 14px;background:rgba(255,255,255,.04);margin:8px 0;">
      <div style="font-weight:700;margin-bottom:6px;">今週の通知サマリ</div>
      <div style="display:flex;gap:10px;flex-wrap:wrap;">
        <div style="border-radius:12px;padding:10px 12px;background:rgba(255,255,255,.05);">
          <div style="opacity:.8;font-size:12px;">通知</div>
          <div style="font-weight:800;font-size:20px;">{{ ctx.week_stats.total }}</div>
        </div>
        <div style="border-radius:12px;padding:10px 12px;background:rgba(255,255,255,.05);">
          <div style="opacity:.8;font-size:12px;">採用</div>
          <div style="font-weight:800;font-size:20px;">{{ ctx.week_stats.taken }}</div>
        </div>
        <div style="border-radius:12px;padding:10px 12px;background:rgba(255,255,255,.05);">
          <div style="opacity:.8;font-size:12px;">採用率</div>
          <div style="font-weight:800;font-size:20px;">{{ ctx.week_stats.rate|floatformat:2 }}</div>
        </div>
      </div>
    </div>

    {% if ctx.notes %}
    <div style="border-radius:12px;padding:12px 14px;background:rgba(255,255,255,.03);margin:10px 0;font-size:12px;">
      <div style="opacity:.8;margin-bottom:6px;">Notes</div>
      <ul style="margin:0 0 0 18px;">
        {% for n in ctx.notes %}<li>{{ n }}</li>{% endfor %}
      </ul>
    </div>
    {% endif %}
  </div>
</body>
</html>