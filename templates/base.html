{% load static %}
<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <title>{% block title %}My Stock{% endblock %}</title>

  <!-- Tailwind CDN（後でビルドに移行） -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- HTMX（deferでOK。DOMContentLoaded後に自動でhx-属性をバインド） -->
  <script src="https://unpkg.com/htmx.org@1.9.12" defer></script>

  <!-- Alpine（必要なら） -->
  <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>

  <!-- PWA -->
  <link rel="manifest" href="/manifest.webmanifest">
  <meta name="theme-color" content="#0b0f1a">
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/service-worker.js').catch(console.error);
      });
    }
  </script>

  <!-- 下タブの専用CSS -->
  <link rel="stylesheet" href="{% static 'css/bottom_tab.css' %}?v=9">

  {% block head %}{% endblock %}
</head>
<body class="bg-slate-950 text-slate-100">
  <main class="max-w-screen-sm mx-auto px-4 pb-24 pt-4">
    {% block content %}{% endblock %}
  </main>

  <!-- 全ページ共通：ボトムシート差し込み先（HTMXターゲット） -->
  <div id="sheetRoot" aria-live="polite"></div>

  <!-- 共通下タブ（マークアップのみ） -->
  {% include "partials/bottom_tab.html" %}

  <!-- 下タブJS -->
  <script src="{% static 'js/bottom_tab.js' %}?v=9"></script>

  <!-- 売却シート配線（外部JSにしているなら static 経由で） -->
  <script src="{% static 'js/realized_close.js' %}"></script>

  <!-- 簡易デバッグ：HTMXのネットワークエラーを拾う（スマホでも気づけるようアラート） -->
  <script>
    document.body.addEventListener('htmx:responseError', function (e) {
      alert('読み込みに失敗しました: ' + (e.detail.xhr && e.detail.xhr.status));
    });
  </script>
</body>
</html>