{% extends "base.html" %}
{% load humanize %}
{% block title %}ç¾é‡‘å°å¸³{% endblock %}

{% block head %}
<style>
  .qb-btn{
    background:rgba(255,255,255,.06);
    border:1px solid rgba(255,255,255,.15);
    border-radius:8px;
    padding:6px 12px;
    color:#e0e8ff;
    font-size:14px;
  }
</style>
{% endblock %}

{% block content %}
<h1>ğŸ’µ ç¾é‡‘å°å¸³</h1>

<form method="get">
  <select name="broker">
    <option value="ALL">ã™ã¹ã¦</option>
    <option value="æ¥½å¤©" {% if params.broker == "æ¥½å¤©" %}selected{% endif %}>æ¥½å¤©</option>
    <option value="æ¾äº•" {% if params.broker == "æ¾äº•" %}selected{% endif %}>æ¾äº•</option>
    <option value="SBI" {% if params.broker == "SBI" %}selected{% endif %}>SBI</option>
  </select>
  <button type="submit" class="qb-btn">é©ç”¨</button>
</form>

{% if summary %}
  <div style="margin:10px 0;">
    ğŸ’°åˆè¨ˆ {{ summary.total|intcomma }}å††ã€€
    å…¥é‡‘ {{ summary.deposit|intcomma }}å††ã€€
    å‡ºé‡‘ {{ summary.withdraw|intcomma }}å††
  </div>
{% endif %}

<div id="historyContainer">
  {% include "cash/_history_list.html" with page=page params=params %}
</div>

<script>
document.addEventListener("click", e=>{
  if(e.target.matches("#loadMoreBtn")){
    const btn=e.target;
    btn.disabled=true;
    btn.textContent="èª­ã¿è¾¼ã¿ä¸­â€¦";
    const next=btn.dataset.next;
    fetch(`{% url 'cash_history_page' %}?page=${next}`)
    .then(r=>r.text())
    .then(html=>{
      btn.insertAdjacentHTML("beforebegin",html);
      btn.remove();
    })
    .catch(()=>{
      btn.textContent="é€šä¿¡ã‚¨ãƒ©ãƒ¼";
      btn.disabled=false;
    });
  }
});
</script>
{% endblock %}