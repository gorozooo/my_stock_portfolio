{% extends "base.html" %}
{% load humanize %}
{% block title %}ç¾é‡‘å°å¸³{% endblock %}

{% block content %}
<h1 class="text-lg font-semibold mb-2">ğŸ’µ ç¾é‡‘å°å¸³</h1>

<!-- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆbroker/kind/æ—¥ä»˜/ãƒ¡ãƒ¢ï¼‰ -->
<form method="get" class="mb-3 rounded-[12px] border border-white/10 bg-white/5 p-3">
  <div class="grid grid-cols-2 gap-2">
    <div>
      <label class="block text-xs text-slate-400 mb-1">è¨¼åˆ¸ä¼šç¤¾</label>
      <select name="broker" class="w-full rounded-md bg-white/10 border border-white/15 p-2 text-sm">
        {% with b=params.broker|default:"ALL" %}
          <option value="ALL"  {% if b == "ALL" %}selected{% endif %}>ã™ã¹ã¦</option>
          <option value="æ¥½å¤©" {% if b == "æ¥½å¤©" %}selected{% endif %}>æ¥½å¤©</option>
          <option value="æ¾äº•" {% if b == "æ¾äº•" %}selected{% endif %}>æ¾äº•</option>
          <option value="SBI" {% if b == "SBI" %}selected{% endif %}>SBI</option>
        {% endwith %}
      </select>
    </div>
    <div>
      <label class="block text-xs text-slate-400 mb-1">ç¨®åˆ¥</label>
      <select name="kind" class="w-full rounded-md bg-white/10 border border-white/15 p-2 text-sm">
        {% with k=params.kind|default:"ALL" %}
          <option value="ALL"      {% if k == "ALL" %}selected{% endif %}>ã™ã¹ã¦</option>
          <option value="DEPOSIT"  {% if k == "DEPOSIT" %}selected{% endif %}>å…¥é‡‘</option>
          <option value="WITHDRAW" {% if k == "WITHDRAW" %}selected{% endif %}>å‡ºé‡‘</option>
          <option value="XFER"     {% if k == "XFER" %}selected{% endif %}>æŒ¯æ›¿</option>
          <option value="SYSTEM"   {% if k == "SYSTEM" %}selected{% endif %}>ã‚·ã‚¹ãƒ†ãƒ </option>
        {% endwith %}
      </select>
    </div>
    <div>
      <label class="block text-xs text-slate-400 mb-1">é–‹å§‹æ—¥</label>
      <input type="date" name="start" value="{{ params.start|default_if_none:'' }}"
             class="w-full rounded-md bg-white/10 border border-white/15 p-2 text-sm">
    </div>
    <div>
      <label class="block text-xs text-slate-400 mb-1">çµ‚äº†æ—¥</label>
      <input type="date" name="end" value="{{ params.end|default_if_none:'' }}"
             class="w-full rounded-md bg-white/10 border border-white/15 p-2 text-sm">
    </div>
    <div class="col-span-2">
      <label class="block text-xs text-slate-400 mb-1">ãƒ¡ãƒ¢æ¤œç´¢</label>
      <div class="flex gap-2">
        <input type="text" name="q" value="{{ params.q|default_if_none:'' }}"
               placeholder="ä¾‹: é…å½“ / REAL:21 ãªã©"
               class="flex-1 rounded-md bg-white/10 border border-white/15 p-2 text-sm">
        <button class="rounded-md border border-white/20 px-3 text-sm">é©ç”¨</button>
        <a href="{% url 'cash_history' %}" class="rounded-md border border-white/10 px-3 text-sm">ã‚¯ãƒªã‚¢</a>
      </div>
    </div>
  </div>

  <!-- å°ã•ãªã‚µãƒãƒªãƒ¼ -->
  {% if summary %}
    <div class="mt-2 text-[12px] text-slate-300">
      åˆè¨ˆ: <span class="font-semibold">{{ summary.total|intcomma }}</span> å††ã€€
      å…¥é‡‘: {{ summary.deposit|intcomma }} å††ã€€
      å‡ºé‡‘: {{ summary.withdraw|intcomma }} å††ã€€
      æŒ¯æ›¿(å…¥): {{ summary.xfer_in|intcomma }} å††ã€€
      æŒ¯æ›¿(å‡º): {{ summary.xfer_out|intcomma }} å††
    </div>
  {% endif %}
</form>

<div id="historyContainer">
  {% include "cash/_history_list.html" with page=page params=params %}
</div>

{% if page.has_next %}
  <div
    hx-get="{% url 'cash_history_page' %}?page={{ page.next_page_number }}&{{ params.urlencode }}"
    hx-trigger="revealed"
    hx-swap="afterend"
    class="text-center text-slate-400 py-3">
    èª­ã¿è¾¼ã¿ä¸­â€¦
  </div>
{% endif %}
{% endblock %}