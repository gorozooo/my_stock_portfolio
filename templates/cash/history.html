{% extends "base.html" %}
{% load humanize %}
{% block title %}ç¾é‡‘å°å¸³{% endblock %}

{% block head %}
<style>
  /* ===== å›ºå®šãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆä¿æœ‰UIãƒ†ã‚¤ã‚¹ãƒˆï¼‰ ===== */
  #cashTop{
    position: sticky;
    top: env(safe-area-inset-top, 0px);
    z-index: 12;
    border: 1px solid rgba(255,255,255,.12);
    border-radius: 12px;
    background: rgba(15,20,30,.96);
    backdrop-filter: blur(8px);
    padding: 10px;
    margin-bottom: 8px;
    box-shadow: 0 2px 0 rgba(255,255,255,.06) inset;
  }

  /* ===== ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆ12ã‚«ãƒ©ãƒ ã§æ˜å¿«&ã¯ã¿å‡ºã—é˜²æ­¢ï¼‰ ===== */
  .filter-grid{
    display: grid;
    grid-template-columns: repeat(12, minmax(0,1fr));
    gap: 8px;
  }
  .fld{ display:flex; flex-direction:column; gap:4px; }
  .fld label{ font-size:11px; color:#9fb0c8 }
  .ctl{
    height: 30px; padding: 0 10px; font-size: 13px;
    color:#dbe3f4; background:rgba(255,255,255,.05);
    border:1px solid rgba(255,255,255,.14); border-radius:8px;
    width: 100%; box-sizing: border-box;
  }
  input[type="date"].ctl{ color-scheme: dark; }
  .btn{
    height: 30px; padding: 0 12px; font-size: 13px;
    color:#dbe3f4; background:rgba(255,255,255,.06);
    border:1px solid rgba(255,255,255,.14); border-radius:8px;
    box-sizing: border-box;
  }
  .btn.ghost{ background:transparent }

  /* ã‚«ãƒ©ãƒ å‰²ã‚Šå½“ã¦ï¼ˆã‚¹ãƒãƒ›1ç”»é¢å‰æï¼‰ */
  .col-6{ grid-column: span 6; }
  .col-12{ grid-column: span 12; }

  /* ãƒœã‚¿ãƒ³è¡Œï¼šå³å¯„ã›ä¸¦åˆ— */
  .btn-row{
    grid-column: 1 / -1;
    display:flex; justify-content:flex-end; gap:8px;
  }

  /* ===== ã‚µãƒãƒªãƒ¼ï¼ˆå‰å›OKã®ã¾ã¾ï¼‰ ===== */
  .sum-wrap{
    display: grid;
    gap: 6px;
    grid-template-columns: repeat(2, 1fr);
    margin-top: 8px;
  }
  .sum-wrap .sum-total{
    grid-column: 1 / -1;
    background: rgba(255,255,255,.07);
    font-weight: 600;
  }
  .pill{
    border: 1px solid rgba(255,255,255,.1);
    border-radius: 8px;
    background: rgba(255,255,255,.05);
    text-align: center;
    padding: 6px 8px;
    font-size: 12px;
    color: #cbd5e1;
  }

  /* ===== ãƒªã‚¹ãƒˆã‚«ãƒ¼ãƒ‰ ===== */
  .card{ border:1px solid rgba(255,255,255,.08); background:rgba(255,255,255,.04);
         border-radius:14px; padding:10px 12px; margin-bottom:10px }
  .amount{ font-size:20px; font-weight:800 }
  .meta{ margin-top:2px; font-size:11px; color:#94a3b8 }
  .memo{ margin-top:2px; font-size:11px; color:#cbd5e1; word-break:break-word }
  .chip{ display:inline-flex; align-items:center; gap:.4em; padding:.25rem .5rem; border-radius:9999px; border:1px solid;
         font-size:11px; line-height:1; white-space:nowrap }
  .chip-sky{border-color:rgba(125,160,255,.35);color:#c7d2fe;background:rgba(125,160,255,.08)}
  .chip-emerald{border-color:rgba(16,185,129,.35);color:#bbf7d0;background:rgba(16,185,129,.08)}
  .actions{ margin-top:6px; display:flex; justify-content:flex-end; gap:6px }
  .actions a,.actions button{ padding:5px 8px; font-size:11px; border-radius:8px; border:1px solid rgba(255,255,255,.2) }
</style>
{% endblock %}

{% block content %}
<h1 class="text-base font-semibold mb-2">ğŸ’µ ç¾é‡‘å°å¸³</h1>

<div id="cashTop">
  <form method="get" class="filter-grid">
    <!-- 1è¡Œç›®ï¼šè¨¼åˆ¸ä¼šç¤¾ / ç¨®åˆ¥ -->
    <div class="fld col-6">
      <label>è¨¼åˆ¸ä¼šç¤¾</label>
      <select name="broker" class="ctl">
        {% with b=params.broker|default:"ALL" %}
          <option value="ALL"  {% if b == "ALL" %}selected{% endif %}>ã™ã¹ã¦</option>
          <option value="æ¥½å¤©" {% if b == "æ¥½å¤©" %}selected{% endif %}>æ¥½å¤©</option>
          <option value="æ¾äº•" {% if b == "æ¾äº•" %}selected{% endif %}>æ¾äº•</option>
          <option value="SBI" {% if b == "SBI" %}selected{% endif %}>SBI</option>
        {% endwith %}
      </select>
    </div>
    <div class="fld col-6">
      <label>ç¨®åˆ¥</label>
      <select name="kind" class="ctl">
        {% with k=params.kind|default:"ALL" %}
          <option value="ALL"      {% if k == "ALL" %}selected{% endif %}>ã™ã¹ã¦</option>
          <option value="DEPOSIT"  {% if k == "DEPOSIT" %}selected{% endif %}>å…¥é‡‘</option>
          <option value="WITHDRAW" {% if k == "WITHDRAW" %}selected{% endif %}>å‡ºé‡‘</option>
          <option value="XFER"     {% if k == "XFER" %}selected{% endif %}>æŒ¯æ›¿</option>
          <option value="SYSTEM"   {% if k == "SYSTEM" %}selected{% endif %}>ã‚·ã‚¹ãƒ†ãƒ </option>
        {% endwith %}
      </select>
    </div>

    <!-- 2è¡Œç›®ï¼šé–‹å§‹æ—¥ / çµ‚äº†æ—¥ï¼ˆåŒä¸€è¡Œã§å¿…ãšåã¾ã‚‹ï¼‰ -->
    <div class="fld col-6">
      <label>é–‹å§‹æ—¥</label>
      <input type="date" name="start" value="{{ params.start|default_if_none:'' }}" class="ctl">
    </div>
    <div class="fld col-6">
      <label>çµ‚äº†æ—¥</label>
      <input type="date" name="end" value="{{ params.end|default_if_none:'' }}" class="ctl">
    </div>

    <!-- 3è¡Œç›®ï¼šãƒ¡ãƒ¢æ¤œç´¢ï¼ˆãƒ•ãƒ«å¹…ï¼‰ -->
    <div class="fld col-12">
      <label>ãƒ¡ãƒ¢æ¤œç´¢</label>
      <input type="text" name="q" value="{{ params.q|default_if_none:'' }}" placeholder="ä¾‹: é…å½“ / REAL:21 ãªã©" class="ctl">
    </div>

    <!-- 4è¡Œç›®ï¼šãƒœã‚¿ãƒ³ï¼ˆå³å¯„ã›æ¨ªä¸¦ã³ï¼‰ -->
    <div class="btn-row">
      <a href="{% url 'cash_history' %}" class="btn ghost">ã‚¯ãƒªã‚¢</a>
      <button class="btn" type="submit">é©ç”¨</button>
    </div>
  </form>

  {% if summary %}
  <!-- â˜… ã‚µãƒãƒªãƒ¼ã¯è§¦ã‚‰ãªã„ï¼ˆå‰å›OKã®ã¾ã¾ï¼‰ -->
  <div class="sum-wrap">
    <div class="pill sum-total">ğŸ’° åˆè¨ˆ {{ summary.total|intcomma }} å††</div>
    <div class="pill">å…¥é‡‘ {{ summary.deposit|intcomma }} å††</div>
    <div class="pill">å‡ºé‡‘ {{ summary.withdraw|intcomma }} å††</div>
    <div class="pill">æŒ¯æ›¿(å…¥) {{ summary.xfer_in|intcomma }} å††</div>
    <div class="pill">æŒ¯æ›¿(å‡º) {{ summary.xfer_out|intcomma }} å††</div>
  </div>
  {% endif %}
</div>

<div id="historyContainer">
  {% include "cash/_history_list.html" with page=page params=params %}
</div>

{% if page.has_next %}
  <div
    hx-get="{% url 'cash_history_page' %}?page={{ page.next_page_number }}&{{ params.urlencode }}"
    hx-trigger="revealed"
    hx-swap="afterend"
    class="text-center text-slate-400 py-2 text-[12px]">
    èª­ã¿è¾¼ã¿ä¸­â€¦
  </div>
{% endif %}
{% endblock %}