{% extends "base.html" %}
{% load static humanize %}
{% block title %}ç¾é‡‘å°å¸³{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/cash.css' %}?v=14">

<style>
  .ledger-wrap{max-width:980px;margin:12px auto 0;padding:8px 12px 120px}
  .toolbar{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:10px}
  .toolbar .row{display:flex;gap:8px}
  .pill{padding:8px 10px;border-radius:10px;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.1);font-size:13px}
  .sum-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:6px;margin:8px 0 12px}
  .sum{padding:8px 10px;border-radius:10px;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);font-size:12px}
  .list{display:flex;flex-direction:column;gap:8px}
  .card{padding:10px 12px;border-radius:14px;background:#0f1422;border:1px solid rgba(255,255,255,.08)}
  .card .head{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
  .amt{font-weight:800;font-size:16px}
  .meta{font-size:12px;opacity:.85}
  .chips{display:flex;gap:6px;flex-wrap:wrap;margin-top:6px}
  .chip{font-size:11px;padding:4px 8px;border-radius:999px;border:1px solid rgba(255,255,255,.18);background:rgba(255,255,255,.06)}
  .chip-sky{border-color:#38bdf8aa;background:#38bdf822}
  .chip-emerald{border-color:#10b981aa;background:#10b98122}
  .pager{display:flex;justify-content:space-between;gap:10px;margin:14px 0}
  .pager a,.pager span{padding:8px 12px;border-radius:10px;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.04);font-size:13px}
</style>

<div class="ledger-wrap">
  <h1 style="margin:6px 2px 10px">ğŸ“’ ç¾é‡‘å°å¸³</h1>

  <!-- ãƒ•ã‚£ãƒ«ã‚¿ -->
  <form method="get" class="toolbar">
    <div class="row">
      <select name="broker" class="pill">
        {% with b=params.broker|default:"ALL" %}
          <option value="ALL" {% if b == "ALL" %}selected{% endif %}>è¨¼åˆ¸ä¼šç¤¾: ã™ã¹ã¦</option>
          <option value="æ¥½å¤©" {% if b == "æ¥½å¤©" %}selected{% endif %}>æ¥½å¤©</option>
          <option value="æ¾äº•" {% if b == "æ¾äº•" %}selected{% endif %}>æ¾äº•</option>
          <option value="SBI" {% if b == "SBI" %}selected{% endif %}>SBI</option>
        {% endwith %}
      </select>
      <select name="kind" class="pill">
        {% with k=params.kind|default:"ALL" %}
          <option value="ALL" {% if k == "ALL" %}selected{% endif %}>ç¨®åˆ¥: ã™ã¹ã¦</option>
          <option value="DEPOSIT" {% if k == "DEPOSIT" %}selected{% endif %}>å…¥é‡‘</option>
          <option value="WITHDRAW" {% if k == "WITHDRAW" %}selected{% endif %}>å‡ºé‡‘</option>
          <option value="XFER" {% if k == "XFER" %}selected{% endif %}>æŒ¯æ›¿</option>
          <option value="SYSTEM" {% if k == "SYSTEM" %}selected{% endif %}>è‡ªå‹•è¨ˆä¸Š</option>
        {% endwith %}
      </select>
    </div>
    <div class="row">
      <input class="pill" type="date" name="start" value="{{ params.start|default_if_none:'' }}">
      <input class="pill" type="date" name="end"   value="{{ params.end|default_if_none:'' }}">
      <input class="pill" type="text" name="q" placeholder="ãƒ¡ãƒ¢æ¤œç´¢" value="{{ params.q|default_if_none:'' }}">
      <button class="pill" type="submit">è¡¨ç¤º</button>
      <a class="pill" href="{% url 'cash_history' %}">ã‚¯ãƒªã‚¢</a>
    </div>
  </form>

  <!-- ã‚µãƒãƒª -->
  <div class="sum-grid">
    <div class="sum">åˆè¨ˆï¼š{{ summary.total|intcomma }} å††</div>
    <div class="sum">å…¥é‡‘ï¼š{{ summary.deposit|intcomma }} å††</div>
    <div class="sum">å‡ºé‡‘ï¼š{{ summary.withdraw|intcomma }} å††</div>
    <div class="sum">æŒ¯æ›¿ï¼š{{ summary.xfer_in|default:0|intcomma }} / {{ summary.xfer_out|default:0|intcomma }} å††</div>
  </div>

  <!-- ä¸€è¦§ï¼ˆ1å›ã ã‘ãƒ«ãƒ¼ãƒ—ï¼‰ -->
  <div class="list">
    {% for r in page.object_list %}
      <div class="card">
        <div class="head">
          <div class="amt">{{ r.amount|intcomma }} å††</div>
          <div class="meta">
            {{ r.at|date:"Yå¹´næœˆjæ—¥" }} |
            å£åº§ï¼š{{ r.account.broker }} / {{ r.account.account_type }} |
            ç¨®åˆ¥ï¼š{{ r.get_kind_display }}
          </div>
        </div>
        {% if r.memo %}
          <div class="meta">ãƒ¡ãƒ¢ï¼š{{ r.memo }}</div>
        {% endif %}
        {% if r.src_badge %}
          <div class="chips">
            <span class="chip {{ r.src_badge.class }}">
              {{ r.src_badge.kind }}ï¼š{{ r.src_badge.label }}
            </span>
          </div>
        {% endif %}
      </div>
    {% empty %}
      <div class="card">è©²å½“ã™ã‚‹å°å¸³ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</div>
    {% endfor %}
  </div>

  <!-- ãƒšãƒ¼ã‚¸ãƒ£ï¼ˆä¸‹ã«1ã¤ã ã‘ï¼‰ -->
  <div class="pager">
    {% if page.has_previous %}
      <a href="?page={{ page.previous_page_number }}{% if params %}&{{ params|urlencode }}{% endif %}">å‰ã¸</a>
    {% else %}
      <span>å‰ã¸</span>
    {% endif %}
    <span>ãƒšãƒ¼ã‚¸ {{ page.number }} / {{ page.paginator.num_pages }}</span>
    {% if page.has_next %}
      <a href="?page={{ page.next_page_number }}{% if params %}&{{ params|urlencode }}{% endif %}">æ¬¡ã¸</a>
    {% else %}
      <span>æ¬¡ã¸</span>
    {% endif %}
  </div>
</div>
{% endblock %}