{% extends "base.html" %}
{% load humanize %}
{% block title %}ç¾é‡‘å°å¸³{% endblock %}

{% block content %}
<style>
  /* --- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼šæ¥µå° & 1è¡Œã«è¿‘ã„é…ç½® --- */
  .form-card{border:1px solid rgba(255,255,255,.08);background:rgba(255,255,255,.04);
             border-radius:12px;padding:10px}
  .form-grid{display:grid;grid-template-columns:repeat(8,1fr);gap:6px;align-items:end}
  .ctl{display:flex;flex-direction:column;gap:2px}
  .ctl label{font-size:10px;color:#94a3b8}
  .inp,.sel,.btn{width:100%;padding:6px 8px;border-radius:8px;border:1px solid rgba(255,255,255,.12);
                 background:rgba(255,255,255,.06);color:#e5e7eb;font-size:12px;line-height:1.1}
  .btn{background:rgba(255,255,255,.08)}
  .btn.ghost{background:transparent;border-color:rgba(255,255,255,.1)}

  /* --- ã‚µãƒãƒªãƒ¼ã¯åˆ¥ã‚«ãƒ¼ãƒ‰ã§1è¡Œãƒãƒƒã‚¸åŒ–ã€‚æŠ˜è¿”ã—OK --- */
  .sum-card{margin-top:8px;border:1px solid rgba(255,255,255,.08);background:rgba(255,255,255,.04);
            border-radius:12px;padding:8px}
  .chips{display:flex;flex-wrap:wrap;gap:8px}
  .chip{padding:6px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.14);
        background:rgba(255,255,255,.06);font-size:12px;color:#dbeafe}

  /* --- ãƒªã‚¹ãƒˆï¼ˆã‚«ãƒ¼ãƒ‰ï¼‰ --- */
  .item{border:1px solid rgba(255,255,255,.10);background:rgba(255,255,255,.04);
        border-radius:16px;padding:10px 12px;margin-top:10px}
  .amt{font-size:24px;font-weight:800}
  .meta{margin-top:2px;font-size:12px;color:#94a3b8}
  .memo{margin-top:2px;font-size:12px;color:#cbd5e1;word-break:break-word}
  .right{display:flex;flex-direction:column;align-items:flex-end;gap:6px}
  .badge{display:inline-flex;align-items:center;gap:6px;padding:4px 8px;border-radius:10px;font-size:12px;
         border:1px solid rgba(125,160,255,.28);background:rgba(125,160,255,.10);color:#dbeafe}
  .badge.g{border-color:rgba(16,185,129,.35);background:rgba(16,185,129,.10);color:#bbf7d0}
  .actions{display:flex;gap:8px}
  .actions a,.actions button{padding:6px 10px;font-size:12px;border-radius:10px;border:1px solid rgba(255,255,255,.2)}
</style>

<h1 class="text-base font-semibold mb-2">ğŸ’µ ç¾é‡‘å°å¸³</h1>

<form method="get" class="form-card">
  <div class="form-grid">
    <div class="ctl" style="grid-column:span 2;">
      <label>è¨¼åˆ¸ä¼šç¤¾</label>
      <select name="broker" class="sel">
        {% with b=params.broker|default:"ALL" %}
          <option value="ALL"  {% if b == "ALL" %}selected{% endif %}>ã™ã¹ã¦</option>
          <option value="æ¥½å¤©" {% if b == "æ¥½å¤©" %}selected{% endif %}>æ¥½å¤©</option>
          <option value="æ¾äº•" {% if b == "æ¾äº•" %}selected{% endif %}>æ¾äº•</option>
          <option value="SBI" {% if b == "SBI" %}selected{% endif %}>SBI</option>
        {% endwith %}
      </select>
    </div>
    <div class="ctl" style="grid-column:span 2;">
      <label>ç¨®åˆ¥</label>
      <select name="kind" class="sel">
        {% with k=params.kind|default:"ALL" %}
          <option value="ALL"      {% if k == "ALL" %}selected{% endif %}>ã™ã¹ã¦</option>
          <option value="DEPOSIT"  {% if k == "DEPOSIT" %}selected{% endif %}>å…¥é‡‘</option>
          <option value="WITHDRAW" {% if k == "WITHDRAW" %}selected{% endif %}>å‡ºé‡‘</option>
          <option value="XFER"     {% if k == "XFER" %}selected{% endif %}>æŒ¯æ›¿</option>
          <option value="SYSTEM"   {% if k == "SYSTEM" %}selected{% endif %}>ã‚·ã‚¹ãƒ†ãƒ </option>
        {% endwith %}
      </select>
    </div>
    <div class="ctl"><label>é–‹å§‹æ—¥</label><input type="date" name="start" value="{{ params.start|default_if_none:'' }}" class="inp"></div>
    <div class="ctl"><label>çµ‚äº†æ—¥</label><input type="date" name="end" value="{{ params.end|default_if_none:'' }}" class="inp"></div>
    <div class="ctl" style="grid-column:span 2;">
      <label>ãƒ¡ãƒ¢æ¤œç´¢</label>
      <input type="text" name="q" value="{{ params.q|default_if_none:'' }}" class="inp" placeholder="ä¾‹: é…å½“ / REAL:21 ãªã©">
    </div>
    <div class="ctl" style="grid-column:span 1;">
      <button class="btn">é©ç”¨</button>
    </div>
    <div class="ctl" style="grid-column:span 1;">
      <a class="btn ghost" href="{% url 'cash_history' %}">ã‚¯ãƒªã‚¢</a>
    </div>
  </div>
</form>

{% if summary %}
  <div class="sum-card">
    <div class="chips">
      <span class="chip">åˆè¨ˆ {{ summary.total|intcomma }} å††</span>
      <span class="chip">å…¥é‡‘ {{ summary.deposit|intcomma }} å††</span>
      <span class="chip">å‡ºé‡‘ {{ summary.withdraw|intcomma }} å††</span>
      <span class="chip">æŒ¯æ›¿(å…¥) {{ summary.xfer_in|intcomma }} å††</span>
      <span class="chip">æŒ¯æ›¿(å‡º) {{ summary.xfer_out|intcomma }} å††</span>
    </div>
  </div>
{% endif %}

<div id="historyContainer">
  {% include "cash/_history_list.html" with page=page params=params %}
</div>

{% if page.has_next %}
  <div
    hx-get="{% url 'cash_history_page' %}?page={{ page.next_page_number }}&{{ params.urlencode }}"
    hx-trigger="revealed"
    hx-swap="afterend"
    class="text-center text-slate-400 py-2 text-[12px]">
    èª­ã¿è¾¼ã¿ä¸­â€¦
  </div>
{% endif %}
{% endblock %}