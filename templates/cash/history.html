{% extends "base.html" %}
{% load humanize %}
{% block title %}現金台帳{% endblock %}

{% block head %}
<style>
  #topSticky{
    position: sticky;
    top: env(safe-area-inset-top, 0px);
    z-index: 12;
    border:1px solid rgba(255,255,255,.12);
    border-radius:12px;
    background:rgba(15,20,30,.96);
    backdrop-filter: blur(8px);
    padding:10px;
    margin-bottom:8px;
    box-shadow:0 2px 0 rgba(255,255,255,.06) inset;
  }

  .filter-grid{
    display:grid;
    grid-template-columns:repeat(12,1fr);
    gap:8px;
  }

  .ctl, .btn{
    height:32px;
    font-size:13px;
    color:#e6ebff;
    background:rgba(255,255,255,.06);
    border:1px solid rgba(255,255,255,.14);
    border-radius:8px;
    padding:0 10px;
    width:100%;
    box-sizing:border-box;
  }
  input[type="date"].ctl{ color-scheme: dark; }
  .btn.ghost{ background:transparent; }

  .col-4{ grid-column: span 4; }
  .col-6{ grid-column: span 6; }
  .col-12{ grid-column: span 12; }

  .btn-row{ grid-column:1 / -1; display:flex; justify-content:flex-end; gap:8px; }

  /* サマリー：前回OKをそのまま */
  .sum-wrap{ display:grid; gap:6px; grid-template-columns:repeat(2,1fr); margin-top:6px }
  .pill{ border:1px solid rgba(255,255,255,.1); background:rgba(255,255,255,.05);
         border-radius:8px; padding:6px 8px; text-align:center; font-size:12px; color:#cbd5e1 }
  .sum-total{ grid-column:1 / -1; background:rgba(255,255,255,.07); font-weight:600 }
</style>
{% endblock %}

{% block content %}
<h1 class="text-base font-semibold mb-2">💵 現金台帳</h1>

<div id="topSticky">
  <form method="get" class="filter-grid">

    <!-- ▼ 1段目：証券会社 / 種別 / メモ検索 -->
    <select name="broker" class="ctl col-4">
      {% with b=params.broker|default:"ALL" %}
        <option value="ALL"  {% if b == "ALL" %}selected{% endif %}>証券会: すべて</option>
        <option value="楽天" {% if b == "楽天" %}selected{% endif %}>楽天</option>
        <option value="松井" {% if b == "松井" %}selected{% endif %}>松井</option>
        <option value="SBI"  {% if b == "SBI" %}selected{% endif %}>SBI</option>
      {% endwith %}
    </select>

    <select name="kind" class="ctl col-4">
      {% with k=params.kind|default:"ALL" %}
        <option value="ALL" {% if k == "ALL" %}selected{% endif %}>種別: すべて</option>
        <option value="DEPOSIT" {% if k == "DEPOSIT" %}selected{% endif %}>入金</option>
        <option value="WITHDRAW" {% if k == "WITHDRAW" %}selected{% endif %}>出金</option>
        <option value="XFER" {% if k == "XFER" %}selected{% endif %}>振替</option>
      {% endwith %}
    </select>

    <input type="text" name="q" placeholder="例: 配当 / 実現益 / REAL:21" value="{{ params.q|default_if_none:'' }}" class="ctl col-4">

    <!-- ▼ 2段目：開始日 / 終了日 -->
    <input type="date" name="start" value="{{ params.start|default_if_none:'' }}" class="ctl col-6">
    <input type="date" name="end"   value="{{ params.end|default_if_none:'' }}" class="ctl col-6">

    <!-- ▼ 3段目：ボタン -->
    <div class="btn-row">
      <a href="{% url 'cash_history' %}" class="btn ghost">クリア</a>
      <button class="btn" type="submit">適用</button>
    </div>

  </form>

  {% if summary %}
    <div class="sum-wrap">
      <div class="pill sum-total">💰 合計 {{ summary.total|intcomma }} 円</div>
      <div class="pill">入金 {{ summary.deposit|intcomma }} 円</div>
      <div class="pill">出金 {{ summary.withdraw|intcomma }} 円</div>
      <div class="pill">振替(入) {{ summary.xfer_in|intcomma }} 円</div>
      <div class="pill">振替(出) {{ summary.xfer_out|intcomma }} 円</div>
    </div>
  {% endif %}
</div>
{% endblock %}