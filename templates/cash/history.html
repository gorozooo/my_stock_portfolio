{% extends "base.html" %}
{% load humanize %}
{% block title %}ç¾é‡‘å°å¸³{% endblock %}

{% block content %}
<style>
  /* ======= æ¥µå°ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼š2åˆ—ã‚°ãƒªãƒƒãƒ‰ï¼ˆçµ¶å¯¾ã«é‡ãªã‚‰ãªã„ï¼‰ ======= */
  .mf-card{
    border:1px solid rgba(255,255,255,.10);
    background:rgba(255,255,255,.04);
    border-radius:12px;
    padding:6px;
    margin-bottom:8px;
    overflow:hidden;                 /* ã¯ã¿å‡ºã—ä¿è­· */
  }
  .mf{
    display:grid;
    grid-template-columns:repeat(2, minmax(0,1fr)); /* â† minmax(0,1fr)ã§Safariã®æœ€å°å¹…åˆ¶ç´„ã‚’ç„¡åŠ¹åŒ– */
    gap:6px;
    align-items:center;
  }
  .mf .ctl{min-width:0}              /* å­è¦ç´ ã‚‚ç¸®ã‚€ã®ã‚’è¨±å¯ */
  .mf label{
    display:block;
    font-size:10px; line-height:1;
    color:#9fb0c6;
    margin:0 0 2px 2px;
  }
  .mini-inp,.mini-sel{
    height:26px;
    padding:0 8px;
    font-size:12px; line-height:26px;
    color:#e8ecff;
    background:rgba(255,255,255,.07);
    border:1px solid rgba(255,255,255,.14);
    border-radius:8px;
    width:100%;
    box-sizing:border-box;            /* ã¯ã¿å‡ºã—é˜²æ­¢ */
    min-width:0;                      /* iOS Safari å¯¾ç­– */
  }
  .ctl-span2{grid-column:1 / -1}      /* 2åˆ—ã¶ã¡æŠœã */

  .mf-btns{display:flex; gap:6px}
  .btn-mini{
    height:26px; padding:0 10px;
    font-size:12px; line-height:26px;
    border-radius:8px;
    border:1px solid rgba(255,255,255,.18);
    color:#e6ebff; background:rgba(255,255,255,.08);
    text-align:center; white-space:nowrap; flex:1;
  }
  .btn-ghost{background:transparent; color:#9fb0c6}

  /* ======= ã‚µãƒãƒªãƒ¼ï¼š1è¡Œãƒ”ãƒ« ======= */
  .sum-wrap{display:flex; flex-wrap:wrap; gap:6px; margin:8px 0}
  .pill{
    flex:1 1 calc(50% - 6px);
    border:1px solid rgba(255,255,255,.12);
    background:rgba(255,255,255,.06);
    padding:4px 8px;
    border-radius:9999px;
    font-size:12px; color:#cbd5e1; text-align:center; white-space:nowrap;
  }

  /* ======= ãƒªã‚¹ãƒˆï¼ˆæ—¢å­˜ã®ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆï¼‰ ======= */
  .card{border:1px solid rgba(255,255,255,.08);background:rgba(255,255,255,.04);
        border-radius:14px;padding:10px 12px;margin-bottom:10px}
  .amount{font-size:20px;font-weight:800}
  .meta{margin-top:2px;font-size:11px;color:#94a3b8}
  .memo{margin-top:2px;font-size:11px;color:#cbd5e1;word-break:break-word}
  .chip{display:inline-flex;align-items:center;gap:.45em;padding:.30rem .55rem;border-radius:9999px;border:1px solid;
        font-size:12px;line-height:1;white-space:nowrap}
  .chip-sky{border-color:rgba(125,160,255,.35);color:#c7d2fe;background:rgba(125,160,255,.08)}
  .chip-emerald{border-color:rgba(16,185,129,.35);color:#bbf7d0;background:rgba(16,185,129,.08)}
  .actions{margin-top:8px;display:flex;justify-content:flex-end;gap:6px}
  .actions a,.actions button{padding:6px 10px;font-size:12px;border-radius:10px;border:1px solid rgba(255,255,255,.2)}
</style>

<h1 class="text-base font-semibold mb-2">ğŸ’µ ç¾é‡‘å°å¸³</h1>

<form method="get" class="mf-card">
  <div class="mf">
    <div class="ctl">
      <label>è¨¼åˆ¸ä¼šç¤¾</label>
      <select name="broker" class="mini-sel">
        {% with b=params.broker|default:"ALL" %}
          <option value="ALL"  {% if b == "ALL" %}selected{% endif %}>ã™ã¹ã¦</option>
          <option value="æ¥½å¤©" {% if b == "æ¥½å¤©" %}selected{% endif %}>æ¥½å¤©</option>
          <option value="æ¾äº•" {% if b == "æ¾äº•" %}selected{% endif %}>æ¾äº•</option>
          <option value="SBI" {% if b == "SBI" %}selected{% endif %}>SBI</option>
        {% endwith %}
      </select>
    </div>

    <div class="ctl">
      <label>ç¨®åˆ¥</label>
      <select name="kind" class="mini-sel">
        {% with k=params.kind|default:"ALL" %}
          <option value="ALL"      {% if k == "ALL" %}selected{% endif %}>ã™ã¹ã¦</option>
          <option value="DEPOSIT"  {% if k == "DEPOSIT" %}selected{% endif %}>å…¥é‡‘</option>
          <option value="WITHDRAW" {% if k == "WITHDRAW" %}selected{% endif %}>å‡ºé‡‘</option>
          <option value="XFER"     {% if k == "XFER" %}selected{% endif %}>æŒ¯æ›¿</option>
          <option value="SYSTEM"   {% if k == "SYSTEM" %}selected{% endif %}>ã‚·ã‚¹ãƒ†ãƒ </option>
        {% endwith %}
      </select>
    </div>

    <div class="ctl">
      <label>é–‹å§‹æ—¥</label>
      <input type="date" name="start" value="{{ params.start|default_if_none:'' }}" class="mini-inp">
    </div>

    <div class="ctl">
      <label>çµ‚äº†æ—¥</label>
      <input type="date" name="end" value="{{ params.end|default_if_none:'' }}" class="mini-inp">
    </div>

    <div class="ctl ctl-span2">
      <label>ãƒ¡ãƒ¢æ¤œç´¢</label>
      <input type="text" name="q" value="{{ params.q|default_if_none:'' }}" placeholder="ä¾‹: é…å½“ / REAL:21 ãªã©" class="mini-inp">
    </div>

    <div class="ctl ctl-span2">
      <label style="visibility:hidden">æ“ä½œ</label>
      <div class="mf-btns">
        <button type="submit" class="btn-mini">é©ç”¨</button>
        <a href="{% url 'cash_history' %}" class="btn-mini btn-ghost" style="text-decoration:none;">ã‚¯ãƒªã‚¢</a>
      </div>
    </div>
  </div>
</form>

{% if summary %}
  <div class="sum-wrap">
    <div class="pill">åˆè¨ˆ {{ summary.total|intcomma }} å††</div>
    <div class="pill">å…¥é‡‘ {{ summary.deposit|intcomma }} å††</div>
    <div class="pill">å‡ºé‡‘ {{ summary.withdraw|intcomma }} å††</div>
    <div class="pill">æŒ¯æ›¿(å…¥) {{ summary.xfer_in|intcomma }} å††</div>
    <div class="pill">æŒ¯æ›¿(å‡º) {{ summary.xfer_out|intcomma }} å††</div>
  </div>
{% endif %}

<div id="historyContainer">
  {% include "cash/_history_list.html" with page=page params=params %}
</div>

{% if page.has_next %}
  <div
    hx-get="{% url 'cash_history_page' %}?page={{ page.next_page_number }}&{{ params.urlencode }}"
    hx-trigger="revealed"
    hx-swap="afterend"
    class="text-center text-slate-400 py-2 text-[12px]">
    èª­ã¿è¾¼ã¿ä¸­â€¦
  </div>
{% endif %}
{% endblock %}