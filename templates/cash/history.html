{% extends "base.html" %}
{% load humanize %}
{% block title %}ç¾é‡‘å°å¸³{% endblock %}

{% block content %}
<style>
  /* === ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆã‚¹ãƒãƒ›å‰æãƒ»æ¥µå°ï¼‰ === */
  .qcard{border:1px solid rgba(255,255,255,.10);background:rgba(255,255,255,.04);
         border-radius:12px;padding:8px}
  .qbar{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:8px}

  .f{position:relative}
  .f .inlabel{position:absolute;left:10px;top:8px;font-size:11px;color:#98a6be;pointer-events:none}
  .f .ctl{width:100%;height:32px;padding:18px 10px 6px 10px;
         border-radius:8px;border:1px solid rgba(255,255,255,.14);
         background:rgba(255,255,255,.06);color:#e6ebff;font-size:13px;line-height:1}
  /* select ã¯ä¸Šã®ä½™ç™½è¦ã‚‰ãªã„ã®ã§å¾®èª¿æ•´ */
  .f.select .ctl{padding:6px 10px 6px 64px}
  .f.input  .ctl{padding-left:64px}
  .f.date   .ctl{padding:6px 10px 6px 64px}

  /* ãƒœã‚¿ãƒ³è¡Œï¼ˆæŒ‡å®šã©ãŠã‚Šï¼šé©ç”¨â†’ã‚¯ãƒªã‚¢ï¼ä¸­å¤®å¯„ã›ï¼å…ƒã‚µã‚¤ã‚ºï¼‰ */
  .btn-row{grid-column:1/-1;display:flex;justify-content:center;gap:12px;margin-top:2px}
  .btn{height:28px;padding:0 14px;border-radius:8px;font-size:13px;
       background:rgba(255,255,255,.06);color:#e6ebff;
       border:1px solid rgba(255,255,255,.14)}
  .btn.ghost{background:transparent;border-color:rgba(255,255,255,.20)}

  /* === ã‚µãƒãƒªãƒ¼ï¼ˆç¾çŠ¶ã®ã¾ã¾ï¼‰ === */
  .sum-wrap{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-top:8px}
  .pill{border:1px solid rgba(255,255,255,.14);background:rgba(255,255,255,.06);
        padding:6px 8px;border-radius:9999px;text-align:center;font-size:12px;color:#cbd5e1}
  .pill-row2{grid-column:1 / -1;display:grid;grid-template-columns:repeat(2,1fr);gap:8px}

  /* === ãƒªã‚¹ãƒˆï¼ˆã‚«ãƒ¼ãƒ‰ï¼‰ === */
  .card{border:1px solid rgba(255,255,255,.08);background:rgba(255,255,255,.04);
        border-radius:14px;padding:10px 12px;margin-bottom:10px}
  .amount{font-size:20px;font-weight:800}
  .meta{margin-top:2px;font-size:11px;color:#94a3b8}
  .memo{margin-top:2px;font-size:11px;color:#cbd5e1;word-break:break-word}

  .chip{display:inline-flex;align-items:center;gap:.45em;padding:.35rem .6rem;border-radius:9999px;border:1px solid;
        font-size:12px;line-height:1;white-space:nowrap}
  .chip-sky{border-color:rgba(125,160,255,.35);color:#c7d2fe;background:rgba(125,160,255,.08)}
  .chip-emerald{border-color:rgba(16,185,129,.35);color:#bbf7d0;background:rgba(16,185,129,.08)}
</style>

<h1 class="text-base font-semibold mb-2">ğŸ’µ ç¾é‡‘å°å¸³</h1>

<form method="get" class="qcard">
  <div class="qbar">
    <!-- 1) è¨¼åˆ¸ä¼šç¤¾ -->
    <div class="f select">
      <span class="inlabel">è¨¼åˆ¸ä¼šç¤¾</span>
      <select name="broker" class="ctl">
        {% with b=params.broker|default:"ALL" %}
          <option value="ALL"  {% if b == "ALL" %}selected{% endif %}>ã™ã¹ã¦</option>
          <option value="æ¥½å¤©" {% if b == "æ¥½å¤©" %}selected{% endif %}>æ¥½å¤©</option>
          <option value="æ¾äº•" {% if b == "æ¾äº•" %}selected{% endif %}>æ¾äº•</option>
          <option value="SBI" {% if b == "SBI" %}selected{% endif %}>SBI</option>
        {% endwith %}
      </select>
    </div>

    <!-- 2) ç¨®åˆ¥ -->
    <div class="f select">
      <span class="inlabel">ç¨®åˆ¥</span>
      <select name="kind" class="ctl">
        {% with k=params.kind|default:"ALL" %}
          <option value="ALL"      {% if k == "ALL" %}selected{% endif %}>ã™ã¹ã¦</option>
          <option value="DEPOSIT"  {% if k == "DEPOSIT" %}selected{% endif %}>å…¥é‡‘</option>
          <option value="WITHDRAW" {% if k == "WITHDRAW" %}selected{% endif %}>å‡ºé‡‘</option>
          <option value="XFER"     {% if k == "XFER" %}selected{% endif %}>æŒ¯æ›¿</option>
          <option value="SYSTEM"   {% if k == "SYSTEM" %}selected{% endif %}>ã‚·ã‚¹ãƒ†ãƒ </option>
        {% endwith %}
      </select>
    </div>

    <!-- 3) ãƒ¡ãƒ¢æ¤œç´¢ï¼ˆä¾‹æ–‡ã¯ãã®ã¾ã¾ï¼‰ -->
    <div class="f input" style="grid-column:1/-1">
      <span class="inlabel">ãƒ¡ãƒ¢æ¤œç´¢</span>
      <input type="text" name="q" value="{{ params.q|default_if_none:'' }}"
             placeholder="ä¾‹: é…å½“ / REAL:21 ãªã©" class="ctl">
    </div>

    <!-- 4) é–‹å§‹æ—¥ -->
    <div class="f date">
      <span class="inlabel">é–‹å§‹æ—¥</span>
      <input type="date" name="start" value="{{ params.start|default_if_none:'' }}" class="ctl">
    </div>

    <!-- 5) çµ‚äº†æ—¥ï¼ˆåŒä¸€è¡Œï¼‰ -->
    <div class="f date">
      <span class="inlabel">çµ‚äº†æ—¥</span>
      <input type="date" name="end" value="{{ params.end|default_if_none:'' }}" class="ctl">
    </div>

    <!-- 6) ãƒœã‚¿ãƒ³ï¼šé©ç”¨â†’ã‚¯ãƒªã‚¢ï¼ˆä¸­å¤®ãƒ»å…ƒã‚µã‚¤ã‚ºï¼‰ -->
    <div class="btn-row">
      <button class="btn" type="submit">é©ç”¨</button>
      <a class="btn ghost" href="{% url 'cash_history' %}">ã‚¯ãƒªã‚¢</a>
    </div>
  </div>
</form>

{% if summary %}
  <!-- â˜… ã‚µãƒãƒªãƒ¼ã¯è§¦ã‚‰ãªã„ï¼ˆãã®ã¾ã¾ï¼‰ -->
  <div class="sum-wrap">
    <div class="pill">ğŸª™ åˆè¨ˆ {{ summary.total|intcomma }} å††</div>
    <div class="pill">å…¥é‡‘ {{ summary.deposit|intcomma }} å††</div>
    <div class="pill">å‡ºé‡‘ {{ summary.withdraw|intcomma }} å††</div>
    <div class="pill-row2">
      <div class="pill">æŒ¯æ›¿(å…¥) {{ summary.xfer_in|intcomma }} å††</div>
      <div class="pill">æŒ¯æ›¿(å‡º) {{ summary.xfer_out|intcomma }} å††</div>
    </div>
  </div>
{% endif %}

<div id="historyContainer">
  {% include "cash/_history_list.html" with page=page params=params %}
</div>

{% if page.has_next %}
  <div
    hx-get="{% url 'cash_history_page' %}?page={{ page.next_page_number }}&{{ params.urlencode }}"
    hx-trigger="revealed"
    hx-swap="afterend"
    class="text-center text-slate-400 py-2 text-[12px]">
    èª­ã¿è¾¼ã¿ä¸­â€¦
  </div>
{% endif %}
{% endblock %}