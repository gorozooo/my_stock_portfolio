{% load humanize %}
{% for r in page.object_list %}
  <div class="card">
    <div class="flex items-start justify-between gap-3">
      <!-- 左：金額 + メタ + メモ -->
      <div class="min-w-0">
        <div class="amount">{{ r.amount|intcomma }} 円</div>
        <div class="meta">
          {{ r.at|date:"Y年n月j日" }} ｜ {{ r.account.broker|default:"-" }} ｜ 種別：
          {% if r.kind == r.Kind.DEPOSIT %}入金{% elif r.kind == r.Kind.WITHDRAW %}出金
          {% elif r.kind == r.Kind.XFER_IN %}振替(入){% elif r.kind == r.Kind.XFER_OUT %}振替(出)
          {% else %}その他{% endif %}
        </div>
        {% if r.memo %}<div class="memo">{{ r.memo }}</div>{% endif %}

        {# ★ 旧フォールバック行（実現損益 REAL:xx / 配当 DIV:xx）は完全に削除しました #}
      </div>

      <!-- 右：元データのバッジ（銘柄表記） -->
      <div class="text-right shrink-0">
        {% if r.src_badge %}
          {% if r.src_badge.kind == "配当" %}
            <span class="badge sky">【配当】 {{ r.src_badge.label }}</span>
          {% elif r.src_badge.kind == "実損" %}
            <span class="badge g">【実損】 {{ r.src_badge.label }}</span>
          {% endif %}
        {% else %}
          {# データにlabelが無い場合の最後の保険（ID表記のみ） #}
          {% if r.source_type == r.SourceType.DIVIDEND %}
            <span class="badge sky">【配当】 DIV:{{ r.source_id }}</span>
          {% elif r.source_type == r.SourceType.REALIZED %}
            <span class="badge g">【実損】 REAL:{{ r.source_id }}</span>
          {% endif %}
        {% endif %}

        <div class="actions">
          <a href="{% url 'cash_ledger_edit' r.id %}">編集</a>
          <form method="post" action="{% url 'cash_ledger_delete' r.id %}">
            {% csrf_token %}
            <button>削除</button>
          </form>
        </div>
      </div>
    </div>
  </div>
{% empty %}
  <div class="text-slate-400 mt-3">該当データがありません。</div>
{% endfor %}