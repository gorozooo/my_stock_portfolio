{% extends "base.html" %}
{% load static %}

{% block title %}タブ管理{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/tab_manager.css' %}">
<link rel="stylesheet" href="{% static 'css/modal.css' %}"> <!-- モーダル用 -->
{% endblock %}

{% block content %}

<h1 class="page-title">📑 タブ管理</h1>

<!-- タブ一覧 -->
<div id="tab-list" class="tab-list">
  {% if tabs %}
    {% for tab in tabs %}
    <div class="tab-card" data-id="{{ tab.id }}">
      <!-- ヘッダー -->
      <div class="tab-header">
        <div class="tab-main">
          <span class="tab-icon">{{ tab.icon|default:"📑" }}</span>
          <span class="tab-name">{{ tab.name|default:"（未設定）" }}</span>
        </div>
        <div class="tab-actions">
          <button class="edit-tab-btn" title="編集">✏️</button>
          <button class="delete-tab-btn" title="削除">🗑️</button>
          <button class="toggle-submenu" title="サブメニュー切替">▼</button>
        </div>
      </div>

      <!-- サブメニュー -->
      <div class="submenu-list">
        {% if tab.submenus %}
          {% for sub in tab.submenus %}
          <div class="submenu-item" data-id="{{ sub.id }}">
            <span>{{ sub.name|default:"（未設定）" }}</span>
            <div class="submenu-actions">
              <button class="edit-sub-btn" title="編集">✏️</button>
              <button class="delete-sub-btn" title="削除">🗑️</button>
            </div>
          </div>
          {% endfor %}
        {% else %}
          <div class="submenu-item submenu-empty">
            <span>サブメニューなし</span>
          </div>
        {% endif %}
        <button class="add-submenu-btn">＋ サブメニュー追加</button>
      </div>
    </div>
    {% endfor %}
  {% else %}
    <div class="no-tabs">
      <p>タブが登録されていません。</p>
    </div>
  {% endif %}
</div>

<!-- フローティングボタン（新規タブ作成） -->
<button id="add-tab-fab" class="fab" title="新規タブ追加">＋</button>

<!-- ----------------- モーダル共通 ----------------- -->
<div id="tab-modal" class="modal">
  <div class="modal-content">
    <span class="modal-close">&times;</span>
    <h2 id="modal-title">タブ編集</h2>
    <form id="tab-form">
      <input type="hidden" name="tab_id" id="tab-id">
      <div class="form-group">
        <label>タブ名</label>
        <input type="text" name="name" id="tab-name" placeholder="例：ホーム" required>
      </div>
      <div class="form-group">
        <label>アイコン</label>
        <input type="text" name="icon" id="tab-icon" placeholder="例：📌">
      </div>
      <div class="form-group">
        <label>URL 名</label>
        <input type="text" name="url_name" id="tab-url" placeholder="例：main" required>
      </div>
      <div class="form-group">
        <button type="submit" class="btn-submit">保存</button>
      </div>
    </form>
  </div>
</div>

<!-- モーダルサブメニュー -->
<div id="submenu-modal" class="modal">
  <div class="modal-content">
    <span class="modal-close">&times;</span>
    <h2 id="submenu-modal-title">サブメニュー編集</h2>
    <form id="submenu-form">
      <input type="hidden" name="tab_id" id="submenu-tab-id">
      <input type="hidden" name="submenu_id" id="submenu-id">
      <div class="form-group">
        <label>サブメニュー名</label>
        <input type="text" name="name" id="submenu-name" placeholder="例：株一覧" required>
      </div>
      <div class="form-group">
        <label>URL</label>
        <input type="text" name="url" id="submenu-url" placeholder="例：stock_list" required>
      </div>
      <div class="form-group">
        <button type="submit" class="btn-submit">保存</button>
      </div>
    </form>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
<script src="{% static 'js/tab_manager_modal.js' %}"></script> <!-- モーダル用JS -->

{% endblock %}