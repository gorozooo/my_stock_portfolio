{% extends "base.html" %}
{% load static %}

{% block title %}ã‚¿ãƒ–ç®¡ç†{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/tab_manager.css' %}">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
{% endblock %}

{% block content %}
<div id="tab-list" class="tab-list">
  {% if tabs %}
    {% for tab in tabs %}
    <div class="tab-card" data-id="{{ tab.id }}" data-url="{{ tab.url_name|default:'' }}">
      <div class="tab-header">
        <div class="tab-main">
          <span class="tab-icon">{{ tab.icon|default:"ğŸ“‘" }}</span>
          <span class="tab-name">{{ tab.name|default:"ï¼ˆæœªè¨­å®šï¼‰" }}</span>
        </div>
        <div class="tab-actions">
          <button class="edit-tab-btn" title="ç·¨é›†">âœï¸</button>
          <button class="delete-tab-btn" title="å‰Šé™¤">ğŸ—‘ï¸</button>
          <button class="toggle-submenu" title="ã‚µãƒ–ãƒ¡ãƒ‹ãƒ¥ãƒ¼åˆ‡æ›¿">â–¼</button>
        </div>
      </div>
      <div class="submenu-list">
        {% for sub in tab.submenus %}
        <div class="submenu-item" data-id="{{ sub.id }}" data-url="{{ sub.url|default:'' }}">
          <span>{{ sub.name|default:"ï¼ˆæœªè¨­å®šï¼‰" }}</span>
          <div class="submenu-actions">
            <button class="edit-sub-btn" title="ç·¨é›†">âœï¸</button>
            <button class="delete-sub-btn" title="å‰Šé™¤">ğŸ—‘ï¸</button>
          </div>
        </div>
        {% endfor %}
      </div>
      <button class="add-submenu-btn">ï¼‹ ã‚µãƒ–ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¿½åŠ </button>
    </div>
    {% endfor %}
  {% else %}
    <div class="no-tabs"><p>ã‚¿ãƒ–ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</p></div>
  {% endif %}
</div>

<button id="add-tab-fab" class="fab" title="æ–°è¦ã‚¿ãƒ–è¿½åŠ ">ï¼‹</button>

<!-- ãƒ¢ãƒ¼ãƒ€ãƒ« ã‚¿ãƒ– -->
<div id="tab-modal" class="modal">
  <div class="modal-content">
    <span class="modal-close">&times;</span>
    <h2 id="modal-title">ã‚¿ãƒ–ç·¨é›†</h2>
    <form id="tab-form">{% csrf_token %}
      <input type="hidden" name="tab_id" id="tab-id">
      <div class="form-group"><label>ã‚¿ãƒ–å</label><input type="text" name="name" id="tab-name" placeholder="ä¾‹ï¼šãƒ›ãƒ¼ãƒ " required></div>
      <div class="form-group"><label>ã‚¢ã‚¤ã‚³ãƒ³</label><input type="text" name="icon" id="tab-icon" placeholder="ä¾‹ï¼šğŸ“Œ"></div>
      <div class="form-group"><label>URL å</label><input type="text" name="url_name" id="tab-url" placeholder="ä¾‹ï¼šmain" required></div>
      <div class="form-group"><button type="submit" class="btn-submit">ä¿å­˜</button></div>
    </form>
  </div>
</div>

<!-- ãƒ¢ãƒ¼ãƒ€ãƒ« ã‚µãƒ–ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
<div id="submenu-modal" class="modal">
  <div class="modal-content">
    <span class="modal-close">&times;</span>
    <h2 id="submenu-modal-title">ã‚µãƒ–ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç·¨é›†</h2>
    <form id="submenu-form">{% csrf_token %}
      <input type="hidden" name="tab_id" id="submenu-tab-id">
      <input type="hidden" name="submenu_id" id="submenu-id">
      <div class="form-group"><label>ã‚µãƒ–ãƒ¡ãƒ‹ãƒ¥ãƒ¼å</label><input type="text" name="name" id="submenu-name" placeholder="ä¾‹ï¼šæ ªä¸€è¦§" required></div>
      <div class="form-group"><label>URL</label><input type="text" name="url" id="submenu-url" placeholder="ä¾‹ï¼šstock_list" required></div>
      <div class="form-group"><button type="submit" class="btn-submit">ä¿å­˜</button></div>
    </form>
  </div>
</div>

<div id="api-config"
     data-tab-save="{% url 'save_tab' %}"
     data-tab-delete-base="{% url 'delete_tab' 0 %}"
     data-tab-reorder="{% url 'save_order' %}"
     data-submenu-save="{% url 'save_submenu' %}"
     data-submenu-delete-base="{% url 'delete_submenu' 0 %}"
     data-submenu-reorder="{% url 'save_submenu_order' %}">
</div>

<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
<script src="{% static 'js/tab_manager.js' %}"></script>
{% endblock %}