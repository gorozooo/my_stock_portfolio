<div id="detail-modal"
     class="detail-modal"
     aria-hidden="false"
     data-stock-id="{{ stock.id }}">  {# ← JS が参照するため stock.id を埋め込み #}

  <!-- オーバーレイ（タップで閉じる） -->
  <div class="detail-modal__overlay" data-dm-close></div>

  <div class="detail-modal__dialog" role="dialog" aria-modal="true" aria-labelledby="detail-modal-title">
    <!-- ヘッダー：銘柄名＝1行目中央／コード＝2行目中央 -->
    <header class="detail-modal__header">
      <h2 id="detail-modal-title" class="dm-title">
        <span class="dm-name">{{ stock.name }}</span>
        <span class="dm-code">{{ stock.ticker }}</span>
      </h2>
    </header>

    <!-- タブ -->
    <nav class="detail-tabs" role="tablist" aria-label="詳細タブ">
      <button class="detail-tab is-active" data-tab="overview" role="tab" aria-selected="true">概要</button>
      <!-- 価格タブ：有効化（lazy-load 用に JS が参照） -->
      <button class="detail-tab" data-tab="price" role="tab" aria-selected="false">価格</button>
      <button class="detail-tab" data-tab="fundamental" role="tab" aria-selected="false" disabled>指標</button>
      <button class="detail-tab" data-tab="news" role="tab" aria-selected="false" disabled>ニュース</button>
    </nav>

    <!-- パネル -->
    <section class="detail-panels">
      <!-- 概要：最初はスケルトン → JS が /overview.json を描画 -->
      <div class="detail-panel is-active" data-panel="overview">
        <div class="skeleton">
          <div class="sk-line"></div>
          <div class="sk-line"></div>
          <div class="sk-line sk-line--w60"></div>
        </div>
      </div>

      <!-- 価格：初回クリック時に /price.json を取得して描画 -->
      <div class="detail-panel" data-panel="price">
        <div class="price-wrap">
          <div class="price-top">
            <div class="price-last">
              <span class="label">最新</span>
              <span class="val" id="price-last">—</span>
            </div>
            <div class="price-chg">
              <span class="label">前日比</span>
              <span class="val" id="price-chg">—</span>
            </div>
          </div>

          <!-- フル幅表示になるようスタイルを併用（JS側でDPR対応描画） -->
          <canvas id="price-canvas"
                  width="600" height="140"
                  style="display:block; width:100%; height:160px;"
                  aria-label="価格推移"></canvas>

          <div class="price-rows">
            <div class="row"><span>52週高値</span><span id="price-52h">—</span></div>
            <div class="row"><span>52週安値</span><span id="price-52l">—</span></div>
          </div>
        </div>
      </div>

      <div class="detail-panel" data-panel="fundamental">
        <div class="placeholder">指標タブは次の段階で追加予定です。</div>
      </div>

      <div class="detail-panel" data-panel="news">
        <div class="placeholder">ニュースタブは次の段階で追加予定です。</div>
      </div>
    </section>

    <!-- フッター（左から：編集／売却／閉じる） -->
    <footer class="detail-modal__footer">
      <a href="{% url 'stock_edit' stock.id %}" class="dm-btn dm-btn--edit">編集</a>
      <a href="{% url 'stock_sell' stock.id %}" class="dm-btn dm-btn--danger">売却</a>
      <button type="button" class="dm-btn dm-btn--close" data-dm-close aria-label="モーダルを閉じる">閉じる</button>
    </footer>
  </div>
</div>