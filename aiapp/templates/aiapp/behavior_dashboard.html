{% extends "base.html" %}
{% load humanize %}

{% block title %}AI è¡Œå‹•ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰{% endblock %}

{% block head %}
<style>
  :root{
    --bg1:#FFF7ED;
    --bg2:#FDF2F8;
    --bg3:#ECFEFF;

    --card:#ffffff;
    --ink:#0f172a;
    --sub:#475569;

    --line:rgba(15,23,42,.12);

    --pink:#ff4d8d;
    --orange:#ff7a18;
    --yellow:#ffd400;
    --lime:#7CFF5B;
    --mint:#2ee9c6;
    --sky:#35b6ff;
    --violet:#7c3aed;

    --win:#22c55e;
    --lose:#ef4444;
    --flat:#64748b;

    --shadow: 0 10px 30px rgba(15,23,42,.10);
    --shadow2: 0 6px 16px rgba(15,23,42,.08);
  }

  body{
    background:
      radial-gradient(circle at 12% 10%, var(--bg3), transparent 55%),
      radial-gradient(circle at 88% 0%, var(--bg2), transparent 60%),
      radial-gradient(circle at 20% 95%, #fffbe6, transparent 55%),
      linear-gradient(180deg, #ffffff 0%, var(--bg1) 50%, #ffffff 100%);
    color:var(--ink);
  }

  .wrap{
    max-width:860px;
    margin:0 auto;
    padding:14px 12px 86px;
  }

  /* Pop header */
  .hero{
    position:relative;
    padding:16px 14px;
    border-radius:22px;
    background: var(--card);
    border:1px solid var(--line);
    box-shadow: var(--shadow);
    overflow:hidden;
  }
  .hero:before{
    content:"";
    position:absolute;
    inset:-60px -60px auto auto;
    width:220px;height:220px;
    border-radius:50%;
    background:
      radial-gradient(circle at 30% 30%, rgba(255,77,141,.65), transparent 55%),
      radial-gradient(circle at 70% 70%, rgba(53,182,255,.55), transparent 55%),
      radial-gradient(circle at 40% 80%, rgba(255,212,0,.45), transparent 60%);
    filter: blur(0px);
    transform: rotate(12deg);
    pointer-events:none;
  }
  .hero:after{
    content:"";
    position:absolute;
    inset:auto auto -80px -80px;
    width:220px;height:220px;
    border-radius:48px;
    background:
      radial-gradient(circle at 30% 30%, rgba(46,233,198,.55), transparent 60%),
      radial-gradient(circle at 70% 70%, rgba(255,122,24,.45), transparent 60%);
    transform: rotate(-10deg);
    pointer-events:none;
  }

  .heroTop{
    display:flex;
    align-items:flex-start;
    justify-content:space-between;
    gap:10px;
    position:relative;
    z-index:1;
  }

  .title{
    font-size:18px;
    font-weight:900;
    letter-spacing:.2px;
    display:flex;
    align-items:center;
    gap:8px;
  }
  .title .dot{
    width:10px;height:10px;border-radius:50%;
    background: linear-gradient(135deg, var(--pink), var(--orange));
    box-shadow: 0 0 0 4px rgba(255,77,141,.18);
  }

  .subtitle{
    margin-top:6px;
    font-size:12px;
    color:var(--sub);
    line-height:1.55;
    position:relative;
    z-index:1;
  }

  .chips{
    display:flex;
    flex-wrap:wrap;
    gap:8px;
    margin-top:10px;
    position:relative;
    z-index:1;
  }

  .chip{
    display:inline-flex;
    align-items:center;
    gap:6px;
    padding:7px 10px;
    border-radius:999px;
    border:1px solid var(--line);
    background:#ffffff;
    box-shadow: 0 2px 10px rgba(15,23,42,.06);
    font-size:12px;
    font-weight:800;
    color:#0f172a;
    white-space:nowrap;
  }
  .chip .emoji{font-size:14px;}
  .chip.pink{border-color:rgba(255,77,141,.35); background:rgba(255,77,141,.10);}
  .chip.sky{border-color:rgba(53,182,255,.35); background:rgba(53,182,255,.12);}
  .chip.mint{border-color:rgba(46,233,198,.35); background:rgba(46,233,198,.14);}
  .chip.yellow{border-color:rgba(255,212,0,.35); background:rgba(255,212,0,.16);}
  .chip.violet{border-color:rgba(124,58,237,.28); background:rgba(124,58,237,.10);}

  /* Ticker (fast on iPhone) */
  .ticker{
    margin-top:12px;
    border-radius:18px;
    border:1px dashed rgba(15,23,42,.18);
    background:
      linear-gradient(90deg, rgba(255,77,141,.14), rgba(255,212,0,.14), rgba(46,233,198,.14), rgba(53,182,255,.14));
    overflow:hidden;
    position:relative;
    z-index:1;
  }
  .tickerHead{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
    padding:8px 10px 0 10px;
    font-size:11px;
    color:rgba(15,23,42,.65);
    font-weight:900;
  }
  .tickerHead .hint{
    font-weight:800;
    color:rgba(15,23,42,.55);
  }

  .tickerLane{
    position:relative;
    overflow:hidden;
    padding:8px 10px 10px 10px;
    touch-action:manipulation;
    -webkit-user-select:none;
    user-select:none;
  }
  .tickerTrack{
    display:inline-flex;
    align-items:center;
    gap:10px;
    white-space:nowrap;
    will-change: transform;
    transform: translate3d(0,0,0);
    animation: ticker-move var(--dur, 14s) linear infinite;
  }
  .tickerLane.pause .tickerTrack{
    animation-play-state: paused;
  }
  .tickerTag{
    display:inline-flex;
    align-items:center;
    gap:6px;
    padding:6px 10px;
    border-radius:999px;
    background:#fff;
    border:1px solid rgba(15,23,42,.12);
    box-shadow: 0 2px 8px rgba(15,23,42,.06);
    font-size:12px;
    font-weight:900;
    color:#0f172a;
  }
  .tickerTag .spark{
    width:10px;height:10px;border-radius:3px;
    background: linear-gradient(135deg, var(--orange), var(--pink));
  }
  .tickerSep{
    width:6px;height:6px;border-radius:50%;
    background: rgba(15,23,42,.22);
  }

  @keyframes ticker-move{
    from{ transform: translate3d(var(--from, 0px),0,0); }
    to{ transform: translate3d(var(--to, -600px),0,0); }
  }

  /* Sections */
  .grid{
    margin-top:12px;
    display:grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap:10px;
  }
  @media (max-width: 520px){
    .grid{ grid-template-columns: 1fr; }
  }

  .card{
    background: var(--card);
    border:1px solid var(--line);
    border-radius:20px;
    box-shadow: var(--shadow2);
    padding:12px 12px;
  }

  .cardTitle{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:8px;
    font-size:13px;
    font-weight:950;
    margin-bottom:8px;
  }
  .badge{
    display:inline-flex;
    align-items:center;
    gap:6px;
    padding:6px 10px;
    border-radius:999px;
    font-size:11px;
    font-weight:950;
    border:1px solid rgba(15,23,42,.12);
    background:rgba(15,23,42,.04);
    color:#0f172a;
    white-space:nowrap;
  }

  .big{
    font-size:18px;
    font-weight:1000;
    letter-spacing:.2px;
    font-variant-numeric: tabular-nums;
  }
  .sub{
    margin-top:4px;
    font-size:11px;
    color:var(--sub);
    line-height:1.45;
  }

  .kpis{
    display:grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap:8px;
  }
  .kpi{
    border-radius:16px;
    border:1px solid rgba(15,23,42,.10);
    background:
      radial-gradient(circle at 20% 10%, rgba(255,212,0,.18), transparent 55%),
      #ffffff;
    padding:10px 10px;
  }
  .kpiLabel{
    font-size:11px;
    color:rgba(15,23,42,.62);
    font-weight:900;
    margin-bottom:6px;
  }
  .kpiVal{
    font-size:16px;
    font-weight:1000;
    font-variant-numeric: tabular-nums;
  }

  /* Hypotheses list (quirky) */
  .hypList{
    display:flex;
    flex-direction:column;
    gap:8px;
  }
  .hyp{
    border-radius:18px;
    border:1px dashed rgba(15,23,42,.18);
    background:
      linear-gradient(0deg, rgba(255,255,255,.94), rgba(255,255,255,.94)),
      radial-gradient(circle at 20% 10%, rgba(255,77,141,.18), transparent 50%),
      radial-gradient(circle at 80% 90%, rgba(53,182,255,.18), transparent 55%);
    padding:10px 10px;
  }
  .hypHead{
    display:flex;
    align-items:center;
    gap:8px;
    font-weight:1000;
    font-size:11px;
    color:rgba(15,23,42,.70);
    margin-bottom:6px;
  }
  .hypNum{
    width:22px;height:22px;border-radius:10px;
    display:grid;place-items:center;
    background: linear-gradient(135deg, rgba(255,122,24,.20), rgba(255,77,141,.20));
    border:1px solid rgba(255,77,141,.28);
    font-weight:1100;
    color:#0f172a;
  }
  .hypBody{
    font-size:13px;
    font-weight:900;
    line-height:1.55;
    color:#0f172a;
  }

  /* Bias map */
  .kv{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap:8px;
  }
  @media (max-width: 520px){
    .kv{ grid-template-columns: 1fr; }
  }
  .kvRow{
    border:1px solid rgba(15,23,42,.10);
    background:#fff;
    border-radius:16px;
    padding:10px 10px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
  }
  .kvKey{
    font-size:12px;
    font-weight:1000;
    color:rgba(15,23,42,.70);
  }
  .kvVal{
    font-size:12px;
    font-weight:1000;
    color:#0f172a;
    text-align:right;
  }

  /* W/L sequence */
  .seq{
    display:flex;
    gap:6px;
    flex-wrap:wrap;
  }
  .pill{
    width:32px;height:28px;
    border-radius:14px;
    display:grid;
    place-items:center;
    font-weight:1000;
    border:1px solid rgba(15,23,42,.12);
    background:#fff;
    box-shadow: 0 2px 8px rgba(15,23,42,.05);
  }
  .pill.win{ background: rgba(34,197,94,.18); border-color: rgba(34,197,94,.35); }
  .pill.lose{ background: rgba(239,68,68,.16); border-color: rgba(239,68,68,.35); }
  .pill.flat{ background: rgba(100,116,139,.12); border-color: rgba(100,116,139,.28); }

  .streak{
    margin-top:8px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:8px;
    font-size:12px;
    font-weight:1000;
  }
  .streak strong{
    font-variant-numeric: tabular-nums;
    padding:6px 10px;
    border-radius:999px;
    border:1px solid rgba(15,23,42,.12);
    background:rgba(15,23,42,.05);
  }

  /* Recent trades */
  .tradeList{
    display:flex;
    flex-direction:column;
    gap:8px;
  }
  .trade{
    border-radius:18px;
    border:1px solid rgba(15,23,42,.10);
    background:#fff;
    padding:10px 10px;
  }
  .tradeTop{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
  }
  .tradeCode{
    font-weight:1100;
    font-variant-numeric: tabular-nums;
  }
  .tradeLabel{
    font-size:11px;
    font-weight:1100;
    padding:6px 10px;
    border-radius:999px;
    border:1px solid rgba(15,23,42,.12);
  }
  .tradeLabel.win{ background: rgba(34,197,94,.18); border-color: rgba(34,197,94,.35); }
  .tradeLabel.lose{ background: rgba(239,68,68,.16); border-color: rgba(239,68,68,.35); }
  .tradeLabel.flat{ background: rgba(100,116,139,.12); border-color: rgba(100,116,139,.28); }

  .tradeMid{
    margin-top:6px;
    display:flex;
    align-items:flex-end;
    justify-content:space-between;
    gap:10px;
  }
  .tradePL{
    font-weight:1100;
    font-variant-numeric: tabular-nums;
  }
  .tradePL.pos{ color: var(--win); }
  .tradePL.neg{ color: var(--lose); }
  .tradeMeta{
    font-size:11px;
    color:rgba(15,23,42,.55);
    text-align:right;
    white-space:nowrap;
  }

  /* Empty state */
  .empty{
    margin-top:12px;
    border-radius:22px;
    border:2px dashed rgba(15,23,42,.18);
    background: #ffffff;
    box-shadow: var(--shadow2);
    padding:16px 14px;
    color:#0f172a;
  }
  .emptyTitle{
    font-size:14px;
    font-weight:1100;
    margin-bottom:6px;
  }
  .emptySub{
    font-size:12px;
    color:rgba(15,23,42,.65);
    line-height:1.55;
  }
</style>

<script>
  // iPhoneã§ã‚‚ã€Œä½“æ„Ÿã§é€Ÿããªã‚‹ã€ã‚ˆã†ã«ã€è·é›¢ãƒ™ãƒ¼ã‚¹ã§ duration ã‚’æ±ºã‚ã‚‹
  // é€Ÿåº¦(px/s)ã‚’ä¸Šã’ãŸã„ãªã‚‰ speedPx ã‚’ä¸Šã’ã‚‹ï¼ˆä¾‹: 220ï¼‰
  document.addEventListener("DOMContentLoaded", () => {
    const lane = document.querySelector("[data-ticker-lane]");
    const track = document.querySelector("[data-ticker-track]");
    const body  = document.body;
    if (!lane || !track) return;

    const speedPx = 190; // â˜… ã“ã“ã‚’ä¸Šã’ã‚‹ã¨é€Ÿããªã‚‹ï¼ˆiPhoneã§ã‚‚åŠ¹ãï¼‰
    const minDur  = 5;   // æœ€çŸ­ç§’ï¼ˆæ¥µç«¯ã«çŸ­ã„ã¨èª­ã‚ãªã„ã®ã§åˆ¶é™ï¼‰
    const maxDur  = 30;  // æœ€é•·ç§’

    const apply = () => {
      // trackå¹…ãŒç¢ºå®šã—ã¦ã‹ã‚‰è¨ˆç®—ï¼ˆãƒ•ã‚©ãƒ³ãƒˆèª­ã¿è¾¼ã¿ã‚„Safariéƒ½åˆã«å¼·ãã™ã‚‹ï¼‰
      const laneW = lane.clientWidth || 300;
      const trackW = track.scrollWidth || 600;

      // å³ç«¯ï¼ˆç”»é¢å¤–ï¼‰ã‹ã‚‰å·¦ç«¯ï¼ˆå®Œå…¨ã«æŠœã‘ã‚‹ï¼‰ã¾ã§
      const from = laneW;
      const to = -trackW;

      const dist = from - to; // = laneW + trackW
      let dur = dist / speedPx;
      dur = Math.max(minDur, Math.min(maxDur, dur));

      track.style.setProperty("--from", from + "px");
      track.style.setProperty("--to", to + "px");
      track.style.setProperty("--dur", dur + "s");
    };

    // åˆå›
    apply();

    // iOS/Safariã§ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãŒå¾Œã‹ã‚‰ç¢ºå®šã™ã‚‹ã‚±ãƒ¼ã‚¹ã«å‚™ãˆã¦è¤‡æ•°å›
    setTimeout(apply, 80);
    setTimeout(apply, 220);
    setTimeout(apply, 600);

    // å›è»¢/ãƒªã‚µã‚¤ã‚ºã«ã‚‚è¿½å¾“
    window.addEventListener("resize", () => setTimeout(apply, 60));

    // é•·æŠ¼ã—/ã‚¿ãƒƒãƒ—ä¸­ã¯åœæ­¢ï¼ˆã‚¹ã‚¯ã‚·ãƒ§ã®æŒ™å‹•ã«åˆã‚ã›ã‚‹ï¼‰
    const pauseOn = () => lane.classList.add("pause");
    const pauseOff = () => lane.classList.remove("pause");

    lane.addEventListener("touchstart", pauseOn, {passive:true});
    lane.addEventListener("touchend", pauseOff, {passive:true});
    lane.addEventListener("touchcancel", pauseOff, {passive:true});
    lane.addEventListener("mousedown", pauseOn);
    lane.addEventListener("mouseup", pauseOff);
    lane.addEventListener("mouseleave", pauseOff);

    // Safariã®çœã‚¨ãƒã§æ­¢ã¾ã£ãŸæ™‚ã®ä¿é™ºï¼šå¾©å¸°æ™‚ã«å†è¨ˆç®—
    document.addEventListener("visibilitychange", () => {
      if (!document.hidden) setTimeout(apply, 80);
    });
  });
</script>
{% endblock %}

{% block content %}
<div class="wrap">

  <!-- HERO -->
  <div class="hero">
    <div class="heroTop">
      <div>
        <div class="title">
          <span class="dot"></span>
          AI Behavior Lab
        </div>
        <div class="subtitle">
          æˆç¸¾è¡¨ã˜ã‚ƒãªã„ã€‚<br>
          ã€Œã‚ãªãŸã®åˆ¤æ–­ã®ã‚¯ã‚»ã€ã‚’ AI ãŒâ€œä»®èª¬â†’æ¤œè¨¼â€ã§è‚²ã¦ã‚‹å®Ÿé¨“å®¤ã€‚
        </div>

        <div class="chips">
          <span class="chip pink"><span class="emoji">ğŸ§ª</span>PROä»•æ§˜</span>
          <span class="chip sky"><span class="emoji">ğŸ“…</span>today: {{ today_label }}</span>
          <span class="chip mint"><span class="emoji">ğŸ“‚</span>simulate files: {{ sim_files|default:0 }}</span>
          <span class="chip yellow"><span class="emoji">ğŸ§ </span>model: {% if model.has_model %}ready{% else %}none{% endif %}</span>
          <span class="chip violet"><span class="emoji">ğŸ¯</span>understanding: {{ understanding_label }}</span>
        </div>
      </div>
    </div>

    <!-- TICKER -->
    <div class="ticker">
      <div class="tickerHead">
        <div>æœ¬æ—¥ {{ today_label }}</div>
        <div class="hint">ï¼ˆé•·æŠ¼ã—/ã‚¿ãƒƒãƒ—ä¸­ã¯åœæ­¢ï¼‰</div>
      </div>

      <div class="tickerLane" data-ticker-lane>
        <div class="tickerTrack" data-ticker-track>
          {% if ticker_lines %}
            {% for line in ticker_lines %}
              <span class="tickerTag"><span class="spark"></span>{{ line }}</span>
              <span class="tickerSep"></span>
            {% endfor %}
            {# ãƒ«ãƒ¼ãƒ—æ„Ÿã‚’å‡ºã™ãŸã‚ã«2å‘¨ã¶ã‚“ #}
            {% for line in ticker_lines %}
              <span class="tickerTag"><span class="spark"></span>{{ line }}</span>
              <span class="tickerSep"></span>
            {% endfor %}
          {% else %}
            <span class="tickerTag"><span class="spark"></span>ãƒ†ãƒ­ãƒƒãƒ—æœªç”Ÿæˆï¼šticker ã‚’ä½œã‚‹ã¨ã“ã“ãŒæµã‚Œã‚‹</span>
            <span class="tickerSep"></span>
            <span class="tickerTag"><span class="spark"></span>16:20 ã®ç”Ÿæˆï¼ˆã¾ãŸã¯æ‰‹å‹•ï¼‰ã§OK</span>
            <span class="tickerSep"></span>
            <span class="tickerTag"><span class="spark"></span>ã¾ãšã¯WLã‚’å¢—ã‚„ã™ã¨â€œã‚¯ã‚»â€ãŒæ¿ƒããªã‚‹</span>
            <span class="tickerSep"></span>
            <span class="tickerTag"><span class="spark"></span>ãƒ†ãƒ­ãƒƒãƒ—æœªç”Ÿæˆï¼šticker ã‚’ä½œã‚‹ã¨ã“ã“ãŒæµã‚Œã‚‹</span>
            <span class="tickerSep"></span>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  {% if not has_data %}
    <div class="empty">
      <div class="emptyTitle">ã¾ã è¡Œå‹•ãƒ‡ãƒ¼ã‚¿ãŒãªã„ âœï¸</div>
      <div class="emptySub">
        AI Picks ã®ã‚«ãƒ¼ãƒ‰ã‹ã‚‰ã€Œã‚·ãƒŸãƒ¥ãƒ¬ã€ç™»éŒ² â†’ 16:00å°ã®è©•ä¾¡ï¼†å­¦ç¿’ãŒèµ°ã‚‹ã¨ã€ã“ã“ãŒä¸€æ°—ã«è³‘ã‚„ã‹ã«ãªã‚Šã¾ã™ã€‚<br>
        ã¾ãšã¯ <b>win/lose</b> ãŒå¢—ãˆã‚‹ã»ã© â€œã‚ãªãŸã®å‹â€ ãŒè¦‹ãˆã¾ã™ã€‚
      </div>
    </div>
  {% else %}

    <!-- KPI Row -->
    <div class="grid">
      <div class="card">
        <div class="cardTitle">
          <span>å­¦ç¿’ã‚¹ã‚³ã‚¢ï¼ˆã„ã¾ã®ä¸­èº«ï¼‰</span>
          <span class="badge">WL={{ wl_total }} / simulate={{ sim_total }}</span>
        </div>

        <div class="kpis">
          <div class="kpi">
            <div class="kpiLabel">å‹ç‡ï¼ˆwin/loseï¼‰</div>
            <div class="kpiVal">
              {% if win_rate is not None %}
                {{ win_rate|floatformat:1 }}%
              {% else %}
                -
              {% endif %}
            </div>
          </div>
          <div class="kpi">
            <div class="kpiLabel">å¹³å‡R</div>
            <div class="kpiVal">
              {% if avg_r is not None %}
                {{ avg_r|floatformat:3 }}
              {% else %}
                -
              {% endif %}
            </div>
          </div>
          <div class="kpi">
            <div class="kpiLabel">å¹³å‡PL</div>
            <div class="kpiVal">
              {% if avg_pl is not None %}
                {{ avg_pl|floatformat:0|intcomma }}å††
              {% else %}
                -
              {% endif %}
            </div>
          </div>
          <div class="kpi">
            <div class="kpiLabel">è©•ä¾¡æ¸ˆã¿ï¼ˆPROï¼‰</div>
            <div class="kpiVal">
              {{ sim_total|default:0|intcomma }} â†’ {{ wl_total|default:0|intcomma }}
            </div>
          </div>
        </div>

        {% if notes %}
          <div class="sub" style="margin-top:8px;">
            {% for n in notes %}
              â€¢ {{ n }}<br>
            {% endfor %}
          </div>
        {% endif %}
      </div>

      <div class="card">
        <div class="cardTitle">
          <span>ã‚¯ã‚»ã®åœ°å›³ï¼ˆã–ã£ãã‚Šåˆ¤å®šï¼‰</span>
          <span class="badge">streak: <b>{{ streak_label }}</b></span>
        </div>

        <div class="kv">
          {% for b in bias_map %}
            <div class="kvRow">
              <div class="kvKey">{{ b.name }}</div>
              <div class="kvVal">{{ b.value }}</div>
            </div>
          {% endfor %}
        </div>

        <div class="streak">
          <div>ç›´è¿‘ã®ä¸¦ã³</div>
          <strong>{{ streak_label }}</strong>
        </div>

        <div class="seq" style="margin-top:8px;">
          {% for s in sequence %}
            <div class="pill {{ s.label }}">{{ s.text }}</div>
          {% endfor %}
        </div>
      </div>
    </div>

    <!-- Hypotheses -->
    <div class="card" style="margin-top:10px;">
      <div class="cardTitle">
        <span>AI ã®ç¾åœ¨ã®ä»®èª¬ï¼ˆã¶ã£åˆºã•ã‚Šç‰ˆï¼‰</span>
        <span class="badge">æ›´æ–°: {{ today_label }}</span>
      </div>

      <div class="hypList">
        {% for h in hypotheses %}
          <div class="hyp">
            <div class="hypHead">
              <div class="hypNum">{{ forloop.counter }}</div>
              <div>ä»®èª¬ {{ forloop.counter|add:"0" }}</div>
            </div>
            <div class="hypBody">{{ h }}</div>
          </div>
        {% endfor %}
      </div>

      {% if wanted %}
        <div class="sub" style="margin-top:10px;">
          <b>AIãŒæ¬²ã—ã„è¿½åŠ ãƒ‡ãƒ¼ã‚¿ï¼š</b><br>
          {% for w in wanted %}
            â€¢ {{ w }}<br>
          {% endfor %}
        </div>
      {% endif %}
    </div>

    <!-- Recent trades -->
    <div class="grid" style="margin-top:10px;">
      <div class="card">
        <div class="cardTitle">
          <span>ç›´è¿‘ãƒ­ã‚°ï¼ˆè¦³å¯Ÿç”¨ï¼‰</span>
          <span class="badge">latest_behavior_side</span>
        </div>

        <div class="tradeList">
          {% for t in recent_trades %}
            <div class="trade">
              <div class="tradeTop">
                <div class="tradeCode">{{ t.code }}</div>
                <div class="tradeLabel {{ t.label }}">
                  {% if t.label == "win" %}WIN{% elif t.label == "lose" %}LOSE{% else %}FLAT{% endif %}
                </div>
              </div>
              <div class="tradeMid">
                {% if t.pl >= 0 %}
                  <div class="tradePL pos">+{{ t.pl|floatformat:0|intcomma }}å††</div>
                {% else %}
                  <div class="tradePL neg">{{ t.pl|floatformat:0|intcomma }}å††</div>
                {% endif %}
                <div class="tradeMeta">
                  {% if t.r is not None %}R={{ t.r|floatformat:3 }} / {% endif %}
                  {{ t.meta }}
                </div>
              </div>
            </div>
          {% empty %}
            <div class="sub">ã¾ã  side ã®è¡ŒãŒã‚ã‚Šã¾ã›ã‚“ã€‚</div>
          {% endfor %}
        </div>
      </div>

      <div class="card">
        <div class="cardTitle">
          <span>ãƒ¢ãƒ‡ãƒ«çŠ¶æ…‹</span>
          <span class="badge">{% if model.has_model %}READY{% else %}NONE{% endif %}</span>
        </div>

        <div class="sub" style="font-weight:900;">
          {% if model.has_model %}
            å­¦ç¿’å¯¾è±¡ãƒˆãƒ¬ãƒ¼ãƒ‰æ•°ï¼š<b>{{ model.total_trades|default:0|intcomma }}</b><br>
            <span style="color:rgba(15,23,42,.65);font-weight:800;">
              ï¼ˆPROä¸€æŠã§å›ã™å‰æã€‚WLãŒå¢—ãˆã‚‹ã»ã©â€œã‚ãªãŸå°‚ç”¨â€ã«å¯„ã‚Šã¾ã™ï¼‰
            </span>
          {% else %}
            ã¾ã ãƒ¢ãƒ‡ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚Šã¾ã›ã‚“ã€‚<br>
            <span style="color:rgba(15,23,42,.65);font-weight:800;">
              sync â†’ dataset â†’ memory â†’ train ãŒæƒã†ã¨ READY ã«ãªã‚Šã¾ã™ã€‚
            </span>
          {% endif %}
        </div>

        <div class="sub" style="margin-top:10px;">
          <b>tickerï¼š</b> {{ ticker_date|default:"" }}<br>
          {% if ticker_lines %}
            {% for line in ticker_lines %}
              â€¢ {{ line }}<br>
            {% endfor %}
          {% else %}
            â€¢ ãƒ†ãƒ­ãƒƒãƒ—ã¯ã¾ã ç©ºã§ã™ï¼ˆç”Ÿæˆã™ã‚‹ã¨æµã‚Œã¾ã™ï¼‰<br>
          {% endif %}
        </div>
      </div>
    </div>

  {% endif %}
</div>
{% endblock %}