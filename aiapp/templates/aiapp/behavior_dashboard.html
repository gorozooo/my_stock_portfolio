{% extends "base.html" %}
{% load humanize %}

{# =========================================================
  aiapp/behavior_dashboard.html
  - â€œæœªæ¥æ„Ÿâ€ã¯æ¨ã¦ã¦ã€ãƒãƒƒãƒ—ã§å¥‡æŠœãªã€Œå®Ÿé¨“ãƒãƒ¼ãƒˆã€ã¿ãŸã„ã«ã™ã‚‹
  - ç”»é¢ä¸Šéƒ¨ï¼šæ—¥ä»˜ + ãƒ†ãƒ­ãƒƒãƒ—ï¼ˆiPhoneã§ã‚‚é€Ÿããªã‚‹è·é›¢ãƒ™ãƒ¼ã‚¹ï¼‰
  - ä¸­æ®µï¼šKPIã‚’ â€œãŠã‚‚ã¡ã‚ƒç®±â€ ã¿ãŸã„ã«ä¸¦ã¹ã‚‹
  - ä¸‹æ®µï¼šAIã®ä»®èª¬ / æ¬²ã—ã„ãƒ‡ãƒ¼ã‚¿ / ç›´è¿‘ãƒˆãƒ¬ãƒ¼ãƒ‰ï¼ˆè¦³å¯Ÿãƒ­ã‚°ï¼‰
========================================================= #}

{% block title %}AI è¡Œå‹•ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰{% endblock %}

{% block head %}
<style>
  /* =========================================================
    THEME: Pop / Cute / Loud
    - æœªæ¥æ„Ÿï¼ˆæš—ã„ã‚¬ãƒ©ã‚¹/ãƒã‚ªãƒ³/å®‡å®™ï¼‰ã¯ä½¿ã‚ãªã„
    - ç™½ãƒ™ãƒ¼ã‚¹ + ãƒ‘ã‚¹ãƒ†ãƒ« + å¼·ã‚ã®ã‚¢ã‚¯ã‚»ãƒ³ãƒˆã§â€œéŠå…·æ„Ÿâ€
  ========================================================= */

  :root{
    --bgA:#fff7ed; /* ã†ã™ã‚ªãƒ¬ãƒ³ã‚¸ */
    --bgB:#fdf2f8; /* ã†ã™ãƒ”ãƒ³ã‚¯ */
    --bgC:#ecfeff; /* ã†ã™ã‚·ã‚¢ãƒ³ */

    --card:#ffffff;
    --ink:#0f172a;
    --sub:#475569;

    --line:rgba(15,23,42,.12);
    --shadow: 0 10px 28px rgba(15,23,42,.10);
    --shadow2: 0 6px 16px rgba(15,23,42,.08);

    --pink:#ff4d8d;
    --orange:#ff7a18;
    --yellow:#ffd400;
    --mint:#2ee9c6;
    --sky:#35b6ff;
    --violet:#7c3aed;

    --win:#22c55e;
    --lose:#ef4444;
    --flat:#64748b;
  }

  body{
    /* ã‚³ãƒ¡ãƒ³ãƒˆï¼šèƒŒæ™¯ã¯â€œç´™ï¼‹è½æ›¸ãâ€ã®ã‚ˆã†ã«è»½ãæ´¾æ‰‹ã« */
    background:
      radial-gradient(circle at 10% 10%, var(--bgC), transparent 55%),
      radial-gradient(circle at 90% 0%, var(--bgB), transparent 60%),
      radial-gradient(circle at 18% 96%, #fffbe6, transparent 55%),
      linear-gradient(180deg, #ffffff 0%, var(--bgA) 55%, #ffffff 100%);
    color:var(--ink);
  }

  .wrap{
    max-width: 880px;
    margin: 0 auto;
    padding: 14px 12px 88px; /* ã‚³ãƒ¡ãƒ³ãƒˆï¼šä¸‹ã¯ã‚¿ãƒ–ç­‰ã‚’æƒ³å®šã—ã¦ä½™ç™½ */
  }

  /* =========================================================
    HEADER CARD
  ========================================================= */
  .hero{
    position:relative;
    background: var(--card);
    border:1px solid var(--line);
    border-radius: 24px;
    box-shadow: var(--shadow);
    padding: 14px 14px 12px;
    overflow:hidden;
  }

  /* ã‚³ãƒ¡ãƒ³ãƒˆï¼šè§’ã‹ã‚‰â€œçµµã®å…·â€ãŒæ¼ã‚Œã¦ã‚‹æ„Ÿã˜ */
  .hero::before{
    content:"";
    position:absolute;
    right:-70px; top:-70px;
    width:240px; height:240px;
    border-radius:50%;
    background:
      radial-gradient(circle at 30% 30%, rgba(255,77,141,.65), transparent 56%),
      radial-gradient(circle at 70% 70%, rgba(53,182,255,.55), transparent 58%),
      radial-gradient(circle at 40% 80%, rgba(255,212,0,.42), transparent 62%);
    transform: rotate(12deg);
    pointer-events:none;
  }
  .hero::after{
    content:"";
    position:absolute;
    left:-90px; bottom:-90px;
    width:260px; height:260px;
    border-radius: 56px;
    background:
      radial-gradient(circle at 30% 30%, rgba(46,233,198,.55), transparent 60%),
      radial-gradient(circle at 70% 70%, rgba(255,122,24,.45), transparent 62%);
    transform: rotate(-10deg);
    pointer-events:none;
  }

  .heroTop{
    position:relative;
    z-index:1;
    display:flex;
    justify-content:space-between;
    gap:10px;
  }

  .title{
    display:flex;
    align-items:center;
    gap:10px;
    font-size: 18px;
    font-weight: 1000;
    letter-spacing: .2px;
  }
  .titleDot{
    width: 10px; height: 10px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--pink), var(--orange));
    box-shadow: 0 0 0 4px rgba(255,77,141,.18);
  }

  .subtitle{
    margin-top:6px;
    font-size: 12px;
    color: var(--sub);
    line-height: 1.55;
  }

  /* =========================================================
    CHIP ROW
  ========================================================= */
  .chips{
    margin-top:10px;
    display:flex;
    flex-wrap:wrap;
    gap:8px;
    position:relative;
    z-index:1;
  }
  .chip{
    display:inline-flex;
    align-items:center;
    gap:6px;
    padding:7px 10px;
    border-radius:999px;
    border:1px solid var(--line);
    background:#fff;
    box-shadow: 0 2px 10px rgba(15,23,42,.06);
    font-size:12px;
    font-weight: 950;
    white-space:nowrap;
  }
  .chip.pink{ border-color:rgba(255,77,141,.35); background:rgba(255,77,141,.10); }
  .chip.sky{ border-color:rgba(53,182,255,.35); background:rgba(53,182,255,.12); }
  .chip.mint{ border-color:rgba(46,233,198,.35); background:rgba(46,233,198,.14); }
  .chip.yellow{ border-color:rgba(255,212,0,.35); background:rgba(255,212,0,.16); }
  .chip.violet{ border-color:rgba(124,58,237,.28); background:rgba(124,58,237,.10); }

  /* =========================================================
    TICKER (Distance-based for iPhone)
    - ä»¥å‰ã®ã€Œ2ç§’ã«ã—ã¦ã‚‚å¤‰ã‚ã‚‰ãªã„ã€ã‚’æ½°ã™ãŸã‚
    - â€œdurationå›ºå®šâ€ã‚’ã‚„ã‚ã¦ã€è·é›¢(px) / é€Ÿåº¦(px/s) ã§æ±ºã‚ã‚‹
  ========================================================= */
  .ticker{
    margin-top:12px;
    border-radius: 18px;
    border: 1px dashed rgba(15,23,42,.18);
    background: linear-gradient(90deg,
      rgba(255,77,141,.14),
      rgba(255,212,0,.14),
      rgba(46,233,198,.14),
      rgba(53,182,255,.14)
    );
    overflow:hidden;
    position:relative;
    z-index:1;
  }
  .tickerHead{
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:10px;
    padding: 8px 10px 0;
    font-size:11px;
    font-weight:1000;
    color:rgba(15,23,42,.65);
  }
  .tickerLane{
    position:relative;
    overflow:hidden;
    padding: 8px 10px 10px;
    touch-action: manipulation;
    -webkit-user-select:none;
    user-select:none;
  }
  .tickerTrack{
    display:inline-flex;
    align-items:center;
    gap:10px;
    white-space:nowrap;
    will-change: transform;
    transform: translate3d(0,0,0);
    animation: ticker-move var(--dur, 12s) linear infinite;
  }
  .tickerLane.pause .tickerTrack{
    animation-play-state: paused;
  }

  .tickerTag{
    display:inline-flex;
    align-items:center;
    gap:6px;
    padding: 6px 10px;
    border-radius:999px;
    border:1px solid rgba(15,23,42,.12);
    background:#fff;
    box-shadow: 0 2px 8px rgba(15,23,42,.06);
    font-size:12px;
    font-weight:1000;
    color:#0f172a;
  }
  .spark{
    width:10px;height:10px;border-radius:3px;
    background: linear-gradient(135deg, var(--orange), var(--pink));
  }
  .tickerSep{
    width:6px;height:6px;border-radius:50%;
    background: rgba(15,23,42,.22);
  }

  @keyframes ticker-move{
    from{ transform: translate3d(var(--from, 0px), 0, 0); }
    to{ transform: translate3d(var(--to, -600px), 0, 0); }
  }

  /* =========================================================
    GRID + CARDS
  ========================================================= */
  .grid{
    margin-top: 12px;
    display:grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 10px;
  }
  @media (max-width: 520px){
    .grid{ grid-template-columns: 1fr; }
  }

  .card{
    background: var(--card);
    border:1px solid var(--line);
    border-radius: 22px;
    box-shadow: var(--shadow2);
    padding: 12px 12px;
  }

  .cardTitle{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
    font-size:13px;
    font-weight:1000;
    margin-bottom:8px;
  }

  .badge{
    display:inline-flex;
    align-items:center;
    gap:6px;
    padding: 6px 10px;
    border-radius:999px;
    font-size:11px;
    font-weight:1000;
    border:1px solid rgba(15,23,42,.12);
    background: rgba(15,23,42,.05);
    white-space:nowrap;
  }

  /* =========================================================
    KPI "Toy Box"
  ========================================================= */
  .toybox{
    display:grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap:8px;
  }
  .toy{
    border-radius: 18px;
    border: 1px solid rgba(15,23,42,.10);
    background:
      radial-gradient(circle at 20% 10%, rgba(255,212,0,.18), transparent 55%),
      #ffffff;
    padding: 10px 10px;
  }
  .toyLabel{
    font-size:11px;
    font-weight:1000;
    color:rgba(15,23,42,.62);
    margin-bottom:6px;
  }
  .toyVal{
    font-size:16px;
    font-weight:1100;
    font-variant-numeric: tabular-nums;
  }
  .toySub{
    margin-top:4px;
    font-size:11px;
    color:rgba(15,23,42,.55);
    line-height:1.45;
  }

  /* =========================================================
    AI Hypotheses (quirky)
  ========================================================= */
  .hypList{
    display:flex;
    flex-direction:column;
    gap:8px;
  }
  .hyp{
    border-radius: 20px;
    border: 1px dashed rgba(15,23,42,.18);
    background:
      linear-gradient(0deg, rgba(255,255,255,.96), rgba(255,255,255,.96)),
      radial-gradient(circle at 20% 10%, rgba(255,77,141,.18), transparent 55%),
      radial-gradient(circle at 80% 90%, rgba(53,182,255,.18), transparent 60%);
    padding: 10px 10px;
  }
  .hypHead{
    display:flex;
    align-items:center;
    gap:8px;
    font-size:11px;
    font-weight:1100;
    color:rgba(15,23,42,.70);
    margin-bottom:6px;
  }
  .hypNum{
    width:22px;height:22px;border-radius:10px;
    display:grid;place-items:center;
    border:1px solid rgba(255,77,141,.28);
    background: linear-gradient(135deg, rgba(255,122,24,.20), rgba(255,77,141,.20));
    font-weight:1100;
  }
  .hypBody{
    font-size:13px;
    font-weight:1000;
    line-height:1.55;
    color:#0f172a;
  }

  /* =========================================================
    "DNA map" (bias_map)
  ========================================================= */
  .kv{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap:8px;
  }
  @media (max-width: 520px){
    .kv{ grid-template-columns: 1fr; }
  }
  .kvRow{
    border-radius: 18px;
    border: 1px solid rgba(15,23,42,.10);
    background:#fff;
    padding: 10px 10px;
    display:flex;
    justify-content:space-between;
    gap:10px;
  }
  .kvKey{
    font-size:12px;
    font-weight:1100;
    color:rgba(15,23,42,.70);
  }
  .kvVal{
    font-size:12px;
    font-weight:1100;
    text-align:right;
  }

  /* =========================================================
    W/L Sequence
  ========================================================= */
  .seq{
    display:flex;
    flex-wrap:wrap;
    gap:6px;
  }
  .pill{
    width:32px;height:28px;
    border-radius:14px;
    display:grid;
    place-items:center;
    font-weight:1100;
    border:1px solid rgba(15,23,42,.12);
    background:#fff;
    box-shadow: 0 2px 8px rgba(15,23,42,.05);
  }
  .pill.win{ background: rgba(34,197,94,.18); border-color: rgba(34,197,94,.35); }
  .pill.lose{ background: rgba(239,68,68,.16); border-color: rgba(239,68,68,.35); }
  .pill.flat{ background: rgba(100,116,139,.12); border-color: rgba(100,116,139,.28); }

  .streak{
    margin-top:8px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:10px;
    font-size:12px;
    font-weight:1100;
  }
  .streak strong{
    font-variant-numeric: tabular-nums;
    padding: 6px 10px;
    border-radius:999px;
    border:1px solid rgba(15,23,42,.12);
    background: rgba(15,23,42,.05);
  }

  /* =========================================================
    Recent trades
  ========================================================= */
  .tradeList{
    display:flex;
    flex-direction:column;
    gap:8px;
  }
  .trade{
    border-radius: 20px;
    border:1px solid rgba(15,23,42,.10);
    background:#fff;
    padding: 10px 10px;
  }
  .tradeTop{
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:10px;
  }
  .tradeCode{
    font-weight:1200;
    font-variant-numeric: tabular-nums;
  }
  .tradeLabel{
    font-size:11px;
    font-weight:1200;
    padding:6px 10px;
    border-radius:999px;
    border:1px solid rgba(15,23,42,.12);
  }
  .tradeLabel.win{ background: rgba(34,197,94,.18); border-color: rgba(34,197,94,.35); }
  .tradeLabel.lose{ background: rgba(239,68,68,.16); border-color: rgba(239,68,68,.35); }
  .tradeLabel.flat{ background: rgba(100,116,139,.12); border-color: rgba(100,116,139,.28); }

  .tradeMid{
    margin-top:6px;
    display:flex;
    justify-content:space-between;
    align-items:flex-end;
    gap:10px;
  }
  .tradePL{
    font-weight:1200;
    font-variant-numeric: tabular-nums;
  }
  .tradePL.pos{ color: var(--win); }
  .tradePL.neg{ color: var(--lose); }
  .tradeMeta{
    font-size:11px;
    color:rgba(15,23,42,.55);
    white-space:nowrap;
    text-align:right;
  }

  /* =========================================================
    Empty
  ========================================================= */
  .empty{
    margin-top:12px;
    border-radius: 24px;
    border:2px dashed rgba(15,23,42,.18);
    background:#fff;
    box-shadow: var(--shadow2);
    padding: 16px 14px;
  }
  .emptyTitle{
    font-size:14px;
    font-weight:1200;
    margin-bottom:6px;
  }
  .emptySub{
    font-size:12px;
    color:rgba(15,23,42,.65);
    line-height:1.55;
  }
</style>

<script>
  // =========================================================
  // TICKER SPEED FIX (iPhoneå¯¾å¿œ)
  // - durationã‚’ç›´æ¥ã„ã˜ã£ã¦ã‚‚å¤‰ã‚ã‚‰ãªã„åŸå› ã¯ã€Œç§»å‹•è·é›¢ãŒå¤‰ã‚ã‚‹ã€ãŸã‚
  // - è·é›¢(px) / é€Ÿåº¦(px/s) = ç§’ ã§æ±ºã‚ã‚‹ã¨ã€ä½“æ„ŸãŒä¸€å®šã«ãªã‚‹
  //
  // é€Ÿãã—ãŸã„æ™‚ï¼š
  //   speedPx ã‚’ä¸Šã’ã‚‹ï¼ˆä¾‹: 220, 260ï¼‰
  // =========================================================
  document.addEventListener("DOMContentLoaded", () => {
    const lane = document.querySelector("[data-ticker-lane]");
    const track = document.querySelector("[data-ticker-track]");
    if (!lane || !track) return;

    const speedPx = 230;   // â˜… iPhoneã§ç¢ºå®Ÿã«é€Ÿããªã‚‹ï¼šã“ã“ã‚’ä¸Šã’ã‚‹
    const minDur  = 5;     // â˜… èª­ã‚ã‚‹æœ€ä½ç§’ï¼ˆé€Ÿã™ãé˜²æ­¢ï¼‰
    const maxDur  = 26;    // â˜… é•·ã™ãé˜²æ­¢

    const apply = () => {
      // ã‚³ãƒ¡ãƒ³ãƒˆï¼šSafariã¯ãƒ•ã‚©ãƒ³ãƒˆèª­ã¿è¾¼ã¿å¾Œã«å¹…ãŒå¤‰ã‚ã‚‹ã“ã¨ãŒã‚ã‚‹
      const laneW  = lane.clientWidth || 320;
      const trackW = track.scrollWidth || 800;

      // ã‚³ãƒ¡ãƒ³ãƒˆï¼šå³ç«¯ï¼ˆç”»é¢å¤–ï¼‰â†’ å·¦ã¸å®Œå…¨ã«æŠœã‘ã‚‹
      const from = laneW;
      const to   = -trackW;

      const dist = from - to; // = laneW + trackW
      let dur = dist / speedPx;
      dur = Math.max(minDur, Math.min(maxDur, dur));

      track.style.setProperty("--from", from + "px");
      track.style.setProperty("--to",   to + "px");
      track.style.setProperty("--dur",  dur + "s");
    };

    // ã‚³ãƒ¡ãƒ³ãƒˆï¼šè¤‡æ•°å›å½“ã¦ã¦ â€œiOSã®å¹…ç¢ºå®šé…å»¶â€ ã«å¼·ãã™ã‚‹
    apply();
    setTimeout(apply, 80);
    setTimeout(apply, 220);
    setTimeout(apply, 600);

    // ã‚³ãƒ¡ãƒ³ãƒˆï¼šå›è»¢ã‚„ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒãƒ¼ä¼¸ç¸®ã«è¿½å¾“
    window.addEventListener("resize", () => setTimeout(apply, 80));

    // ã‚³ãƒ¡ãƒ³ãƒˆï¼šè§¦ã£ã¦ã‚‹é–“ã¯æ­¢ã‚ã‚‹ï¼ˆèª­ã¿ã‚„ã™ã„ï¼‰
    const pauseOn  = () => lane.classList.add("pause");
    const pauseOff = () => lane.classList.remove("pause");

    lane.addEventListener("touchstart", pauseOn, {passive:true});
    lane.addEventListener("touchend", pauseOff, {passive:true});
    lane.addEventListener("touchcancel", pauseOff, {passive:true});
    lane.addEventListener("mousedown", pauseOn);
    lane.addEventListener("mouseup", pauseOff);
    lane.addEventListener("mouseleave", pauseOff);

    // ã‚³ãƒ¡ãƒ³ãƒˆï¼šãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å¾©å¸°å¾Œã«å†è¨ˆç®—ï¼ˆiOSã§æ­¢ã¾ã‚‹ä¿é™ºï¼‰
    document.addEventListener("visibilitychange", () => {
      if (!document.hidden) setTimeout(apply, 120);
    });
  });
</script>
{% endblock %}

{% block content %}
<div class="wrap">

  <!-- =======================================================
    HERO
  ======================================================== -->
  <div class="hero">
    <div class="heroTop">
      <div>
        <div class="title">
          <span class="titleDot"></span>
          Behavior Labï¼ˆãƒãƒƒãƒ—ç‰ˆï¼‰
        </div>

        <div class="subtitle">
          â€œå‹ç‡â€ã¯çµæœã€‚<br>
          ã“ã“ã¯ <b>ã‚ãªãŸã®åˆ¤æ–­ã®ç™–</b> ã‚’ã€AIãŒå‹æ‰‹ã«ãƒ©ãƒ™ãƒ«ä»˜ã‘ã—ã¦è‚²ã¦ã‚‹è¦³å¯Ÿãƒãƒ¼ãƒˆã€‚
        </div>

        <div class="chips">
          <span class="chip pink">ğŸ§ª PROä»•æ§˜</span>
          <span class="chip sky">ğŸ“… {{ today_label }}</span>
          <span class="chip mint">ğŸ“‚ simulate={{ sim_files|default:0 }}</span>
          <span class="chip yellow">ğŸ¯ WL={{ wl_total|default:0 }}</span>
          <span class="chip violet">ğŸ§  {{ understanding_label }}</span>
        </div>
      </div>
    </div>

    <!-- =======================================================
      TICKER
    ======================================================== -->
    <div class="ticker">
      <div class="tickerHead">
        <div>æœ¬æ—¥ {{ today_label }}</div>
        <div>ï¼ˆé•·æŠ¼ã—/ã‚¿ãƒƒãƒ—ä¸­ã¯åœæ­¢ï¼‰</div>
      </div>

      <div class="tickerLane" data-ticker-lane>
        <div class="tickerTrack" data-ticker-track>
          {% if ticker_lines %}
            {# ã‚³ãƒ¡ãƒ³ãƒˆï¼šãƒ«ãƒ¼ãƒ—æ„Ÿã®ãŸã‚2å‘¨ #}
            {% for line in ticker_lines %}
              <span class="tickerTag"><span class="spark"></span>{{ line }}</span><span class="tickerSep"></span>
            {% endfor %}
            {% for line in ticker_lines %}
              <span class="tickerTag"><span class="spark"></span>{{ line }}</span><span class="tickerSep"></span>
            {% endfor %}
          {% else %}
            {# ã‚³ãƒ¡ãƒ³ãƒˆï¼štickeræœªç”Ÿæˆã§ã‚‚ç”»é¢ãŒå¯‚ã—ããªã‚‰ãªã„ã‚ˆã†ã«ãƒ€ãƒŸãƒ¼ #}
            <span class="tickerTag"><span class="spark"></span>ãƒ†ãƒ­ãƒƒãƒ—æœªç”Ÿæˆï¼šticker ã‚’ä½œã‚‹ã¨ã“ã“ãŒæµã‚Œã‚‹</span><span class="tickerSep"></span>
            <span class="tickerTag"><span class="spark"></span>â€œWLãŒå¢—ãˆã‚‹ã»ã©â€ ç™–ã®è¼ªéƒ­ãŒå‡ºã‚‹</span><span class="tickerSep"></span>
            <span class="tickerTag"><span class="spark"></span>16:20ç”Ÿæˆï¼ˆã¾ãŸã¯æ‰‹å‹•ï¼‰ã§OK</span><span class="tickerSep"></span>
            <span class="tickerTag"><span class="spark"></span>ãƒ†ãƒ­ãƒƒãƒ—æœªç”Ÿæˆï¼šticker ã‚’ä½œã‚‹ã¨ã“ã“ãŒæµã‚Œã‚‹</span><span class="tickerSep"></span>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  {% if not has_data %}
    <!-- =======================================================
      EMPTY
    ======================================================== -->
    <div class="empty">
      <div class="emptyTitle">ã¾ã è¡Œå‹•ãƒ‡ãƒ¼ã‚¿ãŒãªã„ âœï¸</div>
      <div class="emptySub">
        AI Picks ã®ã‚«ãƒ¼ãƒ‰ã‹ã‚‰ã€Œã‚·ãƒŸãƒ¥ãƒ¬ã€ç™»éŒ² â†’ 16:00å°ã®è©•ä¾¡ï¼†å­¦ç¿’ãŒèµ°ã‚‹ã¨ã€ã“ã“ãŒè³‘ã‚„ã‹ã«ãªã‚Šã¾ã™ã€‚<br>
        ã¾ãšã¯ <b>win/lose</b> ã‚’å¢—ã‚„ã™ã»ã© â€œã‚ãªãŸã®å‹â€ ãŒè¦‹ãˆã¾ã™ã€‚
      </div>
    </div>

  {% else %}

    <!-- =======================================================
      KPI + DNA
    ======================================================== -->
    <div class="grid">
      <div class="card">
        <div class="cardTitle">
          <span>ãŠã‚‚ã¡ã‚ƒç®±KPI</span>
          <span class="badge">simulate={{ sim_total|intcomma }} / WL={{ wl_total|intcomma }}</span>
        </div>

        <div class="toybox">
          <div class="toy">
            <div class="toyLabel">å‹ç‡ï¼ˆwin/loseï¼‰</div>
            <div class="toyVal">
              {% if win_rate is not None %}{{ win_rate|floatformat:1 }}%{% else %}-{% endif %}
            </div>
            <div class="toySub">carry/skipã¯æ¯æ•°ã‹ã‚‰é™¤å¤–</div>
          </div>

          <div class="toy">
            <div class="toyLabel">å¹³å‡R</div>
            <div class="toyVal">
              {% if avg_r is not None %}{{ avg_r|floatformat:3 }}{% else %}-{% endif %}
            </div>
            <div class="toySub">â€œæ’¤é€€ã®è³ªâ€ã®ç›®å®‰</div>
          </div>

          <div class="toy">
            <div class="toyLabel">å¹³å‡PL</div>
            <div class="toyVal">
              {% if avg_pl is not None %}{{ avg_pl|floatformat:0|intcomma }}å††{% else %}-{% endif %}
            </div>
            <div class="toySub">å‹ã¡/è² ã‘ã®ãƒãƒ©ãƒ³ã‚¹ãŒåæ˜ </div>
          </div>

          <div class="toy">
            <div class="toyLabel">ç†è§£åº¦ï¼ˆAIå´ï¼‰</div>
            <div class="toyVal">{{ understanding_label }}</div>
            <div class="toySub">WLä»¶æ•°ã§ãƒ©ãƒ•åˆ¤å®š</div>
          </div>
        </div>

        {% if notes %}
          <div class="toySub" style="margin-top:10px;">
            {% for n in notes %}
              â€¢ {{ n }}<br>
            {% endfor %}
          </div>
        {% endif %}
      </div>

      <div class="card">
        <div class="cardTitle">
          <span>åˆ¤æ–­DNAï¼ˆã‚¯ã‚»ã®4åˆ†å‰²ï¼‰</span>
          <span class="badge">streak: <b>{{ streak_label }}</b></span>
        </div>

        <div class="kv">
          {% for b in bias_map %}
            <div class="kvRow">
              <div class="kvKey">{{ b.name }}</div>
              <div class="kvVal">{{ b.value }}</div>
            </div>
          {% endfor %}
        </div>

        <div class="streak">
          <div>ç›´è¿‘ã®ä¸¦ã³</div>
          <strong>{{ streak_label }}</strong>
        </div>

        <div class="seq" style="margin-top:8px;">
          {% for s in sequence %}
            <div class="pill {{ s.label }}">{{ s.text }}</div>
          {% endfor %}
        </div>
      </div>
    </div>

    <!-- =======================================================
      HYPOTHESES
    ======================================================== -->
    <div class="card" style="margin-top:10px;">
      <div class="cardTitle">
        <span>AIã®ä»®èª¬ï¼ˆå¥‡æŠœãƒ»ç›´çƒï¼‰</span>
        <span class="badge">update: {{ today_label }}</span>
      </div>

      <div class="hypList">
        {% for h in hypotheses %}
          <div class="hyp">
            <div class="hypHead">
              <div class="hypNum">{{ forloop.counter }}</div>
              <div>ä»®èª¬ {{ forloop.counter }}</div>
            </div>
            <div class="hypBody">{{ h }}</div>
          </div>
        {% endfor %}
      </div>

      {% if wanted %}
        <div class="subtitle" style="margin-top:10px;">
          <b>AIãŒæ¬²ã—ã„è¿½åŠ ãƒ‡ãƒ¼ã‚¿ï¼š</b><br>
          {% for w in wanted %}
            â€¢ {{ w }}<br>
          {% endfor %}
        </div>
      {% endif %}
    </div>

    <!-- =======================================================
      RECENT LOGS
    ======================================================== -->
    <div class="grid" style="margin-top:10px;">
      <div class="card">
        <div class="cardTitle">
          <span>ç›´è¿‘ãƒ­ã‚°ï¼ˆè¦³å¯Ÿï¼‰</span>
          <span class="badge">latest_behavior_side</span>
        </div>

        <div class="tradeList">
          {% for t in recent_trades %}
            <div class="trade">
              <div class="tradeTop">
                <div class="tradeCode">{{ t.code }}</div>
                <div class="tradeLabel {{ t.label }}">
                  {% if t.label == "win" %}WIN{% elif t.label == "lose" %}LOSE{% else %}FLAT{% endif %}
                </div>
              </div>

              <div class="tradeMid">
                {% if t.pl >= 0 %}
                  <div class="tradePL pos">+{{ t.pl|floatformat:0|intcomma }}å††</div>
                {% else %}
                  <div class="tradePL neg">{{ t.pl|floatformat:0|intcomma }}å††</div>
                {% endif %}

                <div class="tradeMeta">
                  {% if t.r is not None %}R={{ t.r|floatformat:3 }} / {% endif %}
                  {{ t.meta }}
                </div>
              </div>
            </div>
          {% empty %}
            <div class="subtitle">ã¾ã  side ã®è¡ŒãŒã‚ã‚Šã¾ã›ã‚“ã€‚</div>
          {% endfor %}
        </div>
      </div>

      <div class="card">
        <div class="cardTitle">
          <span>ãƒ¢ãƒ‡ãƒ«çŠ¶æ…‹</span>
          <span class="badge">{% if model.has_model %}READY{% else %}NONE{% endif %}</span>
        </div>

        <div class="subtitle" style="font-weight:1000;">
          {% if model.has_model %}
            å­¦ç¿’å¯¾è±¡ãƒˆãƒ¬ãƒ¼ãƒ‰æ•°ï¼š<b>{{ model.total_trades|default:0|intcomma }}</b><br>
            ï¼ˆWLãŒå¢—ãˆã‚‹ã»ã©â€œã‚ãªãŸå°‚ç”¨â€ã«å¯„ã‚‹ï¼‰
          {% else %}
            ã¾ã ãƒ¢ãƒ‡ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚Šã¾ã›ã‚“ã€‚<br>
            ï¼ˆsync â†’ dataset â†’ train ã®æµã‚ŒãŒæƒã†ã¨ READYï¼‰
          {% endif %}
        </div>

        <div class="subtitle" style="margin-top:10px;">
          <b>tickerï¼š</b> {{ ticker_date|default:"" }}<br>
          {% if ticker_lines %}
            {% for line in ticker_lines %}
              â€¢ {{ line }}<br>
            {% endfor %}
          {% else %}
            â€¢ ãƒ†ãƒ­ãƒƒãƒ—ã¯ã¾ã ç©ºã§ã™ï¼ˆç”Ÿæˆã™ã‚‹ã¨æµã‚Œã¾ã™ï¼‰<br>
          {% endif %}
        </div>
      </div>
    </div>

  {% endif %}
</div>
{% endblock %}