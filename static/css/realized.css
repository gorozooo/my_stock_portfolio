/* ===== Base & Theme ===== */
html, body{ height:100%; overflow:hidden; overscroll-behavior:none; -webkit-text-size-adjust:100%; }
:root{
  --top-h:0px; --bottom-h:0px;
  --fg:#eaf2ff; --bg:#0b0f1a; --glass:rgba(255,255,255,.06);
  --ok:#26d07c; --ng:#ff5b6a; --pri:#6ee7ff; --acc:#b07cff;

  --w-date:8.0rem; --w-broker:7.2rem; --w-account:6.4rem; --w-type:5.6rem; --w-qty:5.4rem; --w-pnl:14.6rem;
}
*{ box-sizing:border-box; }
body{
  margin:0; color:var(--fg);
  font-family: ui-sans-serif, system-ui, -apple-system, "Hiragino Kaku Gothic ProN", "Noto Sans JP", "Yu Gothic UI", "Helvetica Neue", Arial;
  background:
    radial-gradient(1200px 600px at 80% -10%, rgba(0,255,255,.10), transparent),
    radial-gradient(900px 500px at -10% 20%, rgba(170,0,255,.10), transparent),
    linear-gradient(180deg, #0b0f1a 0%, #0b0f1a 100%);
}

/* ===== Ambient ===== */
.rp-ambient{ position:fixed; inset:0; z-index:-1; overflow:hidden; }
.rp-blob{ position:absolute; width:48vmax; height:48vmax; filter:blur(60px); opacity:.22; border-radius:50%; animation: float 16s ease-in-out infinite alternate; }
.rp-blob.b1{ background: radial-gradient(circle at 30% 30%, rgba(0,255,255,.5), transparent 60%); left:-20vmax; top:-12vmax; }
.rp-blob.b2{ background: radial-gradient(circle at 70% 40%, rgba(170,0,255,.45), transparent 60%); right:-18vmax; top:-8vmax; animation-delay:2s; }
.rp-blob.b3{ background: radial-gradient(circle at 40% 70%, rgba(0,255,204,.4), transparent 60%); left:10vmax; bottom:-16vmax; animation-delay:4s; }
@keyframes float{ from{ transform:translateY(-2%) scale(1);} to{ transform:translateY(2%) scale(1.06);} }

/* ===== Page Frame ===== */
.rp-page{ height:100svh; height:100dvh; display:flex; flex-direction:column; gap:8px; padding:8px 8px 12px; }

/* Topbar */
.rp-topbar{ display:flex; align-items:center; justify-content:space-between; padding:8px 10px; margin:6px 8px 0; border-radius:12px;
  background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02)); border:1px solid rgba(255,255,255,.12); backdrop-filter: blur(8px);
}
.brand{ display:flex; align-items:center; gap:8px; font-weight:900; letter-spacing:.02em; }
.brand .logo{ font-size:1.1rem; }
.brand .title{ font-size:1.02rem; }
.actions{ display:flex; gap:6px; }
.icon-btn{ border:none; border-radius:10px; padding:6px 10px; color:#fff; cursor:pointer; background:rgba(255,255,255,.14); }
.icon-btn:active{ transform:scale(.98); }

/* ===== Controls ===== */
.rp-controls{
  position:relative; flex:0 0 auto; padding:8px; border-radius:12px;
  background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.04)) padding-box,
             linear-gradient(135deg, rgba(0,255,255,.28), rgba(170,0,255,.24)) border-box;
  border:1px solid transparent; backdrop-filter: blur(10px);
  box-shadow:0 10px 28px rgba(0,0,0,.28), inset 0 0 20px rgba(255,255,255,.05);
}
.topline{ display:grid; grid-template-columns: 1fr auto; gap:8px; align-items:center; min-width:0; }
.searchbox{ display:flex; align-items:center; gap:6px; background:rgba(255,255,255,.12); border:1px solid rgba(255,255,255,.18); border-radius:10px; padding:6px 8px; min-width:0; }
.searchbox input{ flex:1; background:transparent; border:none; outline:none; color:#fff; font-size:.95rem; min-width:0; }

/* KPIトグル：はみ出し防止 */
.kpi-toggle{
  position:static; display:inline-flex; align-items:center; gap:6px;
  padding:8px 12px; border:none; border-radius:10px; font-weight:800; color:#fff; cursor:pointer; white-space:nowrap;
  background: linear-gradient(135deg, rgba(0,255,204,.32), rgba(102,0,255,.26));
  box-shadow: 0 6px 16px rgba(0,0,0,.25), inset 0 0 0 1px rgba(255,255,255,.18);
}
.kpi-toggle .kpi-caret{ display:inline-block; transform: translateY(1px); opacity:.9; }

/* Quick chips / Filters */
.quick-chips{ display:flex; gap:6px; flex-wrap:wrap; margin:6px 0 2px; }
.chip{ padding:6px 10px; border:none; border-radius:12px; background:rgba(255,255,255,.16); color:#fff; cursor:pointer; font-size:.9rem; }
.chip.active{ background: rgba(0,255,255,.22); box-shadow: 0 0 0 1px rgba(0,255,255,.35) inset, 0 6px 16px rgba(0,255,255,.22); }
.filter-box{ display:flex; gap:6px; }
.filter-box select{ flex:1; background: rgba(255,255,255,.14); border: none; padding: 8px 10px; border-radius: 9px; color: #fff; text-align:center; }

/* KPI deck */
.kpi-box{ margin-top:6px; }
.kpi-deck{ display:grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap:6px; }
.kpi-card{
  padding:8px; border-radius:12px; min-width:0;
  background: linear-gradient(135deg, rgba(255,255,255,.09), rgba(255,255,255,.03)) padding-box,
              linear-gradient(135deg, rgba(0,255,255,.35), rgba(170,0,255,.28)) border-box;
  border:1px solid transparent; box-shadow: 0 6px 18px rgba(0,0,0,.22), inset 0 0 22px rgba(255,255,255,.06);
}
.kpi-header{ display:flex; align-items:center; gap:6px; opacity:.92; margin-bottom:4px; font-size:.86rem; min-width:0; }
.kpi-value{
  font-variant-numeric:tabular-nums; font-size: clamp(0.98rem, 3.4vw, 1.18rem); font-weight:800;
  white-space:nowrap; overflow:hidden; text-overflow:ellipsis; min-width:0; max-width:100%;
}

/* リング（12時起点） */
.kpi-card.ring{ display:flex; align-items:center; justify-content:center; min-width:0; }
.circular{ width:72px; height:72px; flex:0 0 auto; }
.circular .bg{ fill:none; stroke:rgba(255,255,255,.18); stroke-width:4; }
.circular .fg{ fill:none; stroke:#26c281; stroke-width:4; stroke-linecap:round; transition:stroke-dasharray .35s ease, stroke .35s ease; }
.ring-wrap{ position:relative; }
.ring-val{ position:absolute; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center; }
.ring-val span{ font-weight:900; }
.profit{ color:var(--ok); font-weight:700; } .loss{ color:var(--ng); font-weight:700; }

/* KPI 折りたたみ */
.rp-controls.collapsed .kpi-box{ display:none; }

/* ===== Tabs ===== */
.rp-tabs{ display:flex; gap:6px; margin-top:2px; }
.rp-tabs .tab{ flex:1; border:none; padding:10px 12px; border-radius:10px; color:#fff; background:rgba(255,255,255,.12); font-weight:800; }
.rp-tabs .tab.active{ background:linear-gradient(135deg, rgba(0,255,204,.28), rgba(102,0,255,.22)); box-shadow: 0 8px 18px rgba(0,0,0,.25); }

/* ===== Views ===== */
.view{ display:none; }
.view.active{ display:block; }
.scroll-area{
  height: var(--view-h, 60vh);
  overflow: auto; -webkit-overflow-scrolling: touch;
  padding-bottom: calc(var(--bottom-h, 0px) + 16px);
}

/* ===== Ledger Table ===== */
.table-wrapper{ height:auto; border-radius:12px; background: var(--glass); position:relative; }
#realizedTable{ width:100%; min-width:920px; border-collapse:collapse; table-layout:auto; }
#realizedTable th, #realizedTable td{ padding:10px 6px; text-align:center; font-size:.92rem; }
#realizedTable thead th{ position:sticky; top:0; z-index:2; background: linear-gradient(180deg, rgba(255,255,255,.22), rgba(255,255,255,.16)); font-weight:800; white-space:nowrap; cursor:pointer; backdrop-filter: blur(6px); }
#realizedTable tbody tr:nth-child(even){ background: rgba(255,255,255,.06); }
#realizedTable tbody tr{ height:50px; position:relative; transition: background .12s ease; }
#realizedTable tbody tr:active{ background: rgba(255,255,255,.12); }
#realizedTable tbody tr::after{ content:'›'; position:absolute; right:8px; top:50%; transform:translateY(-50%); opacity:.6; font-size:18px; pointer-events:none; }
.group-row td{ position:sticky; top:42px; z-index:1; background: rgba(255,255,255,.14); font-weight:900; text-align:left; letter-spacing:.02em; box-shadow: inset 0 1px 0 rgba(255,255,255,.22); }

/* 列幅（銘柄は残り全部） */
#realizedTable th:nth-child(1), #realizedTable td:nth-child(1){ min-width: var(--w-date); }
#realizedTable th:nth-child(2), #realizedTable td:nth-child(2){ text-align:left; overflow:hidden; }
#realizedTable th:nth-child(3), #realizedTable td:nth-child(3){ min-width: var(--w-broker); }
#realizedTable th:nth-child(4), #realizedTable td:nth-child(4){ min-width: var(--w-account); }
#realizedTable th:nth-child(5), #realizedTable td:nth-child(5){ min-width: var(--w-type); }
#realizedTable th:nth-child(6), #realizedTable td:nth-child(6){ min-width: var(--w-qty); }
#realizedTable th:nth-child(7), #realizedTable td:nth-child(7){ min-width: var(--w-pnl); }

/* 銘柄セル（横1行固定） */
#realizedTable td:nth-child(2){ overflow:hidden; }
.stock-name-cell{ display:flex; align-items:center; gap:6px; white-space:nowrap; min-width:0; }
.stock-name-cell .name{ flex:1 1 auto; min-width:0; overflow:hidden; text-overflow:ellipsis; font-weight:800; }
.stock-name-cell .code{ flex:0 0 auto; opacity:.75; font-size:.82rem; white-space:nowrap; padding:2px 6px; border-radius:6px; background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.15); }

/* 損益セル（額+バー+率） — 被り防止＆可変幅バー */
.pnl-cell .pnl-wrap{ display:flex; align-items:center; gap:10px; justify-content:flex-start; flex-wrap:nowrap; min-width:0; }
.pnl-cell .amount{ display:flex; align-items:center; gap:8px; min-width:0; }
.pnl-cell .num{ display:inline-block; min-width:6.4em; max-width:9.4em; text-align:right; font-variant-numeric:tabular-nums; font-weight:800; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
.pnl-cell .bar{ flex:0 0 auto; width: clamp(56px, 12vw, 110px); height:8px; border-radius:999px; background:linear-gradient(90deg, rgba(255,255,255,.22), rgba(255,255,255,.08)); position:relative; overflow:hidden; }
.pnl-cell .bar > span{ position:absolute; inset:0 auto 0 0; width:0; border-radius:999px; }
.rate.chip{ display:inline-flex; align-items:center; justify-content:center; padding:4px 8px; border-radius:999px; background:rgba(255,255,255,.12); border:1px solid rgba(255,255,255,.18); font-weight:800; white-space:nowrap; }

/* 空状態 */
.empty-state{ opacity:.9; text-align:center; margin:10px 0; }

/* ===== Tiles ===== */
.tiles-grid{ display:grid; grid-template-columns: repeat( auto-fill, minmax(240px, 1fr) ); gap:10px; padding:6px; border-radius:12px; background:var(--glass); }
.tile{ border-radius:12px; padding:10px; background: linear-gradient(135deg, rgba(255,255,255,.10), rgba(255,255,255,.04)) padding-box, linear-gradient(135deg, rgba(0,255,204,.28), rgba(102,0,255,.22)) border-box; border:1px solid transparent; box-shadow: 0 8px 18px rgba(0,0,0,.28); cursor:pointer; min-width:0; }
.tile .t-head{ display:flex; gap:8px; align-items:center; justify-content:space-between; min-width:0; }
.tile .t-name{ font-weight:900; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; min-width:0; }
.tile .t-code{ opacity:.75; font-size:.82rem; }
.tile .t-body{ display:grid; grid-template-columns:1fr 1fr; gap:8px; margin-top:8px; font-variant-numeric:tabular-nums; min-width:0; }
.badge{ padding:2px 6px; border-radius:6px; background: rgba(255,255,255,.12); border:1px solid rgba(255,255,255,.18); font-weight:700; }

/* ===== Insights ===== */
.insights-wrap{ display:grid; gap:10px; }
.ins-panel{ border-radius:12px; padding:10px; background: linear-gradient(135deg, rgba(255,255,255,.10), rgba(255,255,255,.04)) padding-box, linear-gradient(135deg, rgba(0,255,204,.28), rgba(102,0,255,.22)) border-box; border:1px solid transparent; box-shadow: 0 8px 18px rgba(0,0,0,.28); min-width:0; }
.ins-panel h3{ margin:0 0 8px; }
.ins-panel.two-col{ display:grid; grid-template-columns: 1fr 1fr; gap:10px; }
.rank-list{ margin:0; padding-left:18px; }
.pill-list{ display:flex; flex-wrap:wrap; gap:8px; margin:0; padding:0; list-style:none; }
.pill{ padding:6px 10px; border-radius:999px; background:rgba(255,255,255,.12); border:1px solid rgba(255,255,255,.18); font-weight:800; }

/* ===== Modal ===== */
.modal{ display:none; position:fixed; inset:0; z-index:100; background-color: rgba(0,0,0,0.6); justify-content:center; align-items:center; padding:6px; touch-action:none; }
.modal.show{ display:flex; }
.modal-content{ width:min(92vw, 380px); max-height:min(74vh, 560px); overflow:auto; padding:14px; border-radius:14px; background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.04)) padding-box, linear-gradient(135deg, rgba(0,255,255,.28), rgba(170,0,255,.24)) border-box; border: 1px solid transparent; backdrop-filter: blur(10px); box-shadow: 0 14px 44px rgba(0,0,0,.42), 0 0 0 1px rgba(255,255,255,.08) inset; transform: scale(.92); opacity: 0; transition: transform .16s ease, opacity .16s ease; position:relative; }
.modal.show .modal-content{ transform: scale(1); opacity: 1; }
.modal .close{ position:absolute; top:8px; right:12px; font-size:1.4rem; cursor:pointer; }
.modal-title-center{ text-align:center; font-weight:900; letter-spacing:.02em; margin: 2px 0 10px; font-size: 1.12rem; text-shadow: 0 2px 10px rgba(0,0,0,.35); }
.modal-amounts{ display:grid; grid-template-columns:1fr 1fr; gap:10px; margin:8px 0 10px; }
.amount-card{ border-radius:12px; background: linear-gradient(135deg, rgba(255,255,255,.10), rgba(255,255,255,.04)) padding-box, linear-gradient(135deg, rgba(0,255,204,.28), rgba(102,0,255,.22)) border-box; border:1px solid transparent; padding:10px 12px; box-shadow: 0 8px 22px rgba(0,0,0,.28), inset 0 0 18px rgba(255,255,255,.06); }
.amount-label{ font-size:.78rem; opacity:.85; margin-bottom:4px; }
.amount-value{ font-variant-numeric:tabular-nums; font-size: clamp(1.05rem, 5vw, 1.28rem); font-weight: 900; line-height:1.1; letter-spacing:.01em; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.modal-grid{ display:grid; grid-template-columns:1fr 1fr; gap:10px 14px; margin-top:6px; }
.modal-grid p{ display:flex; justify-content:space-between; gap:10px; margin:0; }
.modal-grid p.full{ grid-column:1 / -1; }
.modal-grid .k{ opacity:.85; margin-right:8px; }
.modal-grid .pn.profit{ color:var(--ok); font-weight:800; } .modal-grid .pn.loss{ color:var(--ng); font-weight:800; }
@media (max-width:360px){ .modal-amounts{ grid-template-columns:1fr; } .modal-grid{ grid-template-columns:1fr; } }

/* FAB */
.fab{ position:fixed; right:16px; bottom: calc(var(--bottom-h) + 16px); width:44px; height:44px; border-radius:50%; background: linear-gradient(135deg, rgba(0,255,204,.28), rgba(102,0,255,.28)); border:1px solid rgba(255,255,255,.25); color:#fff; font-weight:900; box-shadow: 0 12px 28px rgba(0,0,0,.38); display:flex; align-items:center; justify-content:center; opacity:0; pointer-events:none; transform:translateY(8px); transition: opacity .18s ease, transform .18s ease; }
.fab.show{ opacity:1; pointer-events:auto; transform:none; }

/* Responsive微調整 */
@media (max-width:420px){
  :root{ --w-date:7.2rem; --w-broker:6.2rem; --w-account:5.6rem; --w-type:5.0rem; --w-qty:5.0rem; --w-pnl:13.2rem; }
}