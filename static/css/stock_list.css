/* =========================================================
   MY PORTFOLIO - Stocks List (Mobile-first / Readable)
   - 高コントラスト / 文字サイズ・行間の改善
   - 透明度の下げすぎ防止（半透明は最小限）
   - 変数の欠落を補完（--page-pad, --broker-tabs-h など）
   - iOSの100vh対策（--vh と dvh/svh フォールバック）
   - フォーカス可視化 / アクセシビリティ強化
   ========================================================= */

/* --------------------------
   カラーパレット & ベース変数
--------------------------- */
:root{
  /* レイアウト */
  --vh: 1vh;                         /* JS上書き想定 */
  --navbar-h: 64px;
  --bottom-tab-h: 72px;
  --broker-tabs-h: 44px;             /* 追加（タブの高さ） */
  --account-chips-h: 48px;           /* 追加（口座チップ高さ） */
  --page-pad: 16px;                  /* 追加（ページ左右余白） */

  /* カラー（ダーク基調 + 文字は高コントラスト） */
  --bg: #0f1217;
  --bg-panel: rgba(255,255,255,.06); /* 透明度控えめに */
  --bg-panel-strong: rgba(32,36,44,.9);
  --text: #f3f6fa;
  --text-dim: #bcc6d4;
  --text-muted: #8c96a7;
  --border: rgba(255,255,255,.18);
  --border-dim: rgba(255,255,255,.22);
  --shadow: 0 8px 18px rgba(0,0,0,.35);

  /* アクセント（抑えめ） */
  --accent: #4cc7ff;
  --accent-2: #7af0ff;
  --ok: #59d36f;
  --bad: #ff6b6b;

  /* ステータス色（文字見やすく） */
  --pill-pos-bg: rgba(89,211,111,.14);
  --pill-pos-bd: rgba(89,211,111,.55);
  --pill-neg-bg: rgba(255,107,107,.14);
  --pill-neg-bd: rgba(255,107,107,.55);

  /* フォント & タイポ */
  --fs-xs: 12px;
  --fs-sm: 13px;
  --fs-md: 14px;
  --fs-lg: 15px;
  --lh: 1.5;
}

/* 自動ダーク/ライト対応（必要なら） */
@media (prefers-color-scheme: light){
  :root{
    --bg: #f7f9fc;
    --bg-panel: rgba(0,0,0,.04);
    --bg-panel-strong: rgba(255,255,255,.96);
    --text: #0e1220;
    --text-dim: #30384a;
    --text-muted: #5a6478;
    --border: rgba(0,0,0,.08);
    --border-dim: rgba(0,0,0,.16);
    --shadow: 0 8px 18px rgba(0,0,0,.08);
  }
}

/* さらにコントラストを上げたい人向け */
@media (prefers-contrast: more){
  :root{
    --bg-panel: rgba(255,255,255,.10);
    --border: rgba(255,255,255,.28);
    --border-dim: rgba(255,255,255,.36);
  }
}

/* --------------------------
   ベース
--------------------------- */
html, body{
  height:100%;
  background: var(--bg);
  color: var(--text);
  font-size: 16px;
  -webkit-text-size-adjust: 100%;
}
*,
*::before,
*::after{ box-sizing: border-box; }

main{
  padding: 88px var(--page-pad) calc(var(--bottom-tab-h) + 24px);
  min-height: calc((var(--vh) * 100) - var(--navbar-h));
  overflow: visible; /* 内部スクロールを避ける */
  line-height: var(--lh);
}
@supports (min-height: 100dvh){
  main{ min-height: calc(100dvh - var(--navbar-h)); }
}
@supports (min-height: 100svh){
  main{ min-height: calc(100svh - var(--navbar-h)); }
}

/* コンテナ */
.portfolio-container{
  width:100%;
  padding: 0;
  background: transparent;
  display:flex;
  flex-direction:column;
  gap: 10px;
}

/* --------------------------
   証券会社タブ
--------------------------- */
.broker-tabs-wrapper{
  position: sticky;
  top: var(--navbar-h);
  z-index:150;
  display:flex;
  gap:8px;
  padding: 8px 10px;
  background: var(--bg-panel-strong);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  border-bottom: 1px solid var(--border);
  overflow-x:auto;
}
.broker-tabs-wrapper::-webkit-scrollbar{ display:none; }

.broker-tab{
  padding: 8px 14px;
  border:1px solid var(--border-dim);
  background: rgba(255,255,255,.06);
  border-radius: 14px;
  font-size: var(--fs-sm);
  font-weight: 700;
  color: var(--text);
  white-space: nowrap;
  transition: transform .15s ease, box-shadow .15s ease, background .15s ease, border-color .15s ease;
  outline: none;
}
.broker-tab:hover{
  transform: translateY(-1px);
  background: rgba(255,255,255,.08);
}
.broker-tab:focus-visible{
  box-shadow: 0 0 0 3px rgba(0,208,255,.45);
}
.broker-tab.active{
  background: linear-gradient(135deg, rgba(0,123,255,.88), rgba(0,255,255,.6));
  border-color: rgba(0,123,255,.9);
  color: #fff;
}

/* --------------------------
   横スクロール外枠（セクション）
--------------------------- */
.broker-horizontal-wrapper{
  display:flex;
  flex-direction:row;
  gap:16px;
  width:100%;
  background:transparent;
  overflow:hidden;
  height: calc(100vh - var(--navbar-h) - var(--bottom-tab-h) - var(--page-pad));
}
@supports (height: 100dvh){
  .broker-horizontal-wrapper{
    height: calc(100dvh - var(--navbar-h) - var(--bottom-tab-h) - var(--page-pad));
  }
}
@supports (height: 100svh){
  .broker-horizontal-wrapper{
    height: calc(100svh - var(--navbar-h) - var(--bottom-tab-h) - var(--page-pad));
  }
}

.broker-section{
  flex:0 0 100%;
  display:flex;
  flex-direction:column;
  gap:10px;
  padding: 0 6px 10px;
  height:100%;
  scroll-snap-align: center;
}

/* --------------------------
   口座チップ（固定）
--------------------------- */
.account-chips{
  position: sticky; /* fixed → sticky に変更でレイヤー競合を軽減 */
  top: calc(var(--navbar-h) + var(--broker-tabs-h));
  z-index: 140;
  display:flex;
  align-items:center;
  gap: 8px;
  flex-wrap: wrap;
  padding: 8px 10px;
  margin: 0 -10px; /* 端まで背景を伸ばす */
  background: var(--bg-panel-strong);
  backdrop-filter: blur(6px);
  -webkit-backdrop-filter: blur(6px);
  border-bottom: 1px solid var(--border);
  min-height: var(--account-chips-h);
}
.account-chips::-webkit-scrollbar{ display:none; }

.account-chip{
  padding: 8px 12px;
  border: 1px solid var(--border-dim);
  border-radius: 999px;
  font-size: var(--fs-xs);
  color: var(--text);
  background: rgba(255,255,255,.08);
  transition: transform .12s ease, box-shadow .12s ease, border-color .12s ease, background .12s ease;
  outline: none;
}
.account-chip:hover{ transform: translateY(-1px); background: rgba(0,123,255,.18); }
.account-chip:focus-visible{ box-shadow: 0 0 0 3px rgba(0,208,255,.45); }
.account-chip.is-active{
  border-color: rgba(0,200,255,.9);
  box-shadow: 0 0 0 2px rgba(0,200,255,.35);
  background: linear-gradient(135deg, rgba(0,123,255,.20), rgba(0,255,255,.16));
}

/* sticky分のスペーサ（必要な場合だけ） */
.after-account-chips{ height: var(--account-chips-h); }

/* 見出し */
.account-heading{
  margin: 6px 2px 4px;
  font-size: var(--fs-sm);
  font-weight: 800;
  color: var(--text);
  position: relative;
  padding-left: 10px;
}
.account-heading::before{
  content:'';
  position:absolute; left:0; top:4px; bottom:4px;
  width:3px; border-radius:3px;
  background: linear-gradient(180deg, var(--accent), var(--accent-2));
  opacity:.8;
}

/* --------------------------
   口座サマリー（ピル）
--------------------------- */
.account-summary{
  display:grid;
  grid-template-columns: 1fr;
  row-gap: 8px;
  padding: 10px;
  margin: 0 2px 8px;
  border: 1px solid var(--border);
  border-radius: 12px;
  background: var(--bg-panel);
  box-shadow: var(--shadow);
  font-size: var(--fs-sm);
  color: var(--text-dim);
}
.account-summary .sum-label{ font-weight: 700; color: var(--text); }
.account-summary .sum-pills{ display:flex; flex-wrap:wrap; gap:8px; }

.summary-pill{
  display:inline-flex; align-items:center; gap:6px;
  padding: 6px 10px;
  border-radius: 999px;
  background: rgba(255,255,255,.08);
  color: var(--text);
  border: 1px solid var(--border-dim);
  font-size: var(--fs-xs);
}
.summary-pill .v{ font-weight:800; color: var(--text); }
.summary-pill.profit-pos{ color:#0F0; border-color: var(--pill-pos-bd); background: var(--pill-pos-bg); }
.summary-pill.profit-neg{ color:#ff8080; border-color: var(--pill-neg-bd); background: var(--pill-neg-bg); }

/* --------------------------
   カードリスト（縦スクロール）
--------------------------- */
.broker-cards-wrapper{
  display:flex; flex-direction:column;
  flex:1 1 auto; min-height:0;
  overflow-y:auto;
  gap:10px;
  padding: 0 2px 8px;
  -webkit-overflow-scrolling:touch;
  overscroll-behavior-y:contain;
  scroll-snap-type:y proximity;
}
.broker-cards-wrapper::-webkit-scrollbar{ width:6px; }
.broker-cards-wrapper::-webkit-scrollbar-thumb{
  background: rgba(255,255,255,.22);
  border-radius:3px;
}

/* --------------------------
   各カード
--------------------------- */
.stock-card-wrapper{
  background:transparent;
  border-radius:12px;
  padding:0;
  width:100%;
  display:flex;
  justify-content:center;
  content-visibility:auto;
  contain-intrinsic-size: 120px;
}
.stock-card{
  position:relative;
  display:block;
  padding:12px;
  border:1px solid var(--border);
  border-radius:12px;
  background: rgba(255,255,255,.06);
  color: var(--text);
  font-size: var(--fs-sm);
  width:96%;
  max-width:520px;
  box-shadow: var(--shadow);
  transition: transform .15s ease, box-shadow .15s ease, background .15s ease, border-color .15s ease;
  outline:none;
}
.stock-card:hover{
  transform: translateY(-2px);
  background: rgba(255,255,255,.08);
  border-color: rgba(255,255,255,.3);
}
.stock-card:focus-visible{ box-shadow: 0 0 0 3px rgba(0,208,255,.45); }

.stock-header{
  display:flex; justify-content:space-between; align-items:center;
  margin-bottom:6px;
  font-size: var(--fs-md);
  font-weight: 700;
  letter-spacing:.2px;
}
.stock-name{ color:#fff; }
.stock-code{
  color: var(--text-dim);
  font-weight: 700;
  border:1px solid var(--border-dim);
  border-radius: 6px;
  padding: 2px 6px;
}

.stock-row{
  display:flex; justify-content:space-between;
  margin: 4px 0;
  font-size: var(--fs-sm);
  color: var(--text-muted);
}
.stock-row span:last-child{ color:#fff; }
.stock-row.gain.positive span:last-child{ color: var(--ok); font-weight: 800; }
.stock-row.gain.negative span:last-child{ color: var(--bad); font-weight: 800; }

/* スワイプアクション（控えめ発光） */
.stock-card .card-actions{
  position:absolute;
  top:8px; right:-148px;
  display:flex; gap:6px; padding:6px;
  background: rgba(0,0,0,.45);
  backdrop-filter: blur(10px);
  border-radius: 8px;
  box-shadow: 0 4px 12px rgba(0,0,0,.35);
  transition:right .2s ease, background .2s ease, box-shadow .2s ease;
  z-index: 10;
}
.stock-card.swiped .card-actions{ right:8px; }

.card-actions button{
  position:relative;
  padding: 8px 12px;
  border-radius: 8px;
  font-weight: 700; font-size: var(--fs-sm);
  cursor:pointer;
  border:1px solid rgba(255,255,255,.3);
  color:#fff;
  background: linear-gradient(180deg, rgba(0,123,255,.9), rgba(0,123,255,.65));
  transition: transform .12s ease, box-shadow .12s ease, background .12s ease;
  outline:none;
}
.card-actions .sell-btn{
  background: linear-gradient(180deg, rgba(220,53,69,.95), rgba(220,53,69,.7));
}
.card-actions button:hover{ transform: translateY(-1px); }
.card-actions button:focus-visible{ box-shadow: 0 0 0 3px rgba(0,208,255,.45); }

/* --------------------------
   モーダル
--------------------------- */
.modal{
  display:none;
  position:fixed;
  z-index:2000;
  inset:0;
  background: rgba(0,0,0,.6);
  backdrop-filter: blur(3px);
  overflow-y:auto;
  padding-bottom: env(safe-area-inset-bottom);
}
.modal-content{
  margin: 10% auto;
  padding: 16px;
  border-radius: 12px;
  width: 92%;
  max-width: 440px;
  background: var(--bg-panel-strong);
  border:1px solid var(--border);
  box-shadow: var(--shadow);
  color: var(--text);
}
.modal-close{
  position:absolute; top:6px; right:10px;
  font-size: 22px; cursor:pointer; background:none; border:none; color:#fff;
}
.modal-actions{
  display:flex; justify-content:center; gap:12px; margin-top:16px;
}
.modal-action-btn{
  padding:10px 16px; border-radius:8px;
  font-size: var(--fs-md); font-weight:700; color:#fff;
  border:1px solid var(--border-dim);
  background: linear-gradient(180deg, rgba(0,123,255,.9), rgba(0,123,255,.65));
  transition: transform .12s ease, box-shadow .12s ease;
}
.modal-action-btn:hover{ transform: translateY(-1px); box-shadow: 0 4px 12px rgba(0,0,0,.35); }
.modal-action-btn.negative{ background: linear-gradient(180deg, rgba(244,67,54,.95), rgba(244,67,54,.7)); }

/* --------------------------
   クリック/タップ時の縮小
--------------------------- */
.broker-tab:active,
.account-chip:active,
.modal-action-btn:active,
.card-actions button:active{
  transform: scale(.98);
}

/* --------------------------
   レスポンシブ
--------------------------- */
@media (min-width: 768px){
  .broker-section{ flex:0 0 50%; }
  .stock-card{ padding:14px; font-size: var(--fs-md); max-width:560px; }
}
@media (min-width: 1024px){
  .broker-section{ flex:0 0 33.333%; }
  .stock-card{ padding:16px; font-size: var(--fs-lg); max-width:600px; }
}